(function(s,A,y){s.execute(function(){(function(){s.when("A","ready").register("ac-base",function(n){var k=n.$;n.on("pc-single-text-loaded",function(){k("html").hasClass("a-canvas")||(k(".pc-customization-disabled").addClass("active"),k(".pc-customization-enabled").remove())});return{getASIN:function(){return k(".ac-mobile-app").length>=1?k(".ac-meta-data").find("#asin").val():k("#ASIN").val()},getOfferListingID:function(){return k("#offerListingID").val()},getMerchantID:function(){return k(".ac-mobile-app").length>=
1?k(".ac-meta-data").find("#merchantID").val():k("#merchantID").val()},isApp:function(){return k(".ac-mobile-app").length>=1}}});s.when("A","ac-base","ready").execute(function(n,k){function f(a){var b="/gp/product/features/log-message.html/ref="+a.refTag,e;c++;e="ajax_amzon_custom_log"+c;if(A.ue){var h=A.uet;h("tc",e)}d.ajax({type:"POST",url:b,dataType:"json",data:{component:a.component,message:a.msg,isMetricsNeeded:a.isMetricsNeeded},success:function(a){if(A.ue){var b=A.ues,c=A.uet,d=A.uex;b("id",
e,a.result.rid);b("t0",e,new Date);b("ctb",e,"1");c("cf",e);c("be",e);d("ld",e)}}})}var d=n.$,c=0,e=k.getASIN(),b={CustomizeNowClick:{refTag:"amz_custom_cn_clk_"+e,component:"Amazon Custom customize now button",msg:"Amazon Custom customize now button clicked",isMetricsNeeded:!1},AddToCartClick:{refTag:"amz_custom_atc_clk_"+e,component:"Amazon Custom Add to cart",msg:"Amazon Custom add to cart clicked",isMetricsNeeded:!1},CloseClick:{refTag:"amz_custom_cls_clk_"+e,component:"Amazon Custom Add to cart",
msg:"Amazon Custom close button clicked",isMetricsNeeded:!1},FontChange:{refTag:"amz_custom_font_chg_"+e,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},FontColorChange:{refTag:"amz_custom_color_chg_"+e,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},logCustomImageTabClick:{refTag:"pc_ci_tab_clk",component:"Custom image",msg:"Custom Image click",isMetricsNeeded:!1},logVendorGalleryTabClick:{refTag:"pc_ig_tab_clk",
component:"Vendor image gallery",msg:"Vendor image gallery click",isMetricsNeeded:!1},logAddTextTabClick:{refTag:"pc_at_tab_clk",component:"Add Text",msg:"Add Text Click",isMetricsNeeded:!1},logUseThisDesignClick:{refTag:"pc_utdbtn_clk_"+e,component:"UseThisDesignClick",msg:"Use this design click",isMetricsNeeded:!0},logS3TextUploadError:{refTag:"pc_s3_txt_err",component:"S3TextUploadError",msg:"S3 error on text upload",isMetricsNeeded:!0},logS3ImageUploadError:{refTag:"pc_s3_img_pst_err",component:"S3ImageUploadError",
msg:"S3 error on image upload",isMetricsNeeded:!0},logUseThisDesignKindleHucClick:{refTag:"pc_utdgbtn_clk_kin_huc_"+e,component:"UseThisDesignKindleHucClick",msg:"Use this Design From Kindle Click",isMetricsNeeded:!1},hasNonASCII:{refTag:"amz_custom_has_non_ASCII",component:"Text",msg:"Added Non ASCII. PC-Token - ",isMetricsNeeded:!0}};n.on("amazon-custom-popup-open",function(){this.popupOpenTime=new Date});n.on("amazon-custom-popup-close",function(a){a-=this.popupOpenTime;a/=1E3;A.ue.count("pcSingleTextTimer",
a);A.ue.count("pcSingleTextTimer")});n.on("logVendor-ref-Click",function(a){a={refTag:"pc_vi_"+a.categoryName.substring(0,4)+"_"+e,component:"theme for selected vendor image",msg:"Theme selected for vendor image is "+a.categoryName,isMetricsNeeded:!1};f(a)});n.on("amazon-custom-log-ref-tag",function(a,c){if(a!==y){var d=b[a];d!==y&&(c&&c.msg&&(d.msg+=c.msg),f(d))}})})})();(function(){s.when("A","fabric-js","ac-base","ac-utils","ac-constants","ac-simple-textInput","ac-gallery","ac-image-gallery","ac-text-image",
"ac-error-handling","acc-weblab","ready").register("ac-canvas",function(n,k,f,d,c,e,b,a,i,g,h){var m=n.$;return function(b,c){var f=this;f.isActive=!1;f.surface=c;f.childCanvas=[];f.canvas=b;f.isChild=f.canvas.isChild?f.canvas.isChild:!1;f.controls={};f.canvasObjects=[];f.name="";f.canvas.index!==y?(f.id=f.surface.id+"-area-"+f.canvas.index,f.data=c.data.areas[f.canvas.index],f.name=f.data.name):(f.id=f.surface.id+"-primary",f.isChild=!1);f.currentSelectedObject=null;f.enableBuyBox=!1;f.hasRequiredField=
function(){return f.data.customizationType==="TextPrinting"?f.controls&&f.controls.simpleTextInput&&f.controls.simpleTextInput.hasRequiredField():!1};f.requiredFieldsAreValid=function(){return f.data.customizationType==="TextPrinting"?f.controls&&f.controls.simpleTextInput&&f.controls.simpleTextInput.requiredFieldsAreValid():!0};f.emphasizeMissingField=function(){f.data.customizationType==="TextPrinting"&&f.controls&&f.controls.simpleTextInput&&m.isFunction(f.controls.simpleTextInput.emphasizeMissingField)&&
f.controls.simpleTextInput.emphasizeMissingField()};f.containsEmoji=function(){var a=!1;f.data.customizationType==="TextPrinting"&&(a=f.controls&&f.controls.simpleTextInput&&f.controls.simpleTextInput.containsEmoji());f.data.customizationType==="ImagePrinting"&&(a=f.controls&&f.controls.textInput.imgText&&f.controls.textInput.imgText.containsEmoji());return a};f.renderAll=function(a){a=a?a:1;f.isChild?(f.canvas.renderAll(),setTimeout(function(){d.debounce(f.surface.updatePrimaryCanvas(f.canvas.index),
25)},a)):f.canvas.renderAll()};f.getObjects=function(){return f.canvas.getObjects()};f.toDataURL=function(){try{f.canvas.toDataURL()}catch(a){return null}};f.verifyScaling=function(){f.canvas.off("object:modified");f.canvas.on("object:modified",function(a){a=a.target;f.renderAll();a.type!=="text"&&(a.scaleX>1.5||a.scaleY>1.5?g.show("pc-scale-warning-message"):(a.scaleX<1.5||a.scaleY<1.5)&&g.hide(),f.canvas.calcOffset());f.dragResetObject()})};f.dragResetObject=function(){var a=parseInt(f.canvas.width,
10),b=parseInt(f.canvas.height,10),c=new k.Rect({left:0,top:0,width:a,height:b,opacity:0}),d=new k.Point(0,0),e=new k.Point(0+a,0+b);f.canvas.add(c);d=f.canvas.getActiveObject().intersectsWithObject(c)||f.canvas.getActiveObject().isContainedWithinRect(d,e);f.canvas.remove(c);d||(f.canvas.getActiveObject().set({left:0+(a/2-f.canvas.getActiveObject().width/2),top:0+(b/2-f.canvas.getActiveObject().height/2),scaleX:1,scaleY:1,angle:0}),g.hide(),f.canvas.getActiveObject().setCoords(),f.canvas.calcOffset(),
f.renderAll(50))};f.clear=function(){f.canvas.clear();for(var a in f.controls)if(f.controls.hasOwnProperty(a)&&f.controls[a].cleared)f.controls[a].cleared(),f.controls[a].isControlActive=!1;f.renderAll()};f.childCanvas=[];f.addGalleryImage=function(a){var b;b=f.getObjects();d.imageLoading.show();for(var c=f.canvas.size()-1;c>=0;c--)(b[c].name&&b[c].name==="galImage"||b[c].name&&b[c].name==="cusImage"||b[c].type==="text")&&f.canvas.remove(b[c]);if(f.controls.textInput&&f.controls.textInput.imgText)f.controls.textInput.imgText.resetControl(),
f.controls.textInput.isControlActive=!1;m("#pcTextArea").val("");m(".ac-upload-tnC").fadeOut();k.Image.fromURL(a.imageUrl,function(b){f.canvas.add(b);b.name="galImage";d.imageLoading.hide();f.renderAll();b.vendorGalleryFileId=a.vendorGalleryFileId;b.vendorGalleryId=a.vendorGalleryId;b.originalURL=a.originalURL;m(".pc-two-column-layout .ac-delete-button").fadeIn()},{height:f.canvas.height,width:f.canvas.width,selectable:!1,crossOrigin:"anonymous"})};f.addCustomerImage=function(b){var c,e;c=f.getObjects();
for(var g=f.canvas.size()-1;g>=0;g--)f.canvas.deactivateAll(),(c[g].name&&c[g].name==="galImage"||c[g].name&&c[g].name==="cusImage")&&f.canvas.remove(c[g]);e=function(a){a.height>=a.width&&a.height>=f.canvas.height?(a.width*=f.canvas.height/a.height,a.height=f.canvas.height,a.width>f.canvas.width?(a.height*=f.canvas.width/a.width,a.width=f.canvas.width,a.left=0,a.top=(f.canvas.height-a.height)/2):(a.top=0,a.left=(f.canvas.width-a.width)/2)):a.width>=a.height&&a.width>=f.canvas.width?(a.height*=f.canvas.width/
a.width,a.width=f.canvas.width,a.height>f.canvas.height?(a.width*=f.canvas.height/a.height,a.height=f.canvas.height,a.left=(f.canvas.width-a.width)/2,a.top=0):(a.left=0,a.top=(f.canvas.height-a.height)/2)):(a.left=(f.canvas.width-a.width)/2,a.top=(f.canvas.height-a.height)/2);f.canvas.calcOffset();a.setCoords();f.renderAll()};b=a.prototype.scaleImage(b);k.Image.fromURL(b,function(a){f.canvas.add(a);e(a);d.imageLoading.hide();a.name="cusImage";a.sendToBack();f.canvas.setActiveObject(a);f.renderAll()},
{crossOrigin:"anonymous",transparentCorners:!1,borderColor:"white",centeredScaling:!0,lockUniScaling:!0});m(".ac-upload-tnC").fadeIn()};f.setActiveControl=function(a){for(var b in f.controls)if(f.controls.hasOwnProperty(b)&&f.controls[b])f.controls[b].isControlActive=!1;f.controls[a].isControlActive=!0};f.resetControls=function(){var a=!1,b;b=function(){m(".ac-btn-makeOwn.ac-imageUpload").trigger("click")};for(var c in f.controls)if(f.controls.hasOwnProperty(c)&&f.controls[c].isControlActive)switch(c){case "textInput":m(".ac-btn-makeOwn.ac-textInput").trigger("click");
a=!0;break;case "imageUpload":m(".ac-btn-makeOwn.ac-imageUpload").trigger("click"),a=!0}a||b()};f.activate=function(){};f.bindEvents={commonEvent:function(){f.canvas.off("canvas:cleared");f.canvas.on("canvas:cleared",function(){for(var a=0;a<=f.controls.length;a++)f.controls[a].cleared&&f.controls[a].cleared()});f.canvas.off("object:modified");f.canvas.on("object:modified",function(a){a=a.target;f.controls.textInput?(a.type!=="text"&&((a.scaleX>1.5||a.scaleY>1.5)&&g.show("pc-scale-warning-message"),
(a.scaleX<1.5||a.scaleY<1.5)&&g.hide(),f.canvas.calcOffset()),f.dragResetObject(),f.renderAll()):f.controls.imageUpload&&(f.dragResetObject(),f.renderAll())})},imageUpload:function(){f.controls.imageUpload.cleared=function(){g.hide();m(".ac-upload-tnC").fadeOut()}},imageAndText:function(){f.controls.textInput={};f.canvas.off("object:selected");f.canvas.on("object:selected",function(a){if(a.target)a.target.type==="text"?(f.currentSelectedObject="text",a.target.text!==""&&m(".pc-two-column-layout .ac-delete-button").fadeIn(),
n.trigger("slideUpTextArea")):(f.currentSelectedObject="other",n.trigger("slideDownTextArea"),m(".pc-two-column-layout .ac-delete-button").fadeIn())});f.canvas.off("selection:cleared");f.canvas.on("selection:cleared",function(){if(f.currentSelectedObject==="text")f.currentSelectedObject="other",n.trigger("slideDownTextArea");m(".pc-two-column-layout .ac-delete-button").fadeOut()});f.controls.textInput.cleared=function(){var a=f.getObjects();m("#pcTextArea").val("");f.controls.textInput.imgText.cleared();
for(var b=0;b<a.length;b++)a[b].type==="text"&&a[b].remove();n.trigger("slideDownTextArea")}}};f.bindControls=function(){var a=m(".ac-area-control."+f.id+", .ac-area-control.ac-widget-control"),b;m.each(a,function(a,c){b=m(c).attr("data-control-template");switch(b){case "simple-textInput":var d=new e(c,f,{});f.controls.simpleTextInput=d;break;case "imageUpload":if(f.surface.customizationType==="ImagePrinting")f.verifyScaling(),f.controls.imageUpload={isControlActive:!0},f.bindEvents.imageUpload();
break;case "textInput":if(f.surface.customizationType==="ImagePrinting"&&f.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported)f.bindEvents.imageAndText(),f.controls.textInput.imgText=new i(f,{})}})};f.controlRenderingHandle=function(){var a,b,c;if(f.surface.customizationType==="ImagePrinting"){var d,e,g,h,i=!1;a=!1;b=!1;c=!1;m(".ac-imageUpload-control");d=m(".ac-btn-makeOwn.ac-imageUpload");m(".ac-textInput-control");e=m(".ac-btn-makeOwn.ac-textInput");g=m('.a-tab-heading[data-a-tab-name="gallery"]');
h=m('.a-tab-heading[data-a-tab-name="makeOwn"]');f.data.customizationTypeSettings.ImagePrinting&&(f.data.customizationTypeSettings.ImagePrinting.isGallerySupported&&f.data.customizationTypeSettings.ImagePrinting.galleries&&f.data.customizationTypeSettings.ImagePrinting.galleries.length&&(a=!0),f.data.customizationTypeSettings.ImagePrinting.isCustomerUploadSupported&&(b=!0),f.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported&&(c=!0));g.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");
d.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");e.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");h.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item");a?g.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item"):h.trigger("click");
b?d.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"):(m(".ac-imageUpload-control").removeClass("active"),m(".ac-btn-makeOwn.ac-imageUpload").removeClass("active"));c&&(e.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"),b||(f.surface.widget.surfaceList.forEach(function(a){a.childCanvasList.forEach(function(a){for(var a=a.getObjects(),b=0;b<a.length;b++)a[b].name&&
a[b].name==="galImage"&&(i=!0)})}),i||setTimeout(function(){e.trigger("click")},50)));!b&&!c&&(h.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden"),g.addClass("a-active"),g.parents(".a-tab-container").find('.a-tab-content[data-a-name="makeOwn"]').addClass("a-hidden").siblings('.a-tab-content[data-a-name="gallery"]').removeClass("a-hidden").addClass("a-active"))}};f.fulfillmentJSON=function(){var a={},b=f.getObjects(),c,d;f.canvas.deactivateAll();
d=function(){var a,b;b={};for(b=0;b<f.surface.data.FontSettings.colors.length;b++)if(f.surface.data.FontSettings.colors[b].value===f.surface.color){a=f.surface.data.FontSettings.colors[b].name;break}b=f.data.customizationTypeSettings.TextPrinting.placeHolderText;b={fontFamily:f.surface.fontName,text:f.controls.simpleTextInput.inputBox.val(),fill:f.surface.color,customizationType:"TextPrinting",label:b?b:""};if(a)b.colorName=a;return b};a.name=f.name;a.Position=f.data.specifications.position;a.Dimensions=
f.data.specifications.dimension;if(f.surface.customizationType==="ImagePrinting"){for(d=0;d<b.length;d++)if(b[d].name&&b[d].name==="galImage"){var e=b[d].originalURL;c="VendorGallery";a.vendorGalleryImagePath=e;a.vendorGalleryFileId=b[d].vendorGalleryFileId;a.vendorGalleryId=b[d].vendorGalleryId;a.customizationType="ImagePrinting"}else b[d].type==="text"&&!b[d].text.replace(" ","").length&&b[d].remove();if(!c&&b.length)c="SVG",a.canvas=f.canvas,a.customizationType="ImagePrinting"}else c="JSON",a=
m.extend(a,d());if(m("#amazonCustomUseCaseId").val()==="AC_ImgTxtPersonalization_3")a.id=f.id;a.fulfillmentType=c;return a};f.init=function(){f.isChild&&(f.bindControls(),f.controlRenderingHandle());if(m(".ac-mobile-app").length>=1)n.on("resize-preview-text",function(){f.controls.simpleTextInput&&f.controls.simpleTextInput.inputBox&&f.controls.simpleTextInput.inputBox.trigger("keyup")});h.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&f.controls.simpleTextInput&&!f.controls.simpleTextInput.hasRequiredField()&&
f.controls.simpleTextInput.hideIsRequiredLabel()}}})})();(function(){s.when("A","ac-base","fabric-js","ac-utils","ac-canvas","ac-color-picker","ac-font-picker","ac-constants","ac-base","acc-weblab","ready").register("ac-surface",function(n,k,f,d,c,e,b,a,i,g){var h=n.$;return function(m,l,o){var j={},p,q,E,B,v,C,G;j.isActive=!1;j.name="";j.productImageUrl="";j.maskImageUrl="";j.primaryCanvas=null;j.thumbnail=null;j.childCanvasList=[];j.controls={};j.font=k.getMerchantID()+"-Arial";j.customizationType=
m.areas[0].customizationType;j.data=m;j.widget=l;j.isApp=i.isApp();G=h("html.a-ie9").length||n.capabilities.isIE10;j.miniThumbnailCanvas=[];p=function(a,b){var e=new c(a,j);e.init();if(i.isApp())n.on("resize-preview-text",function(){if(b!==y){var c=d.getScaleRatio(),e=b.specifications.dimension.height*c+5;a.setWidth(b.specifications.dimension.width*c);a.setHeight(e)}});return e};E=function(){for(var a=h('.ac-controls-container[data-surface="surface-'+m.index+'"]').find('[type="text"]'),b=0;b<a.length;b++)if(a[b].value.length)return!0;
return!1};q=function(a,b){var c,e,g,i,m,l,k=j.isApp,o;if(b.isChild)return null;e=a.specifications.position.y;g=a.specifications.position.x;i=a.specifications.dimension.height;m=a.specifications.dimension.width;l=a.specifications.angle?a.specifications.angle:0;c=document.createElement("canvas");c.id=j.id+"-area-"+a.index;c.className+=" canvasArea";k?(o=d.getScaleRatio(),c.setAttribute("data-left",g*o),c.setAttribute("data-top",e*o),c.setAttribute("data-initial-left",g),c.setAttribute("data-initial-top",
e),c.setAttribute("data-initial-width",m),c.setAttribute("data-initial-height",i),c.setAttribute("data-angle",l),c.height=i*o+5,c.width=m*o):(c.setAttribute("data-left",g),c.setAttribute("data-top",e),c.setAttribute("data-angle",l),c.height=i+5,c.width=m);h('.ac-preview-container[data-surface="'+j.id+'"]').append(c);c.getContext("2d");var p=new f.Canvas(c.id);l="rotate("+l+"deg)";k?h(c).parent(".canvas-container").css({width:m*o,height:i*o,position:"absolute",top:e*o+"px",left:g*o+"px","-ms-transform":l,
"-webkit-transform":l,transform:l}):h(c).parent(".canvas-container").css({position:"absolute",top:e+"px",left:g+"px","-ms-transform":l,"-webkit-transform":l,transform:l});p.isChild=!0;p.parent=b;p.index=a.index;return p};B=function(a){var b=new Image;b.crossOrigin="anonymous";b.src=m.preview.url;b.onload=function(){a.canvas.setBackgroundImage(new f.Image(b,{originX:"left",originY:"top",left:0,top:0}),function(){a.renderAll.bind(a.canvas);d.debounce(j.updateThumbnail(),50)})};if(m.mask&&m.mask.url){var c=
new Image;c.crossOrigin="anonymous";c.src=m.mask.url;c.style.top="-"+m.areas[0].specifications.position.y+"px";c.style.left="-"+m.areas[0].specifications.position.x+"px";c.onload=function(){a.canvas.setOverlayImage(new f.Image(c,{originY:"top",originX:"left",left:0,top:0}),function(){a.renderAll.bind(a.canvas);d.debounce(j.updateThumbnail(),25)});h("#"+j.id+"-area-0").after(c).parent(".canvas-container").css({height:"400px",width:"400px"})}}};v=function(a){for(var b,c=0;c<m.areas.length;c++)b=m.areas[c],
b.index=c,b=j.isApp?p(q(b,a),b):p(q(b,a)),c===0&&j.setActiveArea(b),a.childCanvas.push(b);B(a);return a.childCanvas};C=function(){var a,b=j.data.areas[0].customizationTypeSettings.ImagePrinting.galleries,c,d=!1,e,g;h("#ac-gallery.vendor-categories > .vendor-category").css({display:"none"});if(j.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery)c=j.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery;for(var f=0;f<b.length;f++)if(a="",a=b[f].charAt(0)==="/"?b[f].substr(1,
b[f].length):b[f])e=h('#ac-gallery.vendor-categories > .vendor-category > a[data-themename="'+a+'"]'),g=h('#ac-gallery.vendor-categories > .vendor-category > a[data-categoryid="'+a+'"]'),e.length?(e.parent(".vendor-category").css({display:"block"}),c&&c.substr(1,c.length)===a&&(e.trigger("click"),d=!0)):g.length&&(g.parent(".vendor-category").css({display:"block"}),c&&c.substr(1,c.length)===a&&(g.trigger("click"),d=!0));d||h("#ac-gallery.vendor-categories > .vendor-category > a").each(function(a,
b){h(b).parent(".vendor-category").css("display")==="block"&&h(b).trigger("click")})};j.setActiveArea=function(a){for(var b=0;b<j.childCanvasList.length;b++)j.childCanvasList[b].isActive=!1;a.isActive=!0;return a};j.updateTickerOnTab=function(){E()?h(".pc-surface-nav-carousel").find('[data-surface-num="'+(m.index+1)+'"]').addClass("customized"):h(".pc-surface-nav-carousel").find('[data-surface-num="'+(m.index+1)+'"]').removeClass("customized")};j.isSurfaceCustomized=function(){for(var a=h('.ac-controls-container[data-surface="surface-'+
m.index+'"]').find('[type="text"]'),b=0;b<a.length;b++)if(a[b].value.length)return!0;return!1};j.getActiveArea=function(){var a,b;for(a=0;a<j.childCanvasList.length;a++)j.childCanvasList[a].isActive===!0&&(b=j.childCanvasList[a]);return b};j.hasRequiredField=function(){return n.reduce(j.childCanvasList,function(a,b){return a||b.hasRequiredField()},!1)};j.requiredFieldsAreValid=function(){return n.reduce(j.childCanvasList,function(a,b){return a&&b.requiredFieldsAreValid()},!0)};j.emphasizeMissingFields=
function(){n.each(j.childCanvasList,function(a){a.requiredFieldsAreValid()||a.emphasizeMissingField()});var a=j.getThumbnailImage().parent();a.hasClass("active")||a.addClass("error")};j.containsEmoji=function(){return n.reduce(j.childCanvasList,function(a,b){return a||b.containsEmoji()},!1)};j.enableBuyBox=function(){for(var a=!1,b=0;b<j.childCanvasList.length;b++)if(j.childCanvasList[b].enableBuyBox===!0){a=!0;break}return a};j.getThumbnailImage=function(){return h(".thumbnail-container").find('.thumbnail-image[ac-target="'+
j.id+'"]')};j.setPrimaryCanvas=function(){var a;a=p(new f.Canvas("ac-preview-canvas-"+j.id));a.isChild=!1;return a};j.updatePrimaryCanvas=function(a){var b,c,e,g,i=!1;b=function(){var b={};b.height=j.primaryCanvas.childCanvas[a].canvas.height;b.width=j.primaryCanvas.childCanvas[a].canvas.width;b.top=h("canvas#"+j.id+"-area-"+a).data("top");b.left=h("canvas#"+j.id+"-area-"+a).data("left");b.angle=h("canvas#"+j.id+"-area-"+a).data("angle");return b};if(j.primaryCanvas.childCanvas[a]){var m=j.primaryCanvas.childCanvas[a].getObjects(),
o;g=j.primaryCanvas.getObjects();for(var k=j.primaryCanvas.canvas.size()-1;k>=0;k--)g[k].areaId!==y&&g[k].areaId===a&&j.primaryCanvas.canvas.remove(g[k]);if(m.length)if(m.length===1&&m[0].type==="text"&&(m[0].text===""||m[0].text===" "))j.primaryCanvas.childCanvas[a].canvas.deactivateAll();else{i=!0;for(k=j.primaryCanvas.childCanvas[a].canvas.size()-1;k>=0;k--)m[k].active&&(o=m[k]);e=b();var p=function(a){var b={},c=!1,b={left:-a.width/2,top:-a.height/2,width:a.width,height:a.height};if(a.left<0){if(c=
!0,b.left=-a.width/2-a.left,a.width+a.left>e.width)b.width=e.width}else if(a.width+a.left>e.width)c=!0,b.left=-a.width/2-(a.width+a.left-e.width);if(a.top<0){if(c=!0,b.top=-a.height/2-a.top,a.height+a.top>e.height)b.height=e.height}else if(a.height+a.top>e.height)c=!0,b.top=-a.height/2-(a.height+a.top-e.height);b.clipNeeded=c;return b};b=function(){j.primaryCanvas.canvas.forEachObject(function(b){b.areaId===a&&b.remove()});G?j.primaryCanvas.childCanvas[a].canvas.forEachObject(function(b){var g=f.util.object.clone(b);
if(!G&&g.type==="group")for(var h=g.getObjects(),i=0;i<h.length;i++)h[i].text&&(b=f.util.object.clone(h[i]),b.top+=g.top,b.top+=g.top,g=b);j.primaryCanvas.canvas.calcOffset();j.primaryCanvas.canvas.add(g);if(g.type==="image"){g.sendToBack();try{var m={},l,k,o,n;l=g.getBoundingRect();m=p(l);k=new f.Rect({left:e.left,top:e.top,height:e.height,width:e.width,selectable:!1,fill:"none",strokeWidth:0,opacity:0});j.primaryCanvas.canvas.add(k);o=function(a){return a*(Math.PI/180)};n=function(a,b){b.setCoords();
a.save();a.translate(-(b.width/2)+k.strokeWidth,-(b.height/2)+k.strokeWidth);a.rotate(o(b.angle*-1));a.scale(1,1);a.beginPath();a.rect(k.left-b.oCoords.tl.x,k.top-b.oCoords.tl.y,k.width,k.height);a.closePath();a.restore()};g.clipTo=function(a){return n(a,g)}}catch(q){}}g.type==="text"?g.text.replace(/\s/g,"")===""?j.primaryCanvas.canvas.remove(g):(m={},l=g.getBoundingRect(),m=p(l),m.clipNeeded?(c=g.toDataURL(),f.Image.fromURL(c,function(b){b.set({top:l.top+e.top,left:l.left+e.left,selectable:!1,areaId:a});
j.primaryCanvas.canvas.remove(g);g=b;j.primaryCanvas.canvas.add(b);b.clipTo=function(a){a.rect(m.left,m.top,m.width,m.height)};j.primaryCanvas.canvas.renderAll();d.debounce(j.updateThumbnail(),50)})):(g.left+=e.left,g.top+=e.top,g.areaId=a)):(g.left+=e.left,g.top+=e.top,g.areaId=a);g.setCoords()}):(c=j.primaryCanvas.childCanvas[a].canvas.toDataURL("png"),f.Image.fromURL(c,function(b){b.set({height:e.height,width:e.width,top:e.top,left:e.left,selectable:!1});b.areaId=a;j.primaryCanvas.canvas.add(b);
j.primaryCanvas.canvas.renderAll();d.debounce(j.updateThumbnail(),50)}));j.primaryCanvas.canvas.renderAll()};o?(j.primaryCanvas.childCanvas[a].canvas.deactivateAll(),b(),j.primaryCanvas.childCanvas[a].canvas.setActiveObject(o)):b()}d.debounce(j.updateThumbnail(),50);j.primaryCanvas.childCanvas[a].enableBuyBox=!!i;l.buybox.verify()}};j.updateThumbnail=function(){if(!j.widget.showThumbnail)return null;try{if(j.customizationType==="TextPrinting"&&!G){var b=j.primaryCanvas.canvas.toDataURL("png");j.getThumbnailImage().html("<img src='"+
b+"' class='thumbnail-image "+j.id+"' />")}else{var c,d,e,g,i;c=a.defaults.thumbnailHeight/a.defaults.galHeight;i=j.getThumbnailImage();if(!i.find(".ieThumbnail-bg").length)d=h("<img />",{"class":"ieThumbnail-bg",src:j.data.preview.url,alt:"Thumbnail Image",height:a.defaults.thumbnailHeight+"px",width:a.defaults.thumbnailWidth="px"});i.html(d);e=function(a,b){var d,e,g,i,m,l;e=a.position.y*c;g=a.position.x*c;i=a.dimension.height*c;m=a.dimension.width*c;l=a.angle?o.specifications.angle:0;d=document.createElement("canvas");
d.id="thumbnail-"+j.id+"-area-"+b;d.className+="thumbnail-canvasArea";d.height=i;d.width=m;j.getThumbnailImage().append(d);d.getContext("2d");i=new f.Canvas(d.id);l="rotate("+l+"deg)";h(d).parent(".canvas-container").css({position:"absolute",top:e+"px",left:g+"px","-ms-transform":l,"-webkit-transform":l,transform:l});return i};for(b=0;b<j.childCanvasList.length;b++)h("#thumbnail-"+j.id+"-area-"+b).length?(g=j.miniThumbnailCanvas[b],g.clear()):(g=e(j.childCanvasList[b].data.specifications,b),j.miniThumbnailCanvas[b]=
g),j.customizationType==="ImagePrinting"?j.childCanvasList[b].canvas.forEachObject(function(a){var b=f.util.object.clone(a);g.calcOffset();g.add(b);b.top=a.top*c;b.left=a.left*c;b.scaleX*=c;b.scaleY*=c;b.selectable=!1;g.deactivateAll();b.type!=="text"&&b.sendToBack();b.setCoords();g.renderAll()}):j.customizationType==="TextPrinting"&&function(a,b){f.Image.fromURL(a,function(a){b.add(a);a.scaleX=c;a.scaleY=c;a.selectable=!1;b.renderAll()})}(j.childCanvasList[b].canvas.toDataURL("png"),g);if(j.data.mask&&
j.data.mask.url&&!i.find(".ieThumbnail-mask").length){var m=h("<img />",{"class":"ieThumbnail-mask",src:j.data.mask.url,alt:"Thumbnail Mask Image"});h(m).load(function(){var a,b;a=this.naturalHeight;b=this.naturalWidth;h(this).height(a*c).width(b*c)});i.find(".canvas-container").after(m)}}}catch(l){return console.log(l),null}};j.activateSurface=function(){l.setActiveSurface(j.id);j.customizationType==="ImagePrinting"&&(j.getActiveArea().resetControls(),j.getActiveArea().controlRenderingHandle());
j.customizationType==="TextPrinting"&&h("#ac-simple-text-font-picker",h("div[data-surface='"+j.id+"']")).val(j.font)};j.bindEvents=function(){h(".thumbnail-container .ac-thumbnail.surface-0").addClass("active");h(".thumbnail-container").delegate('[ac-target="'+j.id+'"]',"click",function(){if(h('.ac-preview-container[data-surface="'+j.id+'"]').css("display").toLowerCase()==="block")return null;h(".ac-thumbnail").removeClass("active");h(".ac-thumbnail."+j.id).addClass("active");g.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&
h(".ac-thumbnail."+j.id).removeClass("error");h(".ac-preview-container").css("display","none").parent().find('[data-surface="'+j.id+'"]').css("display","block");j.customizationType==="ImagePrinting"?(h(".ac-controls-container").css("display","none").parent().find(".ac-controls-container.ac-image-text-control").css("display","block"),j.data.areas[0].customizationTypeSettings.ImagePrinting.galleries&&C(),h(".ac-single-text-preview-guideline").css({display:"none"})):(h(".ac-controls-container").css("display",
"none").parent().find('[data-surface="'+j.id+'"]').css("display","block"),h(".pc-two-column-layout .ac-delete-button").fadeOut(),h(".ac-single-text-preview-guideline").css({display:"block"}));j.activateSurface()});return C};j.notifySubscribers=function(a,b){switch(a){case "colorpicker":j.color=b;for(var c=0;c<j.childCanvasList.length;c++)j.childCanvasList[c].controls.simpleTextInput&&(j.childCanvasList[c].controls.simpleTextInput.changePreview(),n.trigger("amazon-custom-log-ref-tag","FontColorChange"));
break;case "fontpicker":j.font=b;for(c=0;c<j.childCanvasList.length;c++)j.childCanvasList[c].controls.simpleTextInput&&(j.childCanvasList[c].controls.simpleTextInput.changePreview(),n.trigger("amazon-custom-log-ref-tag","FontChange"))}};j.bindControls=function(){var a=h(".ac-surface-control."+j.id),c;h.each(a,function(a,d){c=h(d).attr("data-control-template");switch(c){case "colorpicker":var g=new e(d,j);j.controls.colorPicker=g;break;case "fontpicker":g=new b(d,j),j.controls.fontPicker=g}})};j.initiateEvents=
function(){};j.fulfillmentJSON=function(){var a={},b=[];a.name=j.name;if(h("#amazonCustomUseCaseId").length&&h("#amazonCustomUseCaseId").val()==="AC_ImgTxtPersonalization_3"){a.images={};if(m.preview&&m.preview.url)a.images.previewUrl=m.preview.url;if(m.mask&&m.mask.url)a.images.maskUrl=m.mask.url;if(j.customizationType==="TextPrinting"){a.font={};if(j.font.substring(0,3)==="ac_"){a.font.isDefault=0;var c=j.data.FontSettings.fonts.filter(function(a){if(a.name===j.fontName)return!0});if(c.length===
1)a.font.fontUrl=c[0].fontURL}else a.font.isDefault=1;a.font.fontName=j.fontName}a.id=j.id}for(c=0;c<j.childCanvasList.length;c++)b.push(j.childCanvasList[c].fulfillmentJSON());a.areas=b;return a};j.init=function(){j.name=m.name;j.isActive=m.isActive;j.id="surface-"+m.index;j.productImageUrl=m.preview.productImageUrl;j.maskImageUrl=m.preview.maskImageUrl;j.primaryCanvas=j.setPrimaryCanvas();j.childCanvasList=v(j.primaryCanvas);j.bindEvents();j.bindControls();j.initiateEvents()};j.init();return j}})})();
(function(){s.when("A","ac-base","ready").register("ac-utils",function(n,k){var f=n.$,d,c,e,b;d={};c=function(a){var b=null;try{b=n.state(a)?n.state(a):null}catch(c){b=null}finally{return b}};b=function(){for(var a=f(".pc-customization-enabled script"),b=0,c=a.length;b<c;b++)if(!f.data(a[b],"a-eval")){var d=f(a[b]),e=d.attr("data-a-state");e&&(e=n.parseJSON(e),e.key&&(d=n.parseJSON(d.html()),n.state.replace(e.key,d)))}return!0};d.init=function(){b();e=c("wssStringArray")};d.getState=function(a,d){if(d){var g=
!1,g=b();if(!g)return}e||(e=c("wssStringArray"));return c(a)};d.validator=function(){var a={AlphaNumeric:function(){return!0},Digits:function(a){return/^[\s\d]*$/.test(a)}};return{Validate:function(b,c){return a[c]!==y&&typeof a[c]==="function"?a[c](b):!0}}};d.debounce=function(a,b,c){var d;return function(){var e=this,f=arguments,k=c&&!d;clearTimeout(d);d=setTimeout(function(){d=null;c||a.apply(e,f)},b);k&&a.apply(e,f)}};d.showDialog={show:function(a,b,c){c&&c.ok&&f(".ac-btn.ac-btn-dialog-ok").text(c.ok);
c&&c.cancel&&f(".ac-btn.ac-btn-dialog-cancel").text(c.cancel);a&&f("#ac-dialog-confirm p").html(a);f("#ac-dialog-confirm").fadeIn();f(".ac-image-backdrop").fadeIn();f("#ac-dialog-confirm").undelegate(".ac-btn-dialog-ok","click");f("#ac-dialog-confirm").delegate(".ac-btn-dialog-ok","click",function(){f("#ac-dialog-confirm").fadeOut();f(".ac-image-backdrop").fadeOut();b()});f("#ac-dialog-confirm").undelegate(".ac-btn-dialog-cancel","click");f("#ac-dialog-confirm").delegate(".ac-btn-dialog-cancel","click",
function(){f("#ac-dialog-confirm").fadeOut();f(".ac-image-backdrop").fadeOut();c&&c.cancelCallBack&&c.cancelCallBack();d.imageLoading.hide()})}};d.imageLoading={show:function(){f(".ac-image-loader").fadeIn();f(".ac-image-backdrop").fadeIn()},hide:function(){f(".ac-image-loader").fadeOut();f(".ac-image-backdrop").fadeOut()}};d.arrFilterUnique=function(a){return a.filter(function(a,b,c){return c.indexOf(a)===b})};d.stringHandler=function(a){return e&&e[a]?e[a]:""};d.getScaleRatio=function(){var a=1;
if(k.isApp()){var b=f(".ac-surface-background-image"),a=b.width();b.height();b=b.get()[0].naturalWidth;a/=b}return a};return d})})();(function(){s.when("A","fabric-js","ac-base","BuyBox","ac-constants","ac-surface","ac-utils","ac-gallery","ac-image-gallery","acc-weblab","ready").register("ac-widget",function(n,k,f,d,c,e,b,a,i,g){var h=n.$;return function(){var i=this,l,o;i.surfaceList=[];i.data={};i.showThumbnail=!0;i.acTempCanvas=new k.Canvas("acTempCanvas");o=function(){h(".pc-two-column-layout").delegate(".ac-delete-button",
"click",function(){var a=i.getActiveArea();a.canvas.forEachObject(function(b){var c;if(b&&b.active||b&&b.name&&b.name==="galImage"){if(b.type&&b.type==="text")c=a.controls.textInput.cleared;if(b.name&&b.name==="cusImage")c=a.controls.imageUpload.cleared;c&&c();a.canvas.remove(b)}});a.canvas.discardActiveGroup();h(".pc-two-column-layout .ac-delete-button").fadeOut();a.renderAll()})};i.getActiveSurface=function(){for(var a=null,b=0;b<i.surfaceList.length;b++)i.surfaceList[b].isActive===!0&&(a=i.surfaceList[b]);
return a};i.setActiveSurface=function(a){for(var b=0;b<i.surfaceList.length;b++)if(i.surfaceList[b].isActive=!1,i.surfaceList[b].id===a)i.surfaceList[b].isActive=!0};i.getActiveArea=function(){return i.getActiveSurface().getActiveArea()};i.fulfillmentJSON=function(){var a={},b=[],d=[],e,g;g=i.acTempCanvas;g.setDimensions(c.outputSVGDimention);e=function(a){var b=c.scaleRatio,d,e,f,i;f=parseInt(h(a.lowerCanvasEl).parent(a.wrapperEl).css("top").replace("px",""),10);i=parseInt(h(a.lowerCanvasEl).parent(a.wrapperEl).css("left").replace("px",
""),10);g.clear();a.forEachObject(function(a){a=k.util.object.clone(a);a.type!=="rect"&&(g.calcOffset(),g.add(a),a.type==="image"&&(a.sendToBack(),d=a.getSrc()),a.type==="text"&&a.text.replace(/\s/g,"")===""&&g.remove(a),a.top+=f,a.left+=i,a.scaleX*=b,a.scaleY*=b,a.left*=b,a.top*=b,a.setCoords())});g.renderAll();d&&d.indexOf("._")!==-1&&d.indexOf("._")!==-1?(e=d.split("._")[0]+"."+d.split("_.")[1],a=g.toSVG(null,function(a){return a.replace(RegExp(/xlink:href=\"\S*\"/),'xlink:href="'+e+'"').replace(/(<tspan\s(.*?)>)(.*?)(<\/tspan>)/g,
"$1<![CDATA[$3]]\>$4")})):a=g.toSVG(null,function(a){return a.replace(/(<tspan\s(.*?)>)(.*?)(<\/tspan>)/g,"$1<![CDATA[$3]]\>$4")});return a};a.customizationInfo={fulfillmentDetails:i.data.fulfillmentDetails,"version3.0":{surfaces:[]}};a.merchantId=f.getMerchantID();for(var l=0;l<i.surfaceList.length;l++)b.push(i.surfaceList[l].fulfillmentJSON());for(l=0;l<b.length;l++)for(var o=0;o<b[l].areas.length;o++)b[l].areas[o].fulfillmentType==="SVG"?(b[l].areas[o].svgImage=e(b[l].areas[o].canvas),delete b[l].areas[o].canvas):
b[l].areas[o].fulfillmentType||b[l].areas.splice(o,1);for(l=0;l<b.length;l++)b[l].areas.length&&d.push(b[l]);a.customizationInfo["version3.0"].surfaces=d;return a};i.bindControls={galleryImage:function(){n.on("addGalleryImage",function(a){var c,d,e,g=!1;c=i.getActiveSurface();n.trigger("amazon-custom-log-ref-tag","logVendorGalleryTabClick");d=c.getActiveArea();if(d.getObjects().length===1&&d.getObjects()[0].name==="galImage"&&d.getObjects()[0].getSrc()===a.imageUrl)return null;c=b.stringHandler("pc-clear-custom-msg");
e=function(){i.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var c=b.getObjects(),d=!1,e=0;e<c.length;e++)c[e].name&&c[e].name==="galImage"&&c[e].getSrc()===a.imageUrl&&(d=!0);d||b.clear()})});d.addGalleryImage(a)};for(var f=0;f<i.surfaceList.length;f++){for(var h=0;h<i.surfaceList[f].childCanvasList.length;h++){var l,k=i.surfaceList[f].childCanvasList[h];l=k.getObjects();for(var o=k.canvas.size()-1;o>=0;o--)if(l[o].type==="text"&&!l[o].text.replace(" ","").length)l[o].remove(),
k.controls.textInput.isControlActive=!1;else if(l[o].name&&l[o].name==="cusImage"||l[o].type==="text"){g=!0;break}if(g)break}if(g)break}g?b.showDialog.show(c,e,{ok:"Clear"}):e()})},uploadImage:function(){n.off("addCustomerImage");n.on("addCustomerImage",function(a){var c,d,e,g=!1;c=i.getActiveSurface().getActiveArea();c.getObjects();d=b.stringHandler("pc-clear-design-msg");e=function(){i.surfaceList.forEach(function(a){a.childCanvasList.forEach(function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)b[c].name&&
b[c].name==="galImage"&&a.clear()})});c.addCustomerImage(a)};i.surfaceList.forEach(function(a){a.childCanvasList.forEach(function(a){for(var a=a.getObjects(),b=0;b<a.length;b++)if(a[b].name&&a[b].name==="galImage"){g=!0;break}})});g?b.showDialog.show(d,e,{ok:"Clear"}):e()});h(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-imageUpload","click",function(){h(".ac-imageUpload-control").addClass("active");h(".ac-btn-makeOwn.ac-imageUpload").addClass("active");h(".ac-textInput-control").removeClass("active");
h(".ac-btn-makeOwn.ac-textInput").removeClass("active");i.getActiveSurface().getActiveArea().setActiveControl("imageUpload");n.trigger("amazon-custom-log-ref-tag","logCustomImageTabClick")})},textOnImage:function(){(function(){h("#pcTextArea").unbind().bind("keyup",function(){var a=h(this).val().replace('"',"''");h(this).val(a);if(a.length>50)return a=a.substring(0,50),h(this).val(a),null;i.getActiveArea().controls.textInput.imgText.updateText(a);h(this).val()});h(".pc-textArea-fontStyle-li").unbind().bind("click",
function(){h(this).toggleClass("button-active");var a=h(this).attr("data-style");a+=h(this).hasClass("button-active")?"on":"off";i.getActiveArea().controls.textInput.imgText.toggleStyle(a)});h(".pc-textArea-fontAlign-li").unbind().bind("click",function(){h(".pc-textArea-fontAlign-li").removeClass("button-active");h(this).addClass("button-active");var a=h(this).attr("data-align");i.getActiveArea().controls.textInput.imgText.changeAlign(a)});n.off("a:dropdown:fontPicker:select");n.on("a:dropdown:fontPicker:select",
function(a){i.getActiveArea().controls.textInput.imgText.changeFont(a.value)});h(".pc-textArea-fontColor-li").unbind().bind("click",function(){i.getActiveArea().controls.textInput.imgText.changeTextColor(h(this).find("div").attr("data-color"))});n.off("a:popover:show:text-color");n.on("a:popover:show:text-color",function(a){a.popover.$popover.css("z-index",999999)});n.off("slideUpTextArea");n.on("slideUpTextArea",function(){var a=h(".pc-textArea-overlay");a.parents().is(":hidden")?a.hide():a.slideUp(100,
function(){h("#pcTextArea").focus()})});n.off("slideDownTextArea");n.on("slideDownTextArea",function(){h(".pc-textArea-overlay").slideDown()})})();h(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-textInput","click",function(){var a;h(".ac-imageUpload-control").removeClass("active");h(".ac-btn-makeOwn.ac-imageUpload").removeClass("active");h(".ac-textInput-control").addClass("active");h(".ac-btn-makeOwn.ac-textInput").addClass("active");a=i.getActiveArea();a.controls.textInput.imgText.updateControl();
a.controls.textInput.imgText.select();a.setActiveControl("textInput");n.trigger("slideUpTextArea");n.trigger("amazon-custom-log-ref-tag","logAddTextTabClick")})}};i.initiateBuyBox=function(){(new d({controller:{getJSON:i.fulfillmentJSON}})).Init()};i.buybox={enable:function(){n.trigger("enableBuybox")},disable:function(){n.trigger("disableBuybox")},block:function(a){n.trigger("blockBuybox",a)},unblock:function(){n.trigger("unblockBuybox")},showMissingCustomization:function(a){n.trigger("showMissingCustomization",
a)},hideMissingCustomization:function(){n.trigger("hideMissingCustomization")},showMissingRequiredFields:function(a){n.trigger("showMissingRequiredFields",a)},hideMissingRequiredFields:function(){n.trigger("hideMissingRequiredFields")},showContainingEmoji:function(a){n.trigger("showContainingEmoji",a)},hideContainingEmoji:function(){n.trigger("hideContainingEmoji")}};i.buybox.verify=g.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")?function(){var a=!1,b,c,d=[];i.buybox.unblock();i.buybox.hideMissingRequiredFields();
i.buybox.hideMissingCustomization();i.buybox.hideContainingEmoji();if(n.reduce(i.surfaceList,function(a,b){return a||b.hasRequiredField()},!1)){a=!0;for(b=0;b<i.surfaceList.length;b++){c=i.surfaceList[b];var e=c.requiredFieldsAreValid();e||d.push(c);a=a&&e}a=!a;b=function(){n.each(d,function(a){a.emphasizeMissingFields()});i.buybox.showMissingRequiredFields({error:!0})}}else a=!n.reduce(i.surfaceList,function(a,b){return a||b.enableBuyBox()},!1),b=function(){i.buybox.showMissingCustomization({error:!0})};
(c=n.reduce(i.surfaceList,function(a,b){return a||b.containsEmoji()},!1))&&(b=function(){i.buybox.showContainingEmoji({error:!0})});(a||c)&&i.buybox.block({callback:b});i.buybox.enable()}:function(){for(var a=!1,b=0;b<i.surfaceList.length;b++)if(i.surfaceList[b].enableBuyBox()){a=!0;break}a?i.buybox.enable():i.buybox.disable()};i.init=function(){var c,d,g=!1,f=[],k;b.init();d=b.getState("ctsStateData",!0);i.data=d;for(var n=0;n<d.surfaces.length;n++){c=d.surfaces[n];c.index=n;n===0?c.isActive=!0:
c.isActive=!1;c=new e(c,i);if(n===0)c.isActive=!0,c.customizationType==="ImagePrinting"?(h(".ac-single-text-preview-guideline").css({display:"none"}),h(".ac-image-text-preview-guideline").css({display:"block"})):h(".ac-single-text-preview-guideline").css({display:"block"});if(c.customizationType==="ImagePrinting"){var g=!0,C=c.data.areas[0].customizationTypeSettings.ImagePrinting.galleries;if(C&&C.length&&(f=f.concat(C),!k&&c.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery))k=
c.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery}i.surfaceList.push(c)}if(d.surfaces.length===1&&d.surfaces[0].areas[0].customizationType==="TextPrinting")h(".thumbnail-container").fadeOut("fast"),h(".ac-image-text-preview-guideline").fadeOut("fast"),h(".pc-two-column-layout .pc-input-controls").addClass("ac-single-text-only"),h(".pc-two-column-layout .ac-controls-container").addClass("ac-single-text-only"),h(".pc-two-column-layout").addClass("ac-single-text-only"),h(".pc-atc-wrapper").addClass("a-button-span12"),
h(".ac-price").addClass("ac-single-text-only"),h(".ac-quantity").addClass("ac-single-text-only"),i.showThumbnail=!1;f=b.arrFilterUnique(f);o();i.initiateBuyBox();g===!0&&(f.length&&(l=new a(null,f,k),l.Fetch()),i.bindControls.galleryImage(),i.bindControls.uploadImage(),i.bindControls.textOnImage())}}})})();s.when("A","ready").execute(function(n){function k(){f("html").hasClass("a-canvas")||(f(".pc-customization-disabled").addClass("active"),f(".pc-customization-enabled").remove())}var f=n.$;n.on("pc-single-text-loaded",
function(){k()});k()});s.when("A","a-modal","ac-utils","ac-widget","ac-base","ready").execute(function(n,k,f,d){function c(){if(e(".ac-mobile-app").length>=1){var a=e(".ac-surface-background-image"),b=a.width(),a=a.height();f.getScaleRatio();e(".canvas-container > .ac-parent-canvas").attr({width:b,height:a}).css({width:b+"px",height:a+"px"});e(".canvas-container .canvasArea").each(function(a,b){var c=e(b).attr("data-initial-top"),d=e(b).attr("data-initial-left"),i=e(b).attr("data-initial-width"),
j=e(b).attr("data-initial-height"),k=f.getScaleRatio();c!==y&&d!==y&&(e(b).attr({"data-top":parseInt(c,10)*k,"data-left":parseInt(d,10)*k}),e(b).parent().css({top:parseInt(c,10)*k,left:parseInt(d,10)*k,width:i+"px",height:j+"px"}))});e(".ac-preview-container").css({"min-height":a+10});n.trigger("resize-preview-text")}}var e=n.$,b=[];n.on("a:popover:afterShow:pc-buybox-secondary-view",function(){c();e("#pc-customize-now-div").attr("data-customization-clicked")==="false"&&((new d).init(),e("#pc-customize-now-div").attr("data-customization-clicked",
"true"));n.on("resize-preview",function(){c()})});n.on("a:popover:afterHide:pc-popover-content",function(){n.trigger("amazon-custom-log-ref-tag","CloseClick");n.trigger("amazon-custom-popup-close",new Date)});e("html").hasClass("a-canvas")&&(e(".pc-customization-disabled").remove(),n.declarative("popover-trigger","click",function(){var a=e(".pc-popover-button"),c=k.get(a);n.trigger("amazon-custom-log-ref-tag","CustomizeNowClick");if(c===null){if(b.length>0){for(c=0;c<b.length;c++)k.remove(b[c]);b.length=
0}c=k.create(a,{name:"pc-popover-content",header:e(".pc-popover-header").html(),activate:"onclick"});e(".pc-popover-header").remove();c.lock().show();b.push(c);a=e("#ASIN",e(".pc-buy-box",e(".pc-two-column-layout"))).val();e(".pc-two-column-layout").attr("asin",a);(new d).init()}}))});(function(){s.when("A","fabric-js","ac-utils","ac-base","ac-constants","acc-weblab","ready").register("ac-simple-textInput",function(n,k,f,d,c,e){var b=n.$;return function(a,i,g){var h={},m,l,o;d.isApp()?(h.inputBox=
b(a).find(".pc-simple-text-input input"),h.errorClassTarget=b(a).find("div.pc-simple-text-input")):(h.inputBox=b(a).find("input.pc-simple-text-input"),h.errorClassTarget=h.inputBox);h.isRequiredLabel=b(a).find(".isRequiredLabel");h.maxLength=parseInt(h.inputBox.attr("maxLength"),10);h.textLimitElement=b(a).find(".pc-char-limit-length");h.charType=b(h.inputBox).data("input-type");h.acCanvas=i;h.options=g;h.isEmpty=function(){var a=!1;h.inputBox.val().replace(/\s/g,"")===""&&(a=!0);return a};h.isValid=
function(){return f.validator().Validate(h.inputBox.val(),h.charType)&&!h.isEmpty()};h.detectEmoji=function(){return c.emojiMatchPattern.test(h.inputBox.val())};h.cleared=function(){h.inputBox.val("")};h.hasRequiredField=function(){return i.data&&i.data.customizationTypeSettings&&i.data.customizationTypeSettings.TextPrinting&&!!i.data.customizationTypeSettings.TextPrinting.isRequired};h.requiredFieldsAreValid=function(){return h.hasRequiredField()?h.isValid():!0};h.hideIsRequiredLabel=function(){b(h.isRequiredLabel).hide()};
h.emphasizeMissingField=function(){h.addErrorClass();b(h.isRequiredLabel).addClass("a-color-error")};h.containsEmoji=function(){return h.isValid()&&h.detectEmoji()};h.addErrorClass=function(){e.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")?h.errorClassTarget.addClass("a-form-error"):h.inputBox.addClass("a-form-error")};h.removeErrorClass=function(){e.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")?h.errorClassTarget.removeClass("a-form-error"):h.inputBox.removeClass("a-form-error")};h.changePreview=function(a){a||
(a=h.inputBox.val());if(h.acCanvas.canvasObjects[h.acCanvas.id]!==y){var b=h.acCanvas.canvasObjects[h.acCanvas.id];b.forEachObject(function(a){h.acCanvas.canvasObjects[h.acCanvas.id].removeWithUpdate(a)});h.acCanvas.canvas.remove(b)}if(a&&a.replace(/\s+/g,"").length){b={fontFamily:h.acCanvas.surface.font,fontSize:h.acCanvas.canvas.height,fill:h.acCanvas.surface.color,selectable:!1,textAlign:"center",originX:"center",originY:"center",lockMovementX:!0,lockMovementY:!0,lineHeight:1.3/1.13};if(d.isApp())b.fontSize=
Math.round(h.acCanvas.canvas.height);a=new k.Text(a,b);b={originX:"center",originY:"center",fill:"",opacity:0,width:h.acCanvas.canvas.width,height:h.acCanvas.canvas.height,selectable:!1,lockMovementX:!0,lockMovementY:!0,clipTo:function(a){a.rect(-(h.acCanvas.canvas.width/2),-(h.acCanvas.canvas.height/2),h.acCanvas.canvas.width,h.acCanvas.canvas.height+5)}};if(d.isApp())b.width=Math.round(h.acCanvas.canvas.width),b.height=Math.round(h.acCanvas.canvas.height);var b=new k.Rect(b),c={left:0,top:0,width:h.acCanvas.canvas.width,
height:h.acCanvas.canvas.height,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,selectable:!1,name:"simple-text"};if(d.isApp())c.width=Math.round(h.acCanvas.canvas.width),c.height=Math.round(h.acCanvas.canvas.height);c=new k.Group([b,a],c);h.acCanvas.canvasObjects[h.acCanvas.id]=c;h.acCanvas.canvas.add(c);l(a,b)}else h.acCanvas.renderAll();d.isApp()&&h.acCanvas.surface.updateTickerOnTab()};l=function(a){var c,d;b(".parentReferenceDiv").length?c=b(".parentReferenceDiv"):(c=b(document.createElement("div")),
b(".ac-image-backdrop").after(b(c)));d=b(".referenceDiv").length?b(".referenceDiv"):b(document.createElement("div"));b(c).addClass("parentReferenceDiv");b(d).addClass("referenceDiv");b(d).css({"font-family":h.acCanvas.surface.font,"font-size":a.getFontSize()});b(d).text(a.text);for(b(c).html(b(d));a.getWidth()>h.acCanvas.canvas.width-h.acCanvas.canvas.width*0.1||b(d).height()>h.acCanvas.canvas.height-h.acCanvas.canvas.height*0.1;)if(c=a.getFontSize(),c>2)c-=1,a.setFontSize(c-1),b(d).css({"font-size":c+
"px"}),a.set({top:-c*(1.3/1.13)*(1-1/1.13)*0.5}),a.setCoords();else break;h.acCanvas.renderAll()};o=function(){var a=h.inputBox.val(),c=parseInt(a.length,10),d=parseInt(h.maxLength,10),g=d;h.textLimitElement.length>0&&(g=d-c,g<0?(h.textLimitElement.html(0),h.inputBox.val(a.substring(0,d))):h.textLimitElement.html(g));h.isValid()?(h.removeErrorClass(),e.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&b(h.isRequiredLabel).removeClass("a-color-error"),h.inputBox.siblings(".pc-input-invalid").removeClass("active"),
h.changePreview(a)):(h.isEmpty()&&h.changePreview(a),h.isEmpty()?(h.inputBox.siblings(".pc-input-invalid").removeClass("active"),h.removeErrorClass()):(h.inputBox.siblings(".pc-input-invalid").addClass("active"),h.addErrorClass()),h.changePreview(""))};m=function(){h.inputBox.bind("keyup",function(){o()});h.inputBox.bind("change",function(){o()});h.inputBox.bind("cut",function(){setTimeout(function(){o()},100)});h.inputBox.bind("paste",function(){setTimeout(function(){o()},100)})};h.init=function(){m()};
h.init();return h}})})();(function(){s.when("A","a-popover","ac-utils","ac-base","ready").register("ac-color-picker",function(n,k,f,d){var c=n.$;return function(e,b){var a={};a.elem=e;a.notify=function(a){b.notifySubscribers("colorpicker",a)};a.bindEvents=function(){c(".ac-color-li",a.elem).bind("click",function(){var b=c(this).find("div").attr("data-color"),d=k.get(c(".ac-color-picker-trigger",a.elem).parent());c(".ac-simplecolorpicker",a.elem).css("background-color",b);a.notify(b);d.hide()})};a.init=
function(){c(".ac-is-single-color").length===c(".ac-controls-container").length?(a.notify(c(".ac-is-single-color").attr("data-color")),d.isApp()&&c(".ac-colorpicker").hide()):(a.bindEvents(),a.notify(c(".ac-color-li",a.elem).find("div").attr("data-color")))};a.init();return a}})})();(function(){s.when("A","a-dropdown","ac-utils","ready").register("ac-font-picker",function(n,k){var f=n.$;return function(d,c){var e={};e.elem=d;e.notify=function(b){c.notifySubscribers("fontpicker",b)};e.init=function(){f(".ac-simple-text-font-picker",
d);var b;f(".ac-mobile-app").length>=1&&(b="pcFont"+f("#a",f("#addToCart")).val(),b=k.getSelect(b),b.update({option_prompt:b.getOption(0).info()[0].text}),b.getOptions().size()===1&&(b.update({status:"disabled"}),f(".ac-fontpicker").hide()));f("select",f(".ac-simple-text-font-picker",f("div[data-surface='"+c.id+"']"))).change(function(){var a=f(this).val();c.fontName=f(this).find("option:selected").text();e.notify(a)});f("select option:first-child",f(".ac-simple-text-font-picker")).click().change()};
e.init();return e}})})();(function(){s.when("A","ready").register("ac-constants",function(){return{AssetType:{IMAGE:"image"},StatusCode:{NON_HTML5_BROWSER:"NON-HTML5-BROWSER",NON_IMAGE_TYPE:"NON-IMAGE-TYPE",INVALID_FILE_TYPE:"INVALID_FILE_TYPE",READ_SUCCESS:"READ-SUCCESS",READ_NOT_REQUIRED:"READ_NOT_REQUIRED",INVALIDFILESIZE:"INVALID-FILE-SIZE"},defaults:{thumbnailWidth:80,thumbnailHeight:80,thresholdImageWidth:50,thresholdImageHeight:50,galWidth:400,galHeight:400},scaleRatio:8,outputSVGDimention:{height:3200,
width:3200},textDefaults:{fontFamily:"Arial, Helvetica, sans-serif",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",fill:"#FF9900",text:"",angle:0,opacity:1,fontSize:20},emojiMatchPattern:/[\u2600-\u27BF]|\uD83C[\uDDE0-\uDFFF]|\uD83D[\uDC00-\uDE4F]|\uD83E[\uDD00-\uDDFF]|\uD83D[\uDE80-\uDEFF]/}})})();(function(){s.when("A","ac-utils","ac-gallery-base","ac-constants","ac-error-handling","ready").register("ac-image-gallery",function(n,k,f,d,c){var e=n.$,b=function(){};b.prototype=
new f;b.prototype.Init=function(){};e.extend(b.prototype,{getMediaServerUrl:function(){var a="";return"https://images-na.ssl-images-amazon.com/images/S/"+this.bucket+"/"+this.getResourcePath()+"._SL80_"+this.extension},isValidFile:function(a,b){var c=d.StatusCode;if(typeof FileReader!=="undefined")if(/(jpg|jpeg|png)$/i.test(a.name.toLowerCase())){var e=new FileReader;e.onload=function(){var d=new Image,f=a.size/1024;f>7168?b({statusCode:c.INVALIDFILESIZE}):(d.onload=function(){b&&typeof b==="function"&&
b({statusCode:c.READ_SUCCESS,imageHeight:d.height,imageWidth:d.width,imageSize:f})},d.onerror=function(){b&&typeof b==="function"&&b({statusCode:c.INVALID_FILE_TYPE})},d.src=e.result)};e.readAsDataURL(a)}else b&&typeof b==="function"&&b({statusCode:c.INVALID_FILE_TYPE});else b&&typeof b==="function"&&b({statusCode:c.NON_HTML5_BROWSER})},setKey:function(){this.resourcePath=this.getResourcePath();this.extension=this.getFileExtension();this.key=this.resourcePath+this.extension},isValidFileType:function(a){return/(jpg|jpeg|png)$/i.test(a.name.toLowerCase())?
!0:!1},createResourceStub:function(a,b){var c=e(".ac-custom-image-container").clone();c.find("img").attr("id","ac-custom-image-"+b);a.parent().find("#ac-custom-upload-preview-container").append(c)},updateView:function(a,b){b===d.StatusCode.NON_HTML5_BROWSER?this.validateImage(a):this.updateImage(a)},displayWarningIfRequired:function(a){var b=d.defaults.thresholdImageWidth,e=d.defaults.thresholdImageHeight,f=a.imageHeight,m=a.imageWidth,a=f>m?f:m,f=f>m?m:f;c.hide();f<b||a<e?c.show("pc-resolution-warning"):
c.hide()},updateImage:function(a){var b=this.getMediaServerUrl(),d,f;d=e("<div>").addClass("customer-image-container");f=e("<img>").addClass("a-declarative customer-uploaded-image");f.attr({id:"#ac-custom-image-"+a.resourceIndex,src:b,"data-original-url":a.pcImageUrl,"data-original-width":a.imageWidth,"data-original-height":a.imageHeight,"data-preview-url":a.pcImageUrl,"data-action":"customer-uploaded-image","data-token":a.imageToken});a=e("<div>").addClass("swatch-arrow");d.append(f);d.append(a);
f.load(function(){f.trigger("click");e(".ac-uploaded-image").prepend(d);e(".ac-select-uploaded-image").fadeIn()}).error(function(){f.parent(".customer-image-container").remove();c.show("pc-image-mime-type-incorrect");e(".ac-select-uploaded-image").fadeOut();k.imageLoading.hide()})},validateImage:function(a){var b={bucketName:this.getBucket(),fileKey:a.imageToken.split("/")[1]},d=this;k.imageLoading.show();n.ajax("/gp/product/features/callValidateImage.html/ref=dp_pc_val_img",{method:"POST",params:b,
success:function(b){b.result.isValid==="1"?(a.imageWidth=b.result.width,a.imageHeight=b.result.height,d.updateImage(a)):(k.imageLoading.hide(),b.result.errorString&&b.result.errorString.length?c.show(null,{type:"error",message:b.result.errorString}):c.show("pc-upload-error-message"))},error:function(){c.show("pc-upload-error-message");k.imageLoading.hide()}})},populateImageObject:function(a,b){var c={};c.imageUrl=a.attr("data-preview-url");c.isCustomerImage=b;c.element=a;return c},imageSelection:function(){var a=
this.populateImageObject,b=this.displayWarningIfRequired;n.declarative.remove("customer-uploaded-image","click");n.declarative("customer-uploaded-image","click",function(c){var d=a(c.$currentTarget,!0);e(".selected.customer-image-container").removeClass("selected");c.$currentTarget.parent().addClass("selected");n.trigger("addCustomerImage",d);b({imageWidth:c.$currentTarget.attr("data-original-width"),imageHeight:c.$currentTarget.attr("data-original-height")});k.imageLoading.show()})},scaleImage:function(a){var b,
c,f,m;c=parseInt(e(a.element).attr("data-original-width"),10)/d.scaleRatio;parseInt(e(a.element).attr("data-original-height"),10);b=/[.]/.exec(a.imageUrl)?/[^.]+$/.exec(a.imageUrl):y;a=a.imageUrl.split(b[0]);f=b[0];m="";f.toLowerCase()==="png"&&(m="_AL__FMPng_");return a[0]+"_SX"+c+"_"+m+"."+b[0]}});return b})})();(function(){s.when("A","ac-base").register("ac-gallery",function(n,k){var f=n.$,d;d=function(c,d,b){var a=this;this.options=f.extend({thumbnailWidth:80,thumbnailHeight:80,pageSize:100,categoryContainerSelector:"#ac-gallery",
enableLazyLoading:!0,confineToContainerSelector:"body"},c);var i=f(a.options.confineToContainerSelector),g,h=y,m={checkIfCategoryAlreadyLoaded:function(a){var b=!1,c="";f('.theme-image-container[data-theme="'+a+'"]').length>0?(c=f('.theme-image-container[data-theme="'+a+'"]'),b=!0):c=f("<div>").addClass("theme-image-container").attr({"data-theme":a});return{container:c,isEmpty:!b}},checkIfCategoryExistsInObject:function(a){for(var b=g.contentLibraryList.length,c=0,d=!1,c=0;c<b;c+=1)if(g.contentLibraryList[c].title===
a||g.contentLibraryList[c].contentLibraryId===a){d=!0;break}return d},formatResponseObject:function(a){if(a.inlineData!==y)a.contentLibraryList=a.inlineData.contentLibraryList,a.contentLibraryIds=a.inlineData.contentLibraryIds;for(var b=0;b<a.contentLibraryIds.length;b++){var c=a.contentLibraryIds[b];a.contentLibraryIds[b]=m.getFormattedName(c)}for(b=0;b<a.contentLibraryList.length;b++){var d=a.contentLibraryList[b],c=d.title;d.title=m.getFormattedName(c)}a.defaultLibrary=m.getFormattedName(a.defaultLibrary);
return a},formatNewResponseObject:function(a){if(a.contentList.length)a.contentLibraryList=[a],a.contentLibraryIds="/"+a.title;for(var b=0;b<a.contentLibraryIds.length;b++){var c=a.contentLibraryIds[b];a.contentLibraryIds[b]=m.getFormattedName(c)}for(b=0;b<a.contentLibraryList.length;b++){var d=a.contentLibraryList[b],c=d.title;d.title=m.getFormattedName(c)}a.defaultLibrary=m.getFormattedName(a.defaultLibrary);return a},getFormattedName:function(a){if(!a)return null;var b=a;a.charAt(0)==="/"&&(b=
a.substr(1,a.length));return b},getGalleryInputData:function(a){var b={};if(k.getOfferListingID()!==y)b.url="/gp/product/features/getContentLibrary.html",b.data={merchantId:k.getMerchantID(),contentLibraryName:String(a)};return b},getContentLibraryObject:function(a){if(g===h)return h;a=m.getIndexOfCategory(g.contentLibraryList,a);return a===-1?h:g.contentLibraryList[a]},getIndexOfCategory:function(a,b){var c=a.length,d;for(d=0;d<c;d+=1)if(a[d].title.toLowerCase()===b.toLowerCase())return d;return-1},
lazyload:function(){var a=f(".ac-gallery-container"),b=f(".pc-lazyload-error-message");return{success:function(){b.removeClass("active");a.show()},error:function(){a.hide();b.addClass("active");m.loading.hide()}}}(),loading:function(){var a=f(".pc-lazyload-image");return{show:function(){a.addClass("active")},hide:function(){a.removeClass("active")}}}(),populateImageObject:function(a,b){var c={},d=a.data("original-url"),d=d.substr(d.lastIndexOf("."),d.length);c.imageUrl=a.data("preview-url");c.isCustomerImage=
b;c.token=f(".pc-category-name.active").attr("data-themename")+"/"+a.attr("data-token")+d;return c}},l=y,o=function(){var b={categorySelection:function(){n.declarative.remove("category-selection","click");n.declarative("category-selection","click",function(b){var c=b.$currentTarget.attr("data-themename"),d=b.$currentTarget.attr("data-categoryid");p.BuildGallery(c);f(".ac-selected-gallery-name").html(c).attr({"data-contentId":d,title:c});f("a",f(a.options.categoryContainerSelector)).removeClass("active");
b.$currentTarget.addClass("active");f(".vendor-category",f(a.options.categoryContainerSelector)).removeClass("a-active");b.$currentTarget.parent(".vendor-category").addClass("a-active");l!==y&&l.hide()})},imageContainerScroll:function(){if(a.options.enableLazyLoading){var b=f(".ac-gallery-container");b.scroll(function(a){a.preventDefault();if(b.scrollTop()>=f(".ac-gallery-content").height()-b.height()){var a=f("a.active",f(".vendor-categories")).attr("data-themename"),c=m.checkIfCategoryAlreadyLoaded(a);
p.AppendImages(a,c,!1)}})}},imageSelection:function(){n.declarative.remove("ac-gallery-content-image","click");n.declarative("ac-gallery-content-image","click",function(a){var b=m.populateImageObject(a.$currentTarget,!1);b.vendorGalleryFileId=f(a.$target).attr("data-contentid");b.vendorGalleryId=f(".vendor-category .pc-category-name.active").attr("data-categoryid");b.originalURL=f(a.$target).attr("data-original-url");f(".selected.ac-gallery-content-container").removeClass("selected");a.$currentTarget.parent().addClass("selected");
n.trigger("hideWarningMessage");n.trigger("addGalleryImage",b);f("a.active",f(".vendor-category")).attr("data-themename")})},popover:function(){n.off("a:popover:show:vendor-categories");n.on("a:popover:show:vendor-categories",function(a){l=a.popover})}};return{Init:function(){b.categorySelection();b.imageSelection();b.imageContainerScroll();b.popover()}}}(),j=function(){function b(a,c,d){var e=f("<li>"),g=f("<a>");g.attr({"data-themename":a,"data-action":"category-selection","data-categoryId":c?c:
a,title:a});e.addClass("a-tab-heading vendor-category");g.addClass(" a-declarative ");g.attr("href","#").addClass("pc-category-name").html(a);e.append(g);d.append(e)}var c={defaultCategory:function(){f(".pc-category-name").each(function(a,b){if(f(b).attr("data-themename")===g.defaultLibrary||f(b).attr("data-categoyid")===g.defaultLibraryId)return setTimeout(function(){f(b).trigger("click");f("#gallerySpinner").css("display","none")},2E3),!1});f(".ac-selected-gallery-name").text(g.defaultLibrary).attr({"data-categoryid":g.defaultLibraryId,
title:g.defaultLibrary})}};return{Build:function(){var d;m.loading.hide();try{for(var e=g.contentLibraryIds.length,h=f("<div>"),j,l=0;l<g.contentLibraryList.length;l++){g.contentLibraryList[l].contentLibraryId=m.getFormattedName(g.contentLibraryList[l].contentLibraryId);if(g.contentLibraryList[l].contentLibraryId&&g.contentLibraryList[l].contentLibraryId===g.defaultLibrary)g.defaultLibraryId=g.contentLibraryList[l].contentLibraryId,g.defaultLibrary=g.contentLibraryList[l].title;if(!g.contentLibraryList[l].contentLibraryId)g.contentLibraryList[l].contentLibraryId=
g.contentLibraryList[l].title}if(!g.defaultLibraryId)g.defaultLibraryId=g.defaultLibrary;m.checkIfCategoryExistsInObject(g.defaultLibrary)&&b(g.defaultLibrary,g.defaultLibraryId,h);for(j=0;j<e;j+=1)d=g.contentLibraryList[j].title,d!==g.defaultLibrary&&m.checkIfCategoryExistsInObject(g.defaultLibrary)&&b(d,g.contentLibraryList[j].contentLibraryId,h);f(a.options.categoryContainerSelector,i).append(h.html());o.Init();c.defaultCategory()}catch(k){m.lazyload.error()}}}}(),p=function(){function b(c,d,e){var g=
m.getContentLibraryObject(c),c=g.contentList,g=g.contentList.length,h=f("<div>"),i;if(a.options.enableLazyLoading||e){a.options.enableLazyLoading?e?(i=0,e=g<a.options.pageSize?g:a.options.pageSize):(e=d.container.data("endIndex"),i=e+1,e=g<e+a.options.pageSize?g:e+a.options.pageSize):(i=0,e=g);for(;i<e;i+=1){var j=c[i],l=f("<div>").addClass("ac-gallery-content-container"),k=f("<img>"),o=f("<div>").addClass("swatch-arrow");j.status&&j.status!=="Active"||!j.isActive||!j.info||(k.attr({src:j.info.thumbnailURL,
"data-original-url":j.info.url,alt:j.description,"data-original-width":j.width?j.width:2500,"data-original-height":j.height?j.height:3500,"data-preview-url":j.info.previewURL,"data-thumbnail-url":j.info.thumbnailURL,"data-action":"ac-gallery-content-image","data-token":j.title,"data-contentId":j.ContentId?j.ContentId:j.title,isExclusive:1}),k.addClass("ac-gallery-content-image a-declarative"),l.append(k),l.append(o),h.append(l))}c=h.html();d.isEmpty?(f(".ac-gallery-content").append(d.container.append(c)),
d.container.data("endIndex",e),d.container.data("length",g)):(d.container.data("endIndex",e),d.container.append(c))}}return{AppendImages:b,BuildGallery:function(a){var c=m.checkIfCategoryAlreadyLoaded(a);f(".theme-image-container",i).hide();f(".ac-gallery-container").scrollTop(0);c.isEmpty?b(a,c,!0):(f(".ac-gallery-container").scrollTop(0),f('.theme-image-container[data-theme="'+a+'"]',i).show())}}}(),q=function(a,b){var c=m.getGalleryInputData(a),d=f.Deferred();c.data.contentLibraryName="/"+c.data.contentLibraryName.replace("/",
"");f.ajax({type:"GET",url:c.url,dataType:"json",data:c.data,success:function(a){m.lazyload.success();g=f.parseJSON(a.result);if(g===null||g.Status==="Error")m.lazyload.error();else return d.resolve(g,b)},error:function(a){return d.reject(a,b)}});return d.promise()};return{Fetch:function(){var a=[],c={},h=0,i;i=function(){++h;if(h===d.length){for(var f=0;f<a.length;f++)a[f]||(a.splice(f,1),d.splice(f,1));c.inlineData={contentLibraryList:a,contentLibraryIds:d};f=!1;if(b)for(var i=0;i<c.inlineData.contentLibraryList.length;i++)if(c.inlineData.contentLibraryList[i].contentLibraryId===
b||c.inlineData.contentLibraryList[i].title===b){f=!0;break}c.defaultLibrary=f?b:d[0];g=m.formatResponseObject(c);j.Build()}};for(var l=0;l<d.length;l++)f.when(q(d[l],l)).then(function(b,c){a[c]=b.status&&b.status==="Active"&&b.contentList||b.isActive&&b.contentList?b:null;i()},function(b,c){a[c]=null;i()})}}};d.prototype=k;return d})})();(function(){s.when("A","ac-utils","ac-constants","ac-image-gallery","ac-error-handling","ready").register("AssetUploader",function(n,k,f,d,c){var e=n.$,b=function(a){this.assetType=
a.assetType;this.$form=a.$form;this.mediaServer=a.mediaServer;this.index=0};b.prototype.getComponentName=function(){return"AssetUploader"};b.prototype.getUploadTypeObject=function(a){var b;a==="image"&&(b=new d);b.index=this.index++;return b};b.prototype.Init=function(){var a=this.$form,b=this.getUploadTypeObject(this.assetType);a.find("input[type='file']").attr("multiple",!1);b.imageSelection();a.fileupload({autoUpload:!0,url:e(".ac-custom-upload-form").attr("action"),dataType:"json",type:"POST",
add:function(d,h){var m=h.files[0];h.resourceIndex=b.index;b.isValidFile(m,function(d){e.extend(h,d);h.statusCode===f.StatusCode.INVALID_FILE_TYPE?c.show("pc-image-mime-type-incorrect",{timeOut:"6000"}):h.statusCode===f.StatusCode.INVALIDFILESIZE?c.show("pc-image-size-incorrect",{timeOut:"6000"}):(b.createResourceStub(a,h.resourceIndex),n.post("/gp/features/fetch-imageUpload-s3post-parameters.html",{dataType:"json",params:{contentType:"image",csrfToken:e(".ac-custom-upload-form").attr("data-csrf"),
uid:b.getResourcePath(),extension:"."+h.fileInput.val().split(".").pop().toLowerCase(),isDPX:1},success:function(c){h.uploadObject=b;b.setBucket(c.imageToken.split("/")[0]);b.setFileName(m.name);b.setKey(h.resourceIndex);b.setResourcePath(c.key.split(".")[0]);b.getKey();a.attr("action",c.action);e("#key",a).val(c.key);e("#AWSAccessKeyId",a).val(c.AWSAccessKeyId);e("#policy",a).val(c.policy);e("#signature",a).val(c.signature);e("#success_action_status",a).val(c.statusCode);e("#expires",a).val(c.expires);
h.pcImageUrl=c.thumbnailUrl;h.imageName=c.key;h.imageToken=c.imageToken;h.submit()},error:function(){c.show("pc-upload-error-message",{timeOut:"6000"});n.trigger("amazon-custom-log-ref-tag","logS3TextUploadError")}}))})},send:function(){e(".ac-upload-progress").text("0%");k.imageLoading.show()},fail:function(){k.imageLoading.hide();c.show("pc-upload-error-message",{timeOut:"6000"});e(".ac-upload-progress").text("");n.trigger("amazon-custom-log-ref-tag","logS3ImageUploadError")},done:function(a,b){e(".ac-upload-progress").text("100%");
k.imageLoading.hide();b.uploadObject.updateView(b,b.statusCode);e(".ac-upload-progress").text("")},progress:function(a,b){var c=parseInt(b.loaded/b.total*100,10);e(".ac-upload-progress").text(c+"%")}})};return b});s.when("A","AssetUploader","ac-constants","ready").execute(function(n,k){n.declarative("asset-upload","click",function(f){var d;f.$target.data("asset-upload")===y&&(d=new k({$form:f.$target.parentsUntil(".ac-custom-upload-container","form"),assetType:"image",uploadType:f.data["upload-type"],
mediaServer:"https://images-na.ssl-images-amazon.com/images/S/"}),d.Init(),f.$target.data("asset-upload",d))})})})();(function(){s.when("A","ready").register("ac-gallery-base",function(){var n=function(){};n.prototype={generateUUID:function(){function k(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return k()+k()+"-"+k()+"-"+k()+"-"+k()+"-"+k()+k()+k()},getTimeStamp:function(){var k=new Date;return k.getUTCFullYear()+"-"+k.getUTCMonth()+"-"+k.getUTCDate()+"-"+k.getUTCHours()+
"-"+k.getUTCMinutes()},getFileExtension:function(){var k=/^.+\.([^.]+)$/.exec(this.fileName);return k===null?"":"."+k[1].toLowerCase()},getFileNameWithoutExtension:function(){var k=this.fileName.split(".")[0];return k===null?"":k.toLowerCase()},getKey:function(){return this.key},isValidFile:function(){console.log("No Implementation - isValidFile")},setBucket:function(k){this.bucket=k},getBucket:function(){return this.bucket},setFileName:function(k){this.fileName=k},updateView:function(){console.log("No Implementation - ValidateAndUpdate")},
setResourcePath:function(k){this.ResourcePath=k},getResourcePath:function(){return this.ResourcePath}};return n})})();(function(){s.when("A","ac-base","ac-utils","ready").register("ac-error-handling",function(n,k,f){var d=n.$,c,e,b,a,i;c=function(){return d(".ac-error-container")};e=function(){return d(".ac-error-container .a-alert-heading")};b=function(){return d(".ac-error-container .a-alert-content")};a=function(a){var b;b={type:a.type?a.type:"error",message:a.message};if(i.indexOf(a.id)!==-1)b.type=
"warning";return b};i=["pc-error-generic-text","pc-resolution-warning","pc-scale-warning-message","pc-generic-warning-text"];return{show:function(d,h){var i={};d?i=a({id:d,message:f.stringHandler(d)}):(i.type=h.type,i.message=h.message);c().removeClass("a-alert-warning a-alert-error a-alert-success a-alert-info").addClass("a-alert-"+i.type);e().text(i.type.charAt(0).toUpperCase()+i.type.slice(1)+" Message");b().html(i.message);c().addClass("active");h&&h.timeOut&&setTimeout(function(){c().removeClass("active")},
parseInt(h.timeOut,10))},hide:function(){c().removeClass("active")}}})})();(function(){s.when("A","a-dropdown","ac-base","ac-utils","fabric-js","ac-constants","ready").register("ac-text-image",function(n,k,f,d,c,e){var b=n.$;return function(a){var f=this,g,h,m={},l;l=function(){m=b.extend({},e.textDefaults);h&&h.setText("")};f.isInitialized=!1;f.changeFont=function(a){f.updateText({fontFamily:a})};f.toggleStyle=function(a){var b={};switch(a){case "boldoff":b.fontWeight="normal";f.updateText(b);break;
case "boldon":b.fontWeight="bold";f.updateText(b);break;case "italicson":b.fontStyle="italic";f.updateText(b);break;case "italicsoff":b.fontStyle="normal";f.updateText(b);break;case "underlineon":b.textDecoration="underline";f.updateText(b);break;case "underlineoff":b.textDecoration="normal",f.updateText(b)}};f.style=function(){};f.changeAlign=function(a){var b={};switch(a){case "left":b.textAlign="left";f.updateText(b);break;case "center":b.textAlign="center";f.updateText(b);break;case "right":b.textAlign=
"right",f.updateText(b)}};f.changeTextColor=function(a){b(".simplecolorpicker.icon").css("background-color",a);f.updateText({fill:a})};f.editText=function(a){h.setText(a);f.updateText(null)};f.resetControl=function(){b("#pcTextArea").val("");b(".pc-textArea-fontStyle-li").removeClass("button-active");b(".pc-textArea-fontAlign-li").removeClass("button-active");b('.pc-textArea-fontAlign-li[data-align="left"]').addClass("button-active");k.getSelect("fontPicker").setValue("Arial");b(".simplecolorpicker.icon").css({"background-color":b("ul.pc-textArea-fontColor-ul li.pc-textArea-fontColor-li:first-child div").css("background-color")})};
f.updateControl=function(){if(f.isInitialized){f.resetControl();var c=a.getObjects();m.text="";for(var d=0;d<c.length;d++)if(c[d].type==="text")m.text=c[d].text;b("#pcTextArea").val(m.text);m.fontWeight==="bold"&&b('.pc-textArea-fontStyle-li[data-style="bold"]').addClass("button-active");m.textDecoration==="underline"&&b('.pc-textArea-fontStyle-li[data-style="underline"]').addClass("button-active");m.fontStyle==="italic"&&b('.pc-textArea-fontStyle-li[data-style="italics"]').addClass("button-active");
m.textAlign==="right"?(b(".pc-textArea-fontAlign-li").removeClass("button-active"),b('.pc-textArea-fontAlign-li[data-align="right"]').addClass("button-active")):m.textAlign==="center"&&(b(".pc-textArea-fontAlign-li").removeClass("button-active"),b('.pc-textArea-fontAlign-li[data-align="center"]').addClass("button-active"));k.getSelect(b("#fontPicker")).setValue(m.fontFamily);b(".simplecolorpicker.icon").css({"background-color":m.fill})}else f.init(),f.resetControl()};f.select=function(){for(var b=
a.getObjects(),c=a.canvas.size()-1;c>=0;c--)b[c].id&&b[c].id==="text-"+a.id&&a.canvas.setActiveObject(b[c])};f.deSelect=function(){for(var b=a.getObjects(),c=a.canvas.size()-1;c>=0;c--)b[c].id&&b[c].id==="text-"+a.id&&a.canvas.setActiveObject(b[c])};g=function(d){for(var g,h=a.getObjects(),l=a.canvas.size()-1;l>=0;l--)if(h[l].id&&h[l].id===d.id)return null;g=function(b){a.canvas.add(b);b.bringToFront();a.canvas.calcOffset();b.setCoords();a.canvas.setActiveObject(b);a.renderAll()};d=function(c){var d=
{};b.extend(d,c,e.textDefaults);d.id="text-"+a.id;return m=d}(d?d:{});d.fontSize=a.canvas.width/5;d.fill=a.surface.data.FontSettings.colors[0].value;b("#pcTextArea").val("");f.updateText(null);return function(){var b=new c.Text(d.text,{angle:d.angle,opacity:d.opacity,fontFamily:d.fontFamily,fontSize:d.fontSize,fontWeight:d.fontWeight,fontStyle:d.fontStyle,id:d.id,cursorColor:"#ffffff",fill:d.fill,transparentCorners:!1,centeredRotation:!0,centeredScaling:!0,padding:5,originX:"left",originY:"top",selectable:!0,
textAlign:d.textAlign});b.set({left:20,top:a.canvas.height/2-d.fontSize/2});g(b);return b}()};var o=function(c){for(var d=a.getObjects(),e=d.length-1;e>=0;e--)d[e].name&&d[e].name==="galImage"&&a.canvas.remove(d[e]);if(h){h.bringToFront();a.canvas.calcOffset();if(typeof c==="object")h.set(c),b.extend(m,m,c);else if(typeof c==="string")h.setText(c),m.text=c,b("#pcTextArea").val(c);h.setCoords();a.canvas.setActiveObject(h);m.text===""?b(".pc-two-column-layout .ac-delete-button").fadeOut():b(".pc-two-column-layout .ac-delete-button").fadeIn()}a.renderAll()};
f.updateText=function(b){var c,e,g,h,m=!1;c=a.getObjects();e=d.stringHandler("pc-clear-design-msg");g=function(){a.surface.widget.surfaceList.forEach(function(a){a.childCanvasList.forEach(function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)b[c].name&&b[c].name==="galImage"&&a.clear()})});o(b)};h=function(){for(var b=a.canvas.size()-1;b>=0;b--)if(c[b].type==="text"){c[b].remove();break}f.cleared();a.controls.textInput.isControlActive=!1};a.surface.widget.surfaceList.forEach(function(a){a.childCanvasList.forEach(function(a){for(var a=
a.getObjects(),b=0;b<a.length;b++)if(a[b].name&&a[b].name==="galImage"){m=!0;break}})});m?d.showDialog.show(e,g,{ok:"Clear",cancelCallBack:h}):g()};f.cleared=function(){f.resetControl();l();f.isInitialized=!1};f.hasRequiredField=function(){return!1};f.requiredFieldsAreValid=function(){return!0};f.containsEmoji=function(){var a=b("#pcTextArea").val();return e.emojiMatchPattern.test(a)};f.init=function(){f.isInitialized=!0;h=g()}}})})()})})(function(){var s=window.AmazonUIPageJS||window.P,A=s._namespace||
s.attributeErrors;return A?A("ProductCustomizationSingleTextAssets"):s}(),window);
(function(s,A,y){s.execute(function(){s.when("A","jQuery").register("jq-ui-widget",function(n,k){(function(f){f(k)})(function(f,d){var c=0,e=Array.prototype.slice,b=f.cleanData;f.cleanData=function(a){for(var c=0,d;(d=a[c])!=null;c++)try{f(d).triggerHandler("remove")}catch(e){}b(a)};f.widget=function(a,b,c){var d,e,l,k,j={},n=a.split(".")[0],a=a.split(".")[1];d=n+"-"+a;if(!c)c=b,b=f.Widget;f.expr[":"][d.toLowerCase()]=function(a){return!!f.data(a,d)};f[n]=f[n]||{};e=f[n][a];l=f[n][a]=function(a,b){if(!this._createWidget)return new l(a,
b);arguments.length&&this._createWidget(a,b)};f.extend(l,e,{version:c.version,_proto:f.extend({},c),_childConstructors:[]});k=new b;k.options=f.widget.extend({},k.options);f.each(c,function(a,c){j[a]=f.isFunction(c)?function(){var d=function(){return b.prototype[a].apply(this,arguments)},e=function(c){return b.prototype[a].apply(this,c)};return function(){var a=this._super,b=this._superApply,g;this._super=d;this._superApply=e;g=c.apply(this,arguments);this._super=a;this._superApply=b;return g}}():
c});l.prototype=f.widget.extend(k,{widgetEventPrefix:e?k.widgetEventPrefix||a:a},j,{constructor:l,namespace:n,widgetName:a,widgetFullName:d});e?(f.each(e._childConstructors,function(a,b){var c=b.prototype;f.widget(c.namespace+"."+c.widgetName,l,b._proto)}),delete e._childConstructors):b._childConstructors.push(l);f.widget.bridge(a,l)};f.widget.extend=function(a){for(var b=e.call(arguments,1),c=0,h=b.length,m,l;c<h;c++)for(m in b[c])l=b[c][m],b[c].hasOwnProperty(m)&&l!==d&&(a[m]=f.isPlainObject(l)?
f.isPlainObject(a[m])?f.widget.extend({},a[m],l):f.widget.extend({},l):l);return a};f.widget.bridge=function(a,b){var c=b.prototype.widgetFullName||a;f.fn[a]=function(h){var m=typeof h==="string",l=e.call(arguments,1),k=this,h=!m&&l.length?f.widget.extend.apply(null,[h].concat(l)):h;m?this.each(function(){var b,e=f.data(this,c);if(!e)return f.error("cannot call methods on "+a+" prior to initialization; attempted to call method '"+h+"'");if(!f.isFunction(e[h])||h.charAt(0)==="_")return f.error("no such method '"+
h+"' for "+a+" widget instance");b=e[h].apply(e,l);if(b!==e&&b!==d)return k=b&&b.jquery?k.pushStack(b.get()):b,!1}):this.each(function(){var a=f.data(this,c);a?a.option(h||{})._init():f.data(this,c,new b(h,this))});return k}};f.Widget=function(){};f.Widget._childConstructors=[];f.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(a,b){b=f(b||this.defaultElement||this)[0];this.element=f(b);this.uuid=c++;this.eventNamespace=
"."+this.widgetName+this.uuid;this.options=f.widget.extend({},this.options,this._getCreateOptions(),a);this.bindings=f();this.hoverable=f();this.focusable=f();if(b!==this)f.data(b,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===b&&this.destroy()}}),this.document=f(b.style?b.ownerDocument:b.document||b),this.window=f(this.document[0].defaultView||this.document[0].parentWindow);this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:f.noop,
_getCreateEventData:f.noop,_create:f.noop,_init:f.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(f.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},
_destroy:f.noop,widget:function(){return this.element},option:function(a,b){var c=a,e,m,l;if(arguments.length===0)return f.widget.extend({},this.options);if(typeof a==="string")if(c={},e=a.split("."),a=e.shift(),e.length){m=c[a]=f.widget.extend({},this.options[a]);for(l=0;l<e.length-1;l++)m[e[l]]=m[e[l]]||{},m=m[e[l]];a=e.pop();if(arguments.length===1)return m[a]===d?null:m[a];m[a]=b}else{if(arguments.length===1)return this.options[a]===d?null:this.options[a];c[a]=b}this._setOptions(c);return this},
_setOptions:function(a){for(var b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){this.options[a]=b;a==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"));return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(a,b,c){var d,e=this;typeof a!==
"boolean"&&(c=b,b=a,a=!1);c?(b=d=f(b),this.bindings=this.bindings.add(b)):(c=b,b=this.element,d=this.widget());f.each(c,function(c,g){function j(){return!a&&(e.options.disabled===!0||f(this).hasClass("ui-state-disabled"))?void 0:(typeof g==="string"?e[g]:g).apply(e,arguments)}if(typeof g!=="string")j.guid=g.guid=g.guid||j.guid||f.guid++;var k=c.match(/^(\w+)\s*(.*)$/),n=k[1]+e.eventNamespace;(k=k[2])?d.delegate(k,n,j):b.bind(n,j)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+
" ")+this.eventNamespace;a.unbind(b).undelegate(b)},_delay:function(a,b){var c=this;return setTimeout(function(){return(typeof a==="string"?c[a]:a).apply(c,arguments)},b||0)},_hoverable:function(a){this.hoverable=this.hoverable.add(a);this._on(a,{mouseenter:function(a){f(a.currentTarget).addClass("ui-state-hover")},mouseleave:function(a){f(a.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(a){this.focusable=this.focusable.add(a);this._on(a,{focusin:function(a){f(a.currentTarget).addClass("ui-state-focus")},
focusout:function(a){f(a.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(a,b,c){var d,e=this.options[a],c=c||{},b=f.Event(b);b.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();b.target=this.element[0];if(a=b.originalEvent)for(d in a)d in b||(b[d]=a[d]);this.element.trigger(b,c);return!(f.isFunction(e)&&e.apply(this.element[0],[b].concat(c))===!1||b.isDefaultPrevented())}};f.each({show:"fadeIn",hide:"fadeOut"},function(a,b){f.Widget.prototype["_"+a]=function(c,
d,e){typeof d==="string"&&(d={effect:d});var l,k=!d?a:d===!0||typeof d==="number"?b:d.effect||b,d=d||{};typeof d==="number"&&(d={duration:d});l=!f.isEmptyObject(d);d.complete=e;d.delay&&c.delay(d.delay);if(l&&f.effects&&f.effects.effect[k])c[a](d);else if(k!==a&&c[k])c[k](d.duration,d.easing,e);else c.queue(function(b){f(this)[a]();e&&e.call(c[0]);b()})}})})});s.when("A","jQuery").register("jq-IframeTransport",function(n,k){(function(f){f(k)})(function(f){var d=0;f.ajaxTransport("iframe",function(c){if(c.async){var e=
c.initialIframeSrc||"javascript:false;",b,a,i;return{send:function(g,h){b=f('<form style="display:none;"></form>');b.attr("accept-charset",c.formAcceptCharset);i=/\?/.test(c.url)?"&":"?";if(c.type==="DELETE")c.url=c.url+i+"_method=DELETE",c.type="POST";else if(c.type==="PUT")c.url=c.url+i+"_method=PUT",c.type="POST";else if(c.type==="PATCH")c.url=c.url+i+"_method=PATCH",c.type="POST";d+=1;a=f('<iframe src="'+e+'" name="iframe-transport-'+d+'"></iframe>').bind("load",function(){var d,g=f.isArray(c.paramName)?
c.paramName:[c.paramName];a.unbind("load").bind("load",function(){var c;try{if(c=a.contents(),!c.length||!c[0].firstChild)throw Error();}catch(d){c=y}h(200,"success",{iframe:c});f('<iframe src="'+e+'"></iframe>').appendTo(b);A.setTimeout(function(){b.remove()},0)});b.prop("target",a.prop("name")).prop("action",c.url).prop("method",c.type);c.formData&&f.each(c.formData,function(a,c){c.name!=="file"&&f('<input type="hidden"/>').prop("name",c.name).val(c.value).appendTo(b)});c.fileInput&&c.fileInput.length&&
c.type==="POST"&&(d=c.fileInput.clone(),c.fileInput.after(function(a){return d[a]}),c.paramName&&c.fileInput.each(function(a){f(this).prop("name",g[a]||c.paramName)}),b.append(c.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),c.fileInput.removeAttr("form"));b.submit();d&&d.length&&c.fileInput.each(function(a,b){var c=f(d[a]);f(b).prop("name",c.prop("name")).attr("form",c.attr("form"));c.replaceWith(b)})});b.append(a).appendTo(document.body)},abort:function(){a&&
a.unbind("load").prop("src",e);b&&b.remove()}}}});f.ajaxSetup({converters:{"iframe text":function(c){return c&&f(c[0].body).text()},"iframe json":function(c){return c&&f.parseJSON(f(c[0].body).text())},"iframe html":function(c){return c&&f(c[0].body).html()},"iframe xml":function(c){return(c=c&&c[0])&&f.isXMLDoc(c)?c:f.parseXML(c.XMLDocument&&c.XMLDocument.xml||f(c.body).html())},"iframe script":function(c){return c&&f.globalEval(f(c[0].body).text())}}})})});s.when("A","jQuery","jq-ui-widget").register("jq-fileupload",
function(n,k){(function(f){f(k)})(function(f){f.support.fileInput=!(RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(A.navigator.userAgent)||f('<input type="file">').prop("disabled"));f.support.xhrFileUpload=!(!A.ProgressEvent||!A.FileReader);f.support.xhrFormDataFileUpload=!!A.FormData;f.support.blobSlice=A.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);
f.widget("blueimp.fileupload",{options:{dropZone:f(document),pasteZone:f(document),fileInput:y,replaceFileInput:!0,paramName:y,singleFileUploads:!0,limitMultiFileUploads:y,limitMultiFileUploadSize:y,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:y,forceIframeTransport:!1,redirect:y,redirectParamName:y,postMessage:y,multipart:!0,maxChunkSize:y,uploadedBytes:y,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},
i18n:function(d,c){d=this.messages[d]||d.toString();c&&f.each(c,function(c,b){d=d.replace("{"+c+"}",b)});return d},formData:function(d){return d.serializeArray()},add:function(d,c){if(d.isDefaultPrevented())return!1;(c.autoUpload||c.autoUpload!==!1&&f(this).fileupload("option","autoUpload"))&&c.process().done(function(){c.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:f.support.blobSlice&&function(){return(this.slice||
this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=0;this.getBitrate=function(d,c,e){var b=d-this.timestamp;if(!this.bitrate||!e||b>e)this.bitrate=(c-this.loaded)*(1E3/b)*8,this.loaded=c,this.timestamp=d;return this.bitrate}},_isXHRUpload:function(d){return!d.forceIframeTransport&&(!d.multipart&&f.support.xhrFileUpload||f.support.xhrFormDataFileUpload)},_getFormData:function(d){var c;if(f.type(d.formData)===
"function")return d.formData(d.form);if(f.isArray(d.formData))return d.formData;return f.type(d.formData)==="object"?(c=[],f.each(d.formData,function(d,b){c.push({name:d,value:b})}),c):[]},_getTotal:function(d){var c=0;f.each(d,function(d,b){c+=b.size||1});return c},_initProgressObject:function(d){var c={loaded:0,total:0,bitrate:0};d._progress?f.extend(d._progress,c):d._progress=c},_initResponseObject:function(d){var c;if(d._response)for(c in d._response)d._response.hasOwnProperty(c)&&delete d._response[c];
else d._response={}},_onProgress:function(d,c){if(d.lengthComputable){var e=Date.now?Date.now():(new Date).getTime(),b;if(!c._time||!c.progressInterval||!(e-c._time<c.progressInterval&&d.loaded!==d.total))c._time=e,b=Math.floor(d.loaded/d.total*(c.chunkSize||c._progress.total))+(c.uploadedBytes||0),this._progress.loaded+=b-c._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(e,this._progress.loaded,c.bitrateInterval),c._progress.loaded=c.loaded=b,c._progress.bitrate=c.bitrate=c._bitrateTimer.getBitrate(e,
b,c.bitrateInterval),this._trigger("progress",f.Event("progress",{delegatedEvent:d}),c),this._trigger("progressall",f.Event("progressall",{delegatedEvent:d}),this._progress)}},_initProgressListener:function(d){var c=this,e=d.xhr?d.xhr():f.ajaxSettings.xhr();if(e.upload)f(e.upload).bind("progress",function(b){var a=b.originalEvent;b.lengthComputable=a.lengthComputable;b.loaded=a.loaded;b.total=a.total;c._onProgress(b,d)}),d.xhr=function(){return e}},_isInstanceOf:function(d,c){return Object.prototype.toString.call(c)===
"[object "+d+"]"},_initXHRData:function(d){var c=this,e,b=d.files[0],a=d.multipart||!f.support.xhrFileUpload,i=f.type(d.paramName)==="array"?d.paramName[0]:d.paramName;d.headers=f.extend({},d.headers);if(d.contentRange)d.headers["Content-Range"]=d.contentRange;if(!a||d.blob||!this._isInstanceOf("File",b))d.headers["Content-Disposition"]='attachment; filename="'+encodeURI(b.name)+'"';if(a){if(f.support.xhrFormDataFileUpload)d.postMessage?(e=this._getFormData(d),d.blob?e.push({name:i,value:d.blob}):
f.each(d.files,function(a,b){e.push({name:f.type(d.paramName)==="array"&&d.paramName[a]||i,value:b})})):(c._isInstanceOf("FormData",d.formData)?e=d.formData:(e=new FormData,f.each(this._getFormData(d),function(a,b){e.append(b.name,b.value)})),d.blob?e.append(i,d.blob,b.name):f.each(d.files,function(a,b){if(c._isInstanceOf("File",b)||c._isInstanceOf("Blob",b))e.append(f.type(d.paramName)==="array"&&d.paramName[a]||i,b,b.uploadName||b.name)})),d.data=e}else d.contentType=b.type||"application/octet-stream",
d.data=d.blob||b;d.blob=null},_initIframeSettings:function(d){var c=f("<a></a>").prop("href",d.url).prop("host");d.dataType="iframe "+(d.dataType||"");d.formData=this._getFormData(d);d.redirect&&c&&c!==location.host&&d.formData.push({name:d.redirectParamName||"redirect",value:d.redirect})},_initDataSettings:function(d){if(this._isXHRUpload(d)){if(this._chunkedUpload(d,!0)||(d.data||this._initXHRData(d),this._initProgressListener(d)),d.postMessage)d.dataType="postmessage "+(d.dataType||"")}else this._initIframeSettings(d)},
_getParamName:function(d){var c=f(d.fileInput),e=d.paramName;e?f.isArray(e)||(e=[e]):(e=[],c.each(function(){for(var b=f(this),a=b.prop("name")||"files[]",b=(b.prop("files")||[1]).length;b;)e.push(a),b-=1}),e.length||(e=[c.prop("name")||"files[]"]));return e},_initFormSettings:function(d){if(!d.form||!d.form.length)if(d.form=f(d.fileInput.prop("form")),!d.form.length)d.form=f(this.options.fileInput.prop("form"));d.paramName=this._getParamName(d);if(!d.url)d.url=d.form.prop("action")||location.href;
d.type=(d.type||f.type(d.form.prop("method"))==="string"&&d.form.prop("method")||"").toUpperCase();if(d.type!=="POST"&&d.type!=="PUT"&&d.type!=="PATCH")d.type="POST";if(!d.formAcceptCharset)d.formAcceptCharset=d.form.attr("accept-charset")},_getAJAXSettings:function(d){d=f.extend({},this.options,d);this._initFormSettings(d);this._initDataSettings(d);return d},_getDeferredState:function(d){return d.state?d.state():d.isResolved()?"resolved":d.isRejected()?"rejected":"pending"},_enhancePromise:function(d){d.success=
d.done;d.error=d.fail;d.complete=d.always;return d},_getXHRPromise:function(d,c,e){var b=f.Deferred(),a=b.promise(),c=c||this.options.context||a;d===!0?b.resolveWith(c,e):d===!1&&b.rejectWith(c,e);a.abort=b.promise;return this._enhancePromise(a)},_addConvenienceMethods:function(d,c){var e=this,b=function(a){return f.Deferred().resolveWith(e,a).promise()};c.process=function(a,d){if(a||d)c._processQueue=this._processQueue=(this._processQueue||b([this])).pipe(function(){return c.errorThrown?f.Deferred().rejectWith(e,
[c]).promise():b(arguments)}).pipe(a,d);return this._processQueue||b([this])};c.submit=function(){if(this.state()!=="pending")c.jqXHR=this.jqXHR=e._trigger("submit",f.Event("submit",{delegatedEvent:d}),this)!==!1&&e._onSend(d,this);return this.jqXHR||e._getXHRPromise()};c.abort=function(){if(this.jqXHR)return this.jqXHR.abort();this.errorThrown="abort";e._trigger("fail",null,this);return e._getXHRPromise(!1)};c.state=function(){if(this.jqXHR)return e._getDeferredState(this.jqXHR);if(this._processQueue)return e._getDeferredState(this._processQueue)};
c.processing=function(){return!this.jqXHR&&this._processQueue&&e._getDeferredState(this._processQueue)==="pending"};c.progress=function(){return this._progress};c.response=function(){return this._response}},_getUploadedBytes:function(d){var b;var a;return(b=(a=(d=d.getResponseHeader("Range"))&&d.split("-"),d=a)&&d.length>1&&parseInt(d[1],10),d=b)&&d+1},_chunkedUpload:function(d,c){d.uploadedBytes=d.uploadedBytes||0;var e=this,b=d.files[0],a=b.size,i=d.uploadedBytes,g=d.maxChunkSize||a,h=this._blobSlice,
m=f.Deferred(),l=m.promise(),k,j;if(!this._isXHRUpload(d)||!h||!(i||g<a)||d.data)return!1;if(c)return!0;if(i>=a)return b.error=d.i18n("uploadedBytes"),this._getXHRPromise(!1,d.context,[null,"error",b.error]);j=function(){var c=f.extend({},d),l=c._progress.loaded;c.blob=h.call(b,i,i+g,b.type);c.chunkSize=c.blob.size;c.contentRange="bytes "+i+"-"+(i+c.chunkSize-1)+"/"+a;e._initXHRData(c);e._initProgressListener(c);k=(e._trigger("chunksend",null,c)!==!1&&f.ajax(c)||e._getXHRPromise(!1,c.context)).done(function(b,
g,h){i=e._getUploadedBytes(h)||i+c.chunkSize;l+c.chunkSize-c._progress.loaded&&e._onProgress(f.Event("progress",{lengthComputable:!0,loaded:i-c.uploadedBytes,total:i-c.uploadedBytes}),c);d.uploadedBytes=c.uploadedBytes=i;c.result=b;c.textStatus=g;c.jqXHR=h;e._trigger("chunkdone",null,c);e._trigger("chunkalways",null,c);i<a?j():m.resolveWith(c.context,[b,g,h])}).fail(function(a,b,d){c.jqXHR=a;c.textStatus=b;c.errorThrown=d;e._trigger("chunkfail",null,c);e._trigger("chunkalways",null,c);m.rejectWith(c.context,
[a,b,d])})};this._enhancePromise(l);l.abort=function(){return k.abort()};j();return l},_beforeSend:function(d,c){if(this._active===0)this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0;this._initResponseObject(c);this._initProgressObject(c);c._progress.loaded=c.loaded=c.uploadedBytes||0;c._progress.total=c.total=this._getTotal(c.files)||1;c._progress.bitrate=c.bitrate=0;this._active+=1;this._progress.loaded+=c.loaded;
this._progress.total+=c.total},_onDone:function(d,c,e,b){var a=b._progress.total,i=b._response;b._progress.loaded<a&&this._onProgress(f.Event("progress",{lengthComputable:!0,loaded:a,total:a}),b);i.result=b.result=d;i.textStatus=b.textStatus=c;i.jqXHR=b.jqXHR=e;this._trigger("done",null,b)},_onFail:function(d,c,e,b){var a=b._response;b.recalculateProgress&&(this._progress.loaded-=b._progress.loaded,this._progress.total-=b._progress.total);a.jqXHR=b.jqXHR=d;a.textStatus=b.textStatus=c;a.errorThrown=
b.errorThrown=e;this._trigger("fail",null,b)},_onAlways:function(d,c,e,b){this._trigger("always",null,b)},_onSend:function(d,c){c.submit||this._addConvenienceMethods(d,c);var e=this,b,a,i,g,h=e._getAJAXSettings(c),m=function(){e._sending+=1;h._bitrateTimer=new e._BitrateTimer;return b=b||((a||e._trigger("send",f.Event("send",{delegatedEvent:d}),h)===!1)&&e._getXHRPromise(!1,h.context,a)||e._chunkedUpload(h)||f.ajax(h)).done(function(a,b,c){e._onDone(a,b,c,h)}).fail(function(a,b,c){e._onFail(a,b,c,
h)}).always(function(a,b,c){e._onAlways(a,b,c,h);e._sending-=1;e._active-=1;if(h.limitConcurrentUploads&&h.limitConcurrentUploads>e._sending)for(a=e._slots.shift();a;){if(e._getDeferredState(a)==="pending"){a.resolve();break}a=e._slots.shift()}e._active===0&&e._trigger("stop")})};this._beforeSend(d,h);return this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(i=f.Deferred(),this._slots.push(i),
g=i.pipe(m)):g=this._sequence=this._sequence.pipe(m,m),g.abort=function(){a=[y,"abort","abort"];return!b?(i&&i.rejectWith(h.context,a),m()):b.abort()},this._enhancePromise(g)):m()},_onAdd:function(d,c){var e=this,b=!0,a=f.extend({},this.options,c),i=c.files,g=i.length,h=a.limitMultiFileUploads,m=a.limitMultiFileUploadSize,l=a.limitMultiFileUploadSizeOverhead,k=0,j=this._getParamName(a),n,q,E=0;if(m&&(!g||i[0].size===y))m=y;if(!a.singleFileUploads&&!h&&!m||!this._isXHRUpload(a))q=[i],n=[j];else if(!a.singleFileUploads&&
!m&&h){q=[];n=[];for(a=0;a<g;a+=h)q.push(i.slice(a,a+h)),k=j.slice(a,a+h),k.length||(k=j),n.push(k)}else if(!a.singleFileUploads&&m){q=[];n=[];for(a=0;a<g;a+=1)if(k+=i[a].size+l,a+1===g||k+i[a+1].size+l>m||h&&a+1-E>=h)q.push(i.slice(E,a+1)),k=j.slice(E,a+1),k.length||(k=j),n.push(k),E=a+1,k=0}else n=j;c.originalFiles=i;f.each(q||i,function(a,g){var h=f.extend({},c);h.files=q?g:[g];h.paramName=n[a];e._initResponseObject(h);e._initProgressObject(h);e._addConvenienceMethods(d,h);return b=e._trigger("add",
f.Event("add",{delegatedEvent:d}),h)});return b},_replaceFileInput:function(d){var c=d.clone(!0);f("<form></form>").append(c)[0].reset();d.after(c).detach();f.cleanData(d.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(e,b){return b===d[0]?c[0]:b});if(d[0]===this.element[0])this.element=c},_handleFileTreeEntry:function(d,c){var e=this,b=f.Deferred(),a=function(a){if(a&&!a.entry)a.entry=d;b.resolve([a])},i,c=c||"";d.isFile?d._file?(d._file.relativePath=c,b.resolve(d._file)):
d.file(function(a){a.relativePath=c;b.resolve(a)},a):d.isDirectory?(i=d.createReader(),i.readEntries(function(g){e._handleFileTreeEntries(g,c+d.name+"/").done(function(a){b.resolve(a)}).fail(a)},a)):b.resolve([]);return b.promise()},_handleFileTreeEntries:function(d,c){var e=this;return f.when.apply(f,f.map(d,function(b){return e._handleFileTreeEntry(b,c)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(d){var d=d||{},c=d.items;return c&&c.length&&
(c[0].webkitGetAsEntry||c[0].getAsEntry)?this._handleFileTreeEntries(f.map(c,function(c){var b;if(c.webkitGetAsEntry){if(b=c.webkitGetAsEntry())b._file=c.getAsFile();return b}return c.getAsEntry()})):f.Deferred().resolve(f.makeArray(d.files)).promise()},_getSingleFileInputFiles:function(d){var d=f(d),c=d.prop("webkitEntries")||d.prop("entries");if(c&&c.length)return this._handleFileTreeEntries(c);c=f.makeArray(d.prop("files"));if(c.length)c[0].name===y&&c[0].fileName&&f.each(c,function(c,b){b.name=
b.fileName;b.size=b.fileSize});else{d=d.prop("value");if(!d)return f.Deferred().resolve([]).promise();c=[{name:d.replace(/^.*\\/,"")}]}return f.Deferred().resolve(c).promise()},_getFileInputFiles:function(d){return!(d instanceof f)||d.length===1?this._getSingleFileInputFiles(d):f.when.apply(f,f.map(d,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(d){var c=this,e={fileInput:f(d.target),form:f(d.target.form)};this._getFileInputFiles(e.fileInput).always(function(b){e.files=
b;c.options.replaceFileInput&&c._replaceFileInput(e.fileInput);c._trigger("change",f.Event("change",{delegatedEvent:d}),e)!==!1&&c._onAdd(d,e)})},_onPaste:function(d){var c=d.originalEvent&&d.originalEvent.clipboardData&&d.originalEvent.clipboardData.items,e={files:[]};c&&c.length&&(f.each(c,function(b,a){var c=a.getAsFile&&a.getAsFile();c&&e.files.push(c)}),this._trigger("paste",f.Event("paste",{delegatedEvent:d}),e)!==!1&&this._onAdd(d,e))},_onDrop:function(d){d.dataTransfer=d.originalEvent&&d.originalEvent.dataTransfer;
var c=this,e=d.dataTransfer,b={};e&&e.files&&e.files.length&&(d.preventDefault(),this._getDroppedFiles(e).always(function(a){b.files=a;c._trigger("drop",f.Event("drop",{delegatedEvent:d}),b)!==!1&&c._onAdd(d,b)}))},_onDragOver:function(d){d.dataTransfer=d.originalEvent&&d.originalEvent.dataTransfer;var c=d.dataTransfer;if(c&&f.inArray("Files",c.types)!==-1&&this._trigger("dragover",f.Event("dragover",{delegatedEvent:d}))!==!1)d.preventDefault(),c.dropEffect="copy"},_initEventHandlers:function(){this._isXHRUpload(this.options)&&
(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste}));f.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(d,c){var e=f.inArray(d,this._specialOptions)!==-1;e&&this._destroyEventHandlers();this._super(d,c);
e&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var d=this.options;if(d.fileInput===y)d.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]');else if(!(d.fileInput instanceof f))d.fileInput=f(d.fileInput);if(!(d.dropZone instanceof f))d.dropZone=f(d.dropZone);if(!(d.pasteZone instanceof f))d.pasteZone=f(d.pasteZone)},_getRegExp:function(d){var d=d.split("/"),c=d.pop();d.shift();return RegExp(d.join("/"),c)},_isRegExpOption:function(d,
c){return d!=="url"&&f.type(c)==="string"&&/^\/.*\/[igm]{0,3}$/.test(c)},_initDataAttributes:function(){var d=this,c=this.options,e=f(this.element[0].cloneNode(!1));f.each(e.data(),function(b,a){var f="data-"+b.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();e.attr(f)&&(d._isRegExpOption(b,a)&&(a=d._getRegExp(a)),c[b]=a)})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);
this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(d){var c=this;if(d&&!this.options.disabled)d.fileInput&&!d.files?this._getFileInputFiles(d.fileInput).always(function(e){d.files=e;c._onAdd(null,d)}):(d.files=f.makeArray(d.files),this._onAdd(null,d))},send:function(d){if(d&&!this.options.disabled){if(d.fileInput&&!d.files){var c=this,e=f.Deferred(),b=e.promise(),a,i;b.abort=function(){i=!0;if(a)return a.abort();e.reject(null,
"abort","abort");return b};this._getFileInputFiles(d.fileInput).always(function(b){if(!i)b.length?(d.files=b,a=c._onSend(null,d).then(function(a,b,c){e.resolve(a,b,c)},function(a,b,c){e.reject(a,b,c)})):e.reject()});return this._enhancePromise(b)}d.files=f.makeArray(d.files);if(d.files.length)return this._onSend(null,d)}return this._getXHRPromise(!1,d&&d.context)}})})})})})(function(){var s=window.AmazonUIPageJS||window.P,A=s._namespace||s.attributeErrors;return A?A("ProductCustomizationFileUploadAssets"):
s}(),window);
(function(s,A,y){s.execute(function(){s.when("A").register("fabric-js",function(n){var k=k||{};if(!n.capabilities.canvas)return{};var f=f||{version:"1.4.13"};if(typeof k!=="undefined")k.fabric=f;typeof document!=="undefined"&&typeof A!=="undefined"?(f.document=document,f.window=A):(f.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),f.window=f.document.createWindow?f.document.createWindow():f.document.parentWindow);f.isTouchSupported="ontouchstart"in f.document.documentElement;
f.isLikelyNode=typeof Buffer!=="undefined"&&typeof A==="undefined";f.SHARED_ATTRIBUTES="display,transform,fill,fill-opacity,fill-rule,opacity,stroke,stroke-dasharray,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width".split(",");f.DPI=96;f.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";(function(){function d(a,b){if(this.__eventListeners[a])b?f.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0}function c(a,b){if(!this.__eventListeners)this.__eventListeners=
{};if(arguments.length===1)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function e(a,b){if(this.__eventListeners){if(arguments.length===0)this.__eventListeners={};else if(arguments.length===1&&typeof arguments[0]==="object")for(var c in a)d.call(this,c,a[c]);else d.call(this,a,b);return this}}function b(a,b){if(this.__eventListeners){var c=this.__eventListeners[a];if(c){for(var d=0,e=c.length;d<e;d++)c[d].call(this,
b||{});return this}}}f.Observable={observe:c,stopObserving:e,fire:b,on:c,off:e,trigger:b}})();f.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var d=0,c=arguments.length;d<c;d++)this._onObjectAdded(arguments[d]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(d,c,e){var b=this.getObjects();e?b[c]=d:b.splice(c,0,d);this._onObjectAdded(d);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var d=this.getObjects(),c,e=
0,b=arguments.length;e<b;e++)c=d.indexOf(arguments[e]),c!==-1&&(d.splice(c,1),this._onObjectRemoved(arguments[e]));this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(d,c){for(var e=this.getObjects(),b=e.length;b--;)d.call(c,e[b],b,e);return this},getObjects:function(d){return typeof d==="undefined"?this._objects:this._objects.filter(function(c){return c.type===d})},item:function(d){return this.getObjects()[d]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},
contains:function(d){return this.getObjects().indexOf(d)>-1},complexity:function(){return this.getObjects().reduce(function(d,c){d+=c.complexity?c.complexity():0;return d},0)}};(function(d){var c=Math.sqrt,e=Math.atan2,b=Math.PI/180;f.util={removeFromArray:function(a,b){var c=a.indexOf(b);c!==-1&&a.splice(c,1);return a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*b},radiansToDegrees:function(a){return a/b},rotatePoint:function(a,b,c){var d=
Math.sin(c),c=Math.cos(c);a.subtractEquals(b);return(new f.Point(a.x*c-a.y*d,a.x*d+a.y*c)).addEquals(b)},transformPoint:function(a,b,c){return c?new f.Point(b[0]*a.x+b[1]*a.y,b[2]*a.x+b[3]*a.y):new f.Point(b[0]*a.x+b[1]*a.y+b[4],b[2]*a.x+b[3]*a.y+b[5])},invertTransform:function(a){var b=a.slice(),b=1/(a[0]*a[3]-a[1]*a[2]),b=[b*a[3],-b*a[1],-b*a[2],b*a[0],0,0],a=f.util.transformPoint({x:a[4],y:a[5]},b);b[4]=-a.x;b[5]=-a.y;return b},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,
b){var c=/\D{0,2}$/.exec(a),d=parseFloat(a);if(!b)b=f.Text.DEFAULT_SVG_FONT_SIZE;switch(c[0]){case "mm":return d*f.DPI/25.4;case "cm":return d*f.DPI/2.54;case "in":return d*f.DPI;case "pt":return d*f.DPI/72;case "pc":return d*f.DPI/72*12;case "em":return d*b;default:return d}},falseFunction:function(){return!1},getKlass:function(a,b){a=f.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1));return f.util.resolveNamespace(b)[a]},resolveNamespace:function(a){if(!a)return f;for(var a=a.split("."),
b=a.length,c=d||f.window,e=0;e<b;++e)c=c[a[e]];return c},loadImage:function(a,b,c,d){if(a){var e=f.util.createImage();e.onload=function(){var g;b&&b.call(c,e);g=e.onload=e.onerror=null,e=g};e.onerror=function(){var g;f.log("Error loading "+e.src);b&&b.call(c,null,!0);g=e.onload=e.onerror=null,e=g};if(a.indexOf("data")!==0&&typeof d!=="undefined")e.crossOrigin=d;e.src=a}else b&&b.call(c,a)},enlivenObjects:function(a,b,c,d){function e(){++k===j&&b&&b(l)}var a=a||[],l=[],k=0,j=a.length;j?a.forEach(function(a,
b){if(!a||!a.type)e();else{var i=f.util.getKlass(a.type,c);i.async?i.fromObject(a,function(c,g){g||(l[b]=c,d&&d(a,l[b]));e()}):(l[b]=i.fromObject(a),d&&d(a,l[b]),e())}}):b&&b(l)},groupSVGElements:function(a,b,c){a=new f.PathGroup(a,b);typeof c!=="undefined"&&a.setSourcePath(c);return a},populateWithProperties:function(a,b,c){if(c&&Object.prototype.toString.call(c)==="[object Array]")for(var d=0,e=c.length;d<e;d++)c[d]in a&&(b[c[d]]=a[c[d]])},drawDashedLine:function(a,b,d,f,m,l){f-=b;var k=m-d,m=c(f*
f+k*k),f=e(k,f),k=l.length,j=0,n=!0;a.save();a.translate(b,d);a.moveTo(0,0);a.rotate(f);for(b=0;m>b;)b+=l[j++%k],b>m&&(b=m),a[n?"lineTo":"moveTo"](b,0),n=!n;a.restore()},createCanvasElement:function(a){a||(a=f.document.createElement("canvas"));!a.getContext&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(a);return a},createImage:function(){return f.isLikelyNode?new (require("canvas").Image):f.document.createElement("img")},createAccessors:function(a){for(var a=a.prototype,
b=a.stateProperties.length;b--;){var c=a.stateProperties[b],d=c.charAt(0).toUpperCase()+c.slice(1),e="set"+d,d="get"+d;a[d]||(a[d]=new Function('return this.get("'+c+'")'));a[e]||(a[e]=new Function("value",'return this.set("'+c+'", value)'))}},clipContext:function(a,b){b.save();b.beginPath();a.clipTo(b);b.clip()},multiplyTransformMatrices:function(a,b){for(var c=[[a[0],a[2],a[4]],[a[1],a[3],a[5]],[0,0,1]],d=[[b[0],b[2],b[4]],[b[1],b[3],b[5]],[0,0,1]],e=[],f=0;f<3;f++){e[f]=[];for(var k=0;k<3;k++){for(var j=
0,n=0;n<3;n++)j+=c[f][n]*d[n][k];e[f][k]=j}}return[e[0][0],e[1][0],e[0][1],e[1][1],e[0][2],e[1][2]]},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,c,d){d>0&&(b>d?b-=d:b=0,c>d?c-=d:c=0);for(var e=!0,a=a.getImageData(b,c,d*2||1,d*2||1),b=3,c=a.data.length;b<c;b+=4)if(e=a.data[b]<=0,e===!1)break;return e}}})(typeof k!=="undefined"?k:this);(function(){function d(b,d,g,f,i,k,n){var B=h.call(arguments);if(a[B])return a[B];var v=Math.PI,
C=n*v/180,s=Math.sin(C),C=Math.cos(C),w=0,t=0,g=Math.abs(g),f=Math.abs(f),x=-C*b*0.5-s*d*0.5,u=-C*d*0.5+s*b*0.5,r=g*g,D=f*f,F=u*u,z=x*x,y=r*D-r*F-D*z,A=0;y<0?(r=Math.sqrt(1-y/(r*D)),g*=r,f*=r):A=(i===k?-1:1)*Math.sqrt(y/(r*F+D*z));F=A*g*u/f;z=-A*f*x/g;A=C*F-s*z+b*0.5;r=s*F+C*z+d*0.5;D=e(1,0,(x-F)/g,(u-z)/f);u=e((x-F)/g,(u-z)/f,(-x-F)/g,(-u-z)/f);k===0&&u>0?u-=2*v:k===1&&u<0&&(u+=2*v);v=Math.ceil(Math.abs(u/v*2));x=[];u/=v;F=8/3*Math.sin(u/4)*Math.sin(u/4)/Math.sin(u/2);z=D+u;for(y=0;y<v;y++)x[y]=
c(D,z,C,s,g,f,A,r,F,w,t),w=x[y][4],t=x[y][5],D=z,z+=u;return a[B]=x}function c(a,b,c,d,e,g,f,k,n,C,s){var w=h.call(arguments);if(i[w])return i[w];var t=Math.cos(a),x=Math.sin(a),u=Math.cos(b),r=Math.sin(b),D=c*e*u-d*g*r+f,F=d*e*u+c*g*r+k;i[w]=[C+n*(-c*e*x-d*g*t),s+n*(-d*e*x+c*g*t),D+n*(c*e*r+d*g*u),F+n*(d*e*r-c*g*u),D,F];return i[w]}function e(a,b,c,d){a=Math.atan2(b,a);c=Math.atan2(d,c);return c>=a?c-a:2*Math.PI-(a-c)}function b(a,b,c,d,e,f,i,k){var n=h.call(arguments);if(g[n])return g[n];var C=
Math.sqrt,s=Math.min,w=Math.max,t=Math.abs,x=[],u=[[],[]],r,D,F,z,y;D=6*a-12*c+6*e;r=-3*a+9*c-9*e+3*i;F=3*c-3*a;for(var A=0;A<2;++A)A>0&&(D=6*b-12*d+6*f,r=-3*b+9*d-9*f+3*k,F=3*d-3*b),t(r)<1.0E-12?t(D)<1.0E-12||(z=-F/D,0<z&&z<1&&x.push(z)):(z=D*D-4*F*r,z<0||(y=C(z),z=(-D+y)/(2*r),0<z&&z<1&&x.push(z),z=(-D-y)/(2*r),0<z&&z<1&&x.push(z)));for(t=C=x.length;C--;)z=x[C],D=1-z,r=D*D*D*a+3*D*D*z*c+3*D*z*z*e+z*z*z*i,u[0][C]=r,r=D*D*D*b+3*D*D*z*d+3*D*z*z*f+z*z*z*k,u[1][C]=r;u[0][t]=a;u[1][t]=b;u[0][t+1]=i;u[1][t+
1]=k;s=[{x:s.apply(null,u[0]),y:s.apply(null,u[1])},{x:w.apply(null,u[0]),y:w.apply(null,u[1])}];return g[n]=s}var a={},i={},g={},h=Array.prototype.join;f.util.drawArc=function(a,b,c,e){for(var g=[[],[],[],[]],e=d(e[5]-b,e[6]-c,e[0],e[1],e[3],e[4],e[2]),f=0,h=e.length;f<h;f++)g[f][0]=e[f][0]+b,g[f][1]=e[f][1]+c,g[f][2]=e[f][2]+b,g[f][3]=e[f][3]+c,g[f][4]=e[f][4]+b,g[f][5]=e[f][5]+c,a.bezierCurveTo.apply(a,g[f])};f.util.getBoundsOfArc=function(a,c,e,g,f,h,i,k,n){for(var C=0,s=0,w=[],t=[],e=d(k-a,n-
c,e,g,h,i,f),g=0,f=e.length;g<f;g++)w=b(C,s,e[g][0],e[g][1],e[g][2],e[g][3],e[g][4],e[g][5]),w[0].x+=a,w[0].y+=c,w[1].x+=a,w[1].y+=c,t.push(w[0]),t.push(w[1]),C=e[g][4],s=e[g][5];return t};f.util.getBoundsOfCurve=b})();(function(){function d(c,b,a){if(c&&c.length!==0){var d=c.length-1,g=b?c[d][b]:c[d];if(b)for(;d--;)a(c[d][b],g)&&(g=c[d][b]);else for(;d--;)a(c[d],g)&&(g=c[d]);return g}}var c=Array.prototype.slice;if(!Array.prototype.indexOf)Array.prototype.indexOf=function(c){if(this===void 0||this===
null)throw new TypeError;var b=Object(this),a=b.length>>>0;if(a===0)return-1;var d=0;arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:d!==0&&d!==Number.POSITIVE_INFINITY&&d!==Number.NEGATIVE_INFINITY&&(d=(d>0||-1)*Math.floor(Math.abs(d))));if(d>=a)return-1;for(d=d>=0?d:Math.max(a-Math.abs(d),0);d<a;d++)if(d in b&&b[d]===c)return d;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(c,b){for(var a=0,d=this.length>>>0;a<d;a++)a in this&&c.call(b,this[a],a,this)};if(!Array.prototype.map)Array.prototype.map=
function(c,b){for(var a=[],d=0,g=this.length>>>0;d<g;d++)d in this&&(a[d]=c.call(b,this[d],d,this));return a};if(!Array.prototype.every)Array.prototype.every=function(c,b){for(var a=0,d=this.length>>>0;a<d;a++)if(a in this&&!c.call(b,this[a],a,this))return!1;return!0};if(!Array.prototype.some)Array.prototype.some=function(c,b){for(var a=0,d=this.length>>>0;a<d;a++)if(a in this&&c.call(b,this[a],a,this))return!0;return!1};if(!Array.prototype.filter)Array.prototype.filter=function(c,b){for(var a=[],
d,g=0,f=this.length>>>0;g<f;g++)g in this&&(d=this[g],c.call(b,d,g,this)&&a.push(d));return a};if(!Array.prototype.reduce)Array.prototype.reduce=function(c){var b=this.length>>>0,a=0,d;if(arguments.length>1)d=arguments[1];else{do{if(a in this){d=this[a++];break}if(++a>=b)throw new TypeError;}while(1)}for(;a<b;a++)a in this&&(d=c.call(null,d,this[a],a,this));return d};f.util.array={invoke:function(d,b){for(var a=c.call(arguments,2),f=[],g=0,h=d.length;g<h;g++)f[g]=a.length?d[g][b].apply(d[g],a):d[g][b].call(d[g]);
return f},min:function(c,b){return d(c,b,function(a,b){return a<b})},max:function(c,b){return d(c,b,function(a,b){return a>=b})}}})();(function(){function d(c,d){for(var b in d)c[b]=d[b];return c}f.util.object={extend:d,clone:function(c){return d({},c)}}})();(function(){if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")};f.util.string={camelize:function(d){return d.replace(/-+(.)?/g,function(c,d){return d?d.toUpperCase():""})},
capitalize:function(d,c){return d.charAt(0).toUpperCase()+(c?d.slice(1):d.slice(1).toLowerCase())},escapeXml:function(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();(function(){var d=Array.prototype.slice,c=Function.prototype.apply,e=function(){};if(!Function.prototype.bind)Function.prototype.bind=function(b){var a=this,f=d.call(arguments,1),g;g=f.length?function(){return c.call(a,this instanceof e?this:b,f.concat(d.call(arguments)))}:
function(){return c.call(a,this instanceof e?this:b,arguments)};e.prototype=this.prototype;g.prototype=new e;return g}})();(function(){function d(){}function c(a){var b=this.constructor.superclass.prototype[a];return arguments.length>1?b.apply(this,e.call(arguments,1)):b.call(this)}var e=Array.prototype.slice,b=function(){},a=function(){for(var a in{toString:1})if(a==="toString")return!1;return!0}(),i=function(b,c,d){for(var e in c)if(b.prototype[e]=e in b.prototype&&typeof b.prototype[e]==="function"&&
(c[e]+"").indexOf("callSuper")>-1?function(a){return function(){var b=this.constructor.superclass;this.constructor.superclass=d;var e=c[a].apply(this,arguments);this.constructor.superclass=b;if(a!=="initialize")return e}}(e):c[e],a){if(c.toString!==Object.prototype.toString)b.prototype.toString=c.toString;if(c.valueOf!==Object.prototype.valueOf)b.prototype.valueOf=c.valueOf}};f.util.createClass=function(){function a(){this.initialize.apply(this,arguments)}var f=null,m=e.call(arguments,0);typeof m[0]===
"function"&&(f=m.shift());a.superclass=f;a.subclasses=[];if(f)d.prototype=f.prototype,a.prototype=new d,f.subclasses.push(a);for(var l=0,k=m.length;l<k;l++)i(a,m[l],f);if(!a.prototype.initialize)a.prototype.initialize=b;a.prototype.constructor=a;a.prototype.callSuper=c;return a}})();(function(){function d(a){var b=Array.prototype.slice.call(arguments,1),c,d,e=b.length;for(d=0;d<e;d++)if(c=typeof a[b[d]],!/^(?:function|object|unknown)$/.test(c))return!1;return!0}function c(b,c){return function(d){c.call(a(b),
d||f.window.event)}}function e(a,b){return function(c){if(k[a]&&k[a][b])for(var d=k[a][b],e=0,g=d.length;e<g;e++)d[e].call(this,c||f.window.event)}}function b(a,b,c){var d=a.type==="touchend"?"changedTouches":"touches";return a[d]&&a[d][0]?a[d][0][b]-(a[d][0][b]-a[d][0][c])||a[c]:a[c]}var a,i,g=function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}}();(function(){var b={};a=function(a){return b[a]};i=function(a,c){b[a]=c}})();var h=d(f.document.documentElement,
"addEventListener","removeEventListener")&&d(f.window,"addEventListener","removeEventListener"),m=d(f.document.documentElement,"attachEvent","detachEvent")&&d(f.window,"attachEvent","detachEvent"),l={},k={};h?(h=function(a,b,c){a.addEventListener(b,c,!1)},m=function(a,b,c){a.removeEventListener(b,c,!1)}):m?(h=function(a,b,d){var e=g(a);i(e,a);l[e]||(l[e]={});l[e][b]||(l[e][b]=[]);d={handler:d,wrappedHandler:c(e,d)};l[e][b].push(d);a.attachEvent("on"+b,d.wrappedHandler)},m=function(a,b,c){var d=g(a),
e;if(l[d]&&l[d][b])for(var f=0,h=l[d][b].length;f<h;f++)if((e=l[d][b][f])&&e.handler===c)a.detachEvent("on"+b,e.wrappedHandler),l[d][b][f]=null}):(h=function(a,b,c){var d=g(a);k[d]||(k[d]={});if(!k[d][b]){k[d][b]=[];var f=a["on"+b];f&&k[d][b].push(f);a["on"+b]=e(d,b)}k[d][b].push(c)},m=function(a,b,c){a=g(a);if(k[a]&&k[a][b])for(var b=k[a][b],a=0,d=b.length;a<d;a++)b[a]===c&&b.splice(a,1)});f.util.addListener=h;f.util.removeListener=m;var j=function(a){return typeof a.clientX!=="unknown"?a.clientX:
0},n=function(a){return typeof a.clientY!=="unknown"?a.clientY:0};f.isTouchSupported&&(j=function(a){return b(a,"pageX","clientX")},n=function(a){return b(a,"pageY","clientY")});f.util.getPointer=function(a,b){a||(a=f.window.event);var c=f.util.getScrollLeftTop(a.target||(typeof a.srcElement!=="unknown"?a.srcElement:null),b);return{x:j(a)+c.left,y:n(a)+c.top}};f.util.object.extend(f.util,f.Observable)})();(function(){var d=f.document.createElement("div"),c=typeof d.style.filter==="string",e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,
b=function(a){return a};typeof d.style.opacity==="string"?b=function(a,b){a.style.opacity=b;return a}:c&&(b=function(a,b){var c=a.style;if(a.currentStyle&&!a.currentStyle.hasLayout)c.zoom=1;e.test(c.filter)?c.filter=c.filter.replace(e,b>=0.9999?"":"alpha(opacity="+b*100+")"):c.filter+=" alpha(opacity="+b*100+")";return a});f.util.setStyle=function(a,c){var d=a.style;if(!d)return a;if(typeof c==="string")return a.style.cssText+=";"+c,c.indexOf("opacity")>-1?b(a,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):
a;for(var e in c)e==="opacity"?b(a,c[e]):d[e==="float"||e==="cssFloat"?typeof d.styleFloat==="undefined"?"cssFloat":"styleFloat":e]=c[e];return a}})();(function(){function d(a,b){var c=f.document.createElement(a),d;for(d in b)d==="class"?c.className=b[d]:d==="for"?c.htmlFor=b[d]:c.setAttribute(d,b[d]);return c}var c=Array.prototype.slice,e,b=function(a){return c.call(a,0)};try{e=b(f.document.childNodes)instanceof Array}catch(a){}e||(b=function(a){for(var b=Array(a.length),c=a.length;c--;)b[c]=a[c];
return b});var i;i=f.document.defaultView&&f.document.defaultView.getComputedStyle?function(a,b){var c=f.document.defaultView.getComputedStyle(a,null);return c?c[b]:y}:function(a,b){var c=a.style[b];!c&&a.currentStyle&&(c=a.currentStyle[b]);return c};(function(){var a=f.document.documentElement.style,b="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";f.util.makeElementUnselectable=function(a){if(typeof a.onselectstart!==
"undefined")a.onselectstart=f.util.falseFunction;if(b)a.style[b]="none";else if(typeof a.unselectable==="string")a.unselectable="on";return a};f.util.makeElementSelectable=function(a){if(typeof a.onselectstart!=="undefined")a.onselectstart=null;if(b)a.style[b]="";else if(typeof a.unselectable==="string")a.unselectable="";return a}})();(function(){f.util.getScript=function(a,b){var c=f.document.getElementsByTagName("head")[0],d=f.document.createElement("script"),e=!0;d.onload=d.onreadystatechange=
function(a){var g;if(e&&!(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"))e=!1,b(a||f.window.event),g=d.onload=d.onreadystatechange=null,d=g};d.src=a;c.appendChild(d)}})();f.util.getById=function(a){return typeof a==="string"?f.document.getElementById(a):a};f.util.toArray=b;f.util.makeElement=d;f.util.addClass=function(a,b){a&&(" "+a.className+" ").indexOf(" "+b+" ")===-1&&(a.className+=(a.className?" ":"")+b)};f.util.wrapElement=function(a,b,c){typeof b===
"string"&&(b=d(b,c));a.parentNode&&a.parentNode.replaceChild(b,a);b.appendChild(a);return b};f.util.getScrollLeftTop=function(a,b){var c,d,e=0,i=0,k=f.document.documentElement,n=f.document.body||{scrollLeft:0,scrollTop:0};for(d=a;a&&a.parentNode&&!c;)a=a.parentNode,a.nodeType===1&&f.util.getElementStyle(a,"position")==="fixed"&&(c=a),a.nodeType===1&&d!==b&&f.util.getElementStyle(a,"position")==="absolute"?i=e=0:a===f.document?(e=n.scrollLeft||k.scrollLeft||0,i=n.scrollTop||k.scrollTop||0):(e+=a.scrollLeft||
0,i+=a.scrollTop||0);return{left:e,top:i}};f.util.getElementOffset=function(a){var b;b=a&&a.ownerDocument;var c={left:0,top:0},d={left:0,top:0},e={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!b)return{left:0,top:0};for(var j in e)d[e[j]]+=parseInt(i(a,j),10)||0;b=b.documentElement;typeof a.getBoundingClientRect!=="undefined"&&(c=a.getBoundingClientRect());a=f.util.getScrollLeftTop(a,null);return{left:c.left+a.left-(b.clientLeft||0)+d.left,top:c.top+a.top-(b.clientTop||
0)+d.top}};f.util.getElementStyle=i})();(function(){function d(){}var c=function(){for(var c=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=c.length;b--;)try{if(c[b]())return c[b]}catch(a){}}();f.util.request=function(e,b){b||(b={});var a=b.method?b.method.toUpperCase():"GET",f=b.onComplete||function(){},g=c(),h;g.onreadystatechange=
function(){if(g.readyState===4)f(g),g.onreadystatechange=d};a==="GET"&&(h=null,typeof b.parameters==="string"&&(e=e+(/\?/.test(e)?"&":"?")+b.parameters));g.open(a,e,!0);(a==="POST"||a==="PUT")&&g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");g.send(h);return g}})();f.log=function(){};f.warn=function(){};typeof console!=="undefined"&&["log","warn"].forEach(function(d){typeof console[d]!=="undefined"&&console[d].apply&&(f[d]=function(){return console[d].apply(console,arguments)})});
(function(){function d(){return c.apply(f.window,arguments)}var c=f.window.requestAnimationFrame||f.window.webkitRequestAnimationFrame||f.window.mozRequestAnimationFrame||f.window.oRequestAnimationFrame||f.window.msRequestAnimationFrame||function(c){f.window.setTimeout(c,1E3/60)};f.util.animate=function(c){d(function(b){c||(c={});var a=b||+new Date,f=c.duration||500,g=a+f,h,m=c.onChange||function(){},l=c.abort||function(){return!1},k=c.easing||function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+
c+b},j="startValue"in c?c.startValue:0,b="endValue"in c?c.endValue:100,n=c.byValue||b-j;c.onStart&&c.onStart();(function E(b){h=b||+new Date;b=h>g?f:h-a;l()?c.onComplete&&c.onComplete():(m(k(b,j,n,f)),h>g?c.onComplete&&c.onComplete():d(E))})(a)})};f.util.requestAnimFrame=d})();(function(){function d(a,b,c,d){a<Math.abs(b)?(a=b,d=c/4):d=c/(2*Math.PI)*Math.asin(b/a);return{a:a,c:b,p:c,s:d}}function c(a,b,c){return a.a*Math.pow(2,10*(b-=1))*Math.sin((b*c-a.s)*2*Math.PI/a.p)}function e(a,c,d,e){return d-
b(e-a,0,d,e)+c}function b(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+0.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+0.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+0.984375)+b}f.util.ease={easeInQuad:function(a,b,c,d){return c*(a/=d)*a+b},easeOutQuad:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOutQuad:function(a,b,c,d){a/=d/2;return a<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,c,d){return c*(a/=d)*a*a+b},easeOutCubic:function(a,b,c,d){return c*((a=a/d-
1)*a*a+1)+b},easeInOutCubic:function(a,b,c,d){a/=d/2;return a<1?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b},easeInQuart:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutQuart:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeInOutQuart:function(a,b,c,d){a/=d/2;return a<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},easeInQuint:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},easeOutQuint:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},easeInOutQuint:function(a,b,c,d){a/=d/2;return a<1?c/2*a*a*a*a*a+b:c/2*((a-=
2)*a*a*a*a+2)+b},easeInSine:function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},easeOutSine:function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},easeInOutSine:function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},easeInExpo:function(a,b,c,d){return a===0?b:c*Math.pow(2,10*(a/d-1))+b},easeOutExpo:function(a,b,c,d){return a===d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeInOutExpo:function(a,b,c,d){if(a===0)return b;if(a===d)return b+c;a/=d/2;return a<1?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,
-10*--a)+2)+b},easeInCirc:function(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b},easeOutCirc:function(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b},easeInOutCirc:function(a,b,c,d){a/=d/2;return a<1?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b},easeInElastic:function(a,b,e,f){var m=0;if(a===0)return b;a/=f;if(a===1)return b+e;m||(m=f*0.3);e=d(e,e,m,1.70158);return-c(e,a,f)+b},easeOutElastic:function(a,b,c,e){var f=0;if(a===0)return b;a/=e;if(a===1)return b+c;f||(f=e*0.3);c=d(c,c,f,
1.70158);return c.a*Math.pow(2,-10*a)*Math.sin((a*e-c.s)*2*Math.PI/c.p)+c.c+b},easeInOutElastic:function(a,b,e,f){var m=0;if(a===0)return b;a/=f/2;if(a===2)return b+e;m||(m=f*0.3*1.5);e=d(e,e,m,1.70158);return a<1?-0.5*c(e,a,f)+b:e.a*Math.pow(2,-10*(a-=1))*Math.sin((a*f-e.s)*2*Math.PI/e.p)*0.5+e.c+b},easeInBack:function(a,b,c,d,e){e===y&&(e=1.70158);return c*(a/=d)*a*((e+1)*a-e)+b},easeOutBack:function(a,b,c,d,e){e===y&&(e=1.70158);return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},easeInOutBack:function(a,
b,c,d,e){e===y&&(e=1.70158);a/=d/2;return a<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},easeInBounce:e,easeOutBounce:b,easeInOutBounce:function(a,c,d,f){return a<f/2?e(a*2,0,d,f)*0.5+c:b(a*2-f,0,d,f)*0.5+d*0.5+c}}})();(function(d){function c(a){return a in s?s[a]:a}function e(a,b,c,d){var e=Object.prototype.toString.call(b)==="[object Array]",g;(a==="fill"||a==="stroke")&&b==="none"?b="":a==="strokeDashArray"?b=b.replace(/,/g," ").split(/\s+/).map(function(a){return parseFloat(a)}):
a==="transformMatrix"?b=c&&c.transformMatrix?C(c.transformMatrix,j.parseTransformAttribute(b)):j.parseTransformAttribute(b):a==="visible"?(b=b==="none"||b==="hidden"?!1:!0,c&&c.visible===!1&&(b=!1)):a==="originX"?b=b==="start"?"left":b==="end"?"right":"center":g=e?b.map(v):v(b,d);return!e&&isNaN(g)?b:g}function b(a){for(var b in w)if(a[b]&&typeof a[w[b]]!=="undefined"&&a[b].indexOf("url(")!==0){var c=new j.Color(a[b]);a[b]=c.setAlpha(B(c.getAlpha()*a[w[b]],2)).toRgba()}return a}function a(a,b){var d,
g;a.replace(/;$/,"").split(";").forEach(function(a){a=a.split(":");d=c(a[0].trim().toLowerCase());g=e(d,a[1].trim());b[d]=g})}function f(a,b){var c={},d;for(d in j.cssRules[b]){var e=a,h=d.split(" "),i=void 0,m=!0;if((i=g(e,h.pop()))&&h.length){for(var m=h,l=void 0,k=!0;e.parentNode&&e.parentNode.nodeType===1&&m.length;)k&&(l=m.pop()),e=e.parentNode,k=g(e,l);m=m.length===0}if(i&&m&&h.length===0)for(var o in j.cssRules[b][d])c[o]=j.cssRules[b][d][o]}return c}function g(a,b){var c=a.nodeName,d=a.getAttribute("class"),
e=a.getAttribute("id"),b=b.replace(RegExp("^"+c,"i"),"");e&&b.length&&(b=b.replace(RegExp("#"+e+"(?![a-zA-Z\\-]+)","i"),""));if(d&&b.length){d=d.split(" ");for(e=d.length;e--;)c=RegExp("\\."+d[e]+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"")}return b.length===0}function h(a){for(var b=a.getElementsByTagName("use");b.length;){for(var c=b[0],d=c.getAttribute("xlink:href").substr(1),e=c.getAttribute("x")||0,g=c.getAttribute("y")||0,d=a.getElementById(d).cloneNode(!0),e=(d.getAttribute("transform")||"")+
" translate("+e+", "+g+")",g=0,f=c.attributes,h=f.length;g<h;g++){var i=f.item(g);i.nodeName==="x"||i.nodeName==="y"||i.nodeName==="xlink:href"||(i.nodeName==="transform"?e=i.nodeValue+" "+e:d.setAttribute(i.nodeName,i.nodeValue))}d.setAttribute("transform",e);d.setAttribute("instantiated_by_use","1");d.removeAttribute("id");c.parentNode.replaceChild(d,c)}}function m(a,b,c){var d=RegExp("^\\s*("+j.reNum+"+)\\s*,?\\s*("+j.reNum+"+)\\s*,?\\s*("+j.reNum+"+)\\s*,?\\s*("+j.reNum+"+)\\s*$"),e=a.getAttribute("viewBox"),
g=1,f=1,h=0,i=0;if(e&&(e=e.match(d)))if(h=-parseFloat(e[1]),i=-parseFloat(e[2]),d=parseFloat(e[3]),e=parseFloat(e[4]),b&&b!==d&&(g=b/d),c&&c!==e&&(f=c/e),f=g=g>f?f:g,g!==1||f!==1||h!==0||i!==0){b="matrix("+g+" 0 0 "+f+" "+h*g+" "+i*f+")";if(a.tagName==="svg"){for(c=a.ownerDocument.createElement("g");a.firstChild!=null;)c.appendChild(a.firstChild);a.appendChild(c)}else c=a,b+=c.getAttribute("transform");c.setAttribute("transform",b)}}function l(a){var b=a.objects,a=a.options,b=b.map(function(a){return j[q(a.type)].fromObject(a)});
return{objects:b,options:a}}function k(a,b,c){b[c]&&b[c].toSVG&&a.push('<pattern x="0" y="0" id="',c,'Pattern" ','width="',b[c].source.width,'" height="',b[c].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',b[c].source.width,'" height="',b[c].source.height,'" xlink:href="',b[c].source.src,'"></image></pattern>')}var j=d.fabric||(d.fabric={}),n=j.util.object.extend,q=j.util.string.capitalize,E=j.util.object.clone,B=j.util.toFixed,v=j.util.parseUnit,C=j.util.multiplyTransformMatrices,
s={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration",
"text-anchor":"originX"},w={stroke:"strokeOpacity",fill:"fillOpacity"};j.cssRules={};j.gradientDefs={};j.parseTransformAttribute=function(){function a(b,c){var d=c[0];b[0]=Math.cos(d);b[1]=Math.sin(d);b[2]=-Math.sin(d);b[3]=Math.cos(d)}function b(a,c){var d=c.length===2?c[1]:c[0];a[0]=c[0];a[3]=d}function c(a,b){a[4]=b[0];b.length===2&&(a[5]=b[1])}var d=[1,0,0,1,0,0],e=j.reNum,g="(?:"+("(?:(matrix)\\s*\\(\\s*("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+
e+")(?:\\s+,?\\s*|,\\s*)("+e+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+e+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+e+")\\s*\\))")+")",f=RegExp("^\\s*(?:"+("(?:"+g+"(?:(?:\\s+,?\\s*|,\\s*)"+g+")*)")+"?)\\s*$"),h=RegExp(g,"g");return function(e){var i=
d.concat(),m=[];if(!e||e&&!f.test(e))return i;e.replace(h,function(e){var f=RegExp(g).exec(e).filter(function(a){return a!==""&&a!=null}),e=f[1],f=f.slice(2).map(parseFloat);switch(e){case "translate":c(i,f);break;case "rotate":f[0]=j.util.degreesToRadians(f[0]);a(i,f);break;case "scale":b(i,f);break;case "skewX":i[2]=Math.tan(j.util.degreesToRadians(f[0]));break;case "skewY":i[1]=Math.tan(j.util.degreesToRadians(f[0]));break;case "matrix":i=f}m.push(i.concat());i=d.concat()});for(e=m[0];m.length>
1;)m.shift(),e=j.util.multiplyTransformMatrices(e,m[0]);return e}}();j.parseSVGDocument=function(){var a=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,b=/^(symbol|image|marker|pattern|view)$/;return function(c,d,e){if(c){h(c);var g=new Date,f=j.Object.__uid++,i=v(c.getAttribute("width")||"100%"),l=v(c.getAttribute("height")||"100%");m(c,i,l);var k=j.util.toArray(c.getElementsByTagName("*"));if(k.length===0&&j.isLikelyNode){for(var k=c.selectNodes('//*[name(.)!="svg"]'),o=[],n=0,
p=k.length;n<p;n++)o[n]=k[n];k=o}k=k.filter(function(c){b.test(c.tagName)&&m(c,0,0);var d;if(d=a.test(c.tagName)){a:{for(d=/^(?:pattern|defs|symbol)$/;c&&(c=c.parentNode);)if(d.test(c.nodeName)&&!c.getAttribute("instantiated_by_use")){c=!0;break a}c=!1}d=!c}return d});if(!k||k&&!k.length)d&&d([],{});else{var q={width:i,height:l,widthAttr:i,heightAttr:l,svgUid:f};j.gradientDefs[f]=j.getGradientDefs(c);j.cssRules[f]=j.getCSSRules(c);j.parseElements(k,function(a){j.documentParsingTime=new Date-g;d&&
d(a,q)},E(q),e)}}}}();var t={has:function(a,b){b(!1)},get:function(){},set:function(){}};n(j,{parseFontDeclaration:function(a,b){var c=a.match("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+j.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+j.reNum+"))?\\s+(.*)");if(c){var d=c[1],e=c[3],g=c[4],f=c[5],c=c[6];if(d)b.fontStyle=d;if(e)b.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e);if(g)b.fontSize=v(g);if(c)b.fontFamily=c;if(f)b.lineHeight=
f==="normal"?1:f}},getGradientDefs:function(a){var b=a.getElementsByTagName("linearGradient"),c=a.getElementsByTagName("radialGradient"),d,e=0,g,f=[],a={},h={};f.length=b.length+c.length;for(d=b.length;d--;)f[e++]=b[d];for(d=c.length;d--;)f[e++]=c[d];for(;e--;)b=f[e],c=b.getAttribute("xlink:href"),g=b.getAttribute("id"),c&&(h[g]=c.substr(1)),a[g]=b;for(g in h){e=a[h[g]].cloneNode(!0);for(b=a[g];e.firstChild;)b.appendChild(e.firstChild)}return a},parseAttributes:function(a,d,g){if(a){var h,m={},l;
typeof g==="undefined"&&(g=a.getAttribute("svgUid"));a.parentNode&&/^symbol|[g|a]$/i.test(a.parentNode.nodeName)&&(m=j.parseAttributes(a.parentNode,d,g));l=m&&m.fontSize||a.getAttribute("font-size")||j.Text.DEFAULT_SVG_FONT_SIZE;d=d.reduce(function(b,d){if(h=a.getAttribute(d))d=c(d),h=e(d,h,m,l),b[d]=h;return b},{});d=n(d,n(f(a,g),j.parseStyleAttribute(a)));d.font&&j.parseFontDeclaration(d.font,d);return b(n(m,d))}},parseElements:function(a,b,c,d){(new j.ElementsParser(a,b,c,d)).parse()},parseStyleAttribute:function(b){var d=
{},b=b.getAttribute("style");if(!b)return d;if(typeof b==="string")a(b,d);else{var g,f,h;for(h in b)typeof b[h]!=="undefined"&&(g=c(h.toLowerCase()),f=e(g,b[h]),d[g]=f)}return d},parsePointsAttribute:function(a){if(!a)return null;var a=a.replace(/,/g," ").trim(),a=a.split(/\s+/),b=[],c,d;c=0;for(d=a.length;c<d;c+=2)b.push({x:parseFloat(a[c]),y:parseFloat(a[c+1])});return b},getCSSRules:function(a){for(var a=a.getElementsByTagName("style"),b={},d,g=0,f=a.length;g<f;g++)d=a[g].textContent,d=d.replace(/\/\*[\s\S]*?\*\//g,
""),d.trim()!==""&&(d=d.match(/[^{]*\{[\s\S]*?\}/g),d=d.map(function(a){return a.trim()}),d.forEach(function(a){for(var a=a.match(/([\s\S]*?)\s*\{([^}]*)\}/),d={},g=a[2].trim().replace(/;$/,"").split(/\s*;\s*/),f=0,h=g.length;f<h;f++){var i=g[f].split(/\s*:\s*/),m=c(i[0]),i=e(m,i[1],i[0]);d[m]=i}a=a[1];a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim();a!==""&&(b[a]=j.util.object.clone(d))})}));return b},loadSVGFromURL:function(a,b,c){function d(e){var g=e.responseXML;if(g&&!g.documentElement&&
j.window.ActiveXObject&&e.responseText)g=new ActiveXObject("Microsoft.XMLDOM"),g.async="false",g.loadXML(e.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""));g&&g.documentElement&&j.parseSVGDocument(g.documentElement,function(c,d){t.set(a,{objects:j.util.array.invoke(c,"toObject"),options:d});b(c,d)},c)}a=a.replace(/^\n\s*/,"").trim();t.has(a,function(c){c?t.get(a,function(a){a=l(a);b(a.objects,a.options)}):new j.util.request(a,{method:"get",onComplete:d})})},loadSVGFromString:function(a,
b,c){var a=a.trim(),d;if(typeof DOMParser!=="undefined"){var e=new DOMParser;e&&e.parseFromString&&(d=e.parseFromString(a,"text/xml"))}else if(j.window.ActiveXObject)d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""));j.parseSVGDocument(d.documentElement,function(a,c){b(a,c)},c)},createSVGFontFacesMarkup:function(a){for(var b="",c=0,d=a.length;c<d;c++)a[c].type==="text"&&a[c].path&&(b+=["@font-face {font-family: ",a[c].fontFamily,"; src: url('",
a[c].path,"')}"].join(""));b&&(b=['<style type="text/css"><![CDATA[',b,"]]\></style>"].join(""));return b},createSVGRefElementsMarkup:function(a){var b=[];k(b,a,"backgroundColor");k(b,a,"overlayColor");return b.join("")}})})(typeof k!=="undefined"?k:this);f.ElementsParser=function(d,c,e,b){this.elements=d;this.callback=c;this.options=e;this.reviver=b;this.svgUid=e&&e.svgUid||0};f.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;
this.createObjects()};f.ElementsParser.prototype.createObjects=function(){for(var d=0,c=this.elements.length;d<c;d++)this.elements[d].setAttribute("svgUid",this.svgUid),function(c,b){setTimeout(function(){c.createObject(c.elements[b],b)},0)}(this,d)};f.ElementsParser.prototype.createObject=function(d,c){var e=f[f.util.string.capitalize(d.tagName)];if(e&&e.fromElement)try{this._createObject(e,d,c)}catch(b){f.log(b)}else this.checkIfDone()};f.ElementsParser.prototype._createObject=function(d,c,e){d.async?
d.fromElement(c,this.createCallback(e,c),this.options):(d=d.fromElement(c,this.options),this.resolveGradient(d,"fill"),this.resolveGradient(d,"stroke"),this.reviver&&this.reviver(c,d),this.instances[e]=d,this.checkIfDone())};f.ElementsParser.prototype.createCallback=function(d,c){var e=this;return function(b){e.resolveGradient(b,"fill");e.resolveGradient(b,"stroke");e.reviver&&e.reviver(c,b);e.instances[d]=b;e.checkIfDone()}};f.ElementsParser.prototype.resolveGradient=function(d,c){var e=d.get(c);
/^url\(/.test(e)&&(e=e.slice(5,e.length-1),f.gradientDefs[this.svgUid][e]&&d.set(c,f.Gradient.fromElement(f.gradientDefs[this.svgUid][e],d)))};f.ElementsParser.prototype.checkIfDone=function(){if(--this.numElements===0)this.instances=this.instances.filter(function(d){return d!=null}),this.callback(this.instances)};(function(d){function c(c,b){this.x=c;this.y=b}d=d.fabric||(d.fabric={});d.Point?d.warn("fabric.Point is already defined"):(d.Point=c,c.prototype={constructor:c,add:function(d){return new c(this.x+
d.x,this.y+d.y)},addEquals:function(c){this.x+=c.x;this.y+=c.y;return this},scalarAdd:function(d){return new c(this.x+d,this.y+d)},scalarAddEquals:function(c){this.x+=c;this.y+=c;return this},subtract:function(d){return new c(this.x-d.x,this.y-d.y)},subtractEquals:function(c){this.x-=c.x;this.y-=c.y;return this},scalarSubtract:function(d){return new c(this.x-d,this.y-d)},scalarSubtractEquals:function(c){this.x-=c;this.y-=c;return this},multiply:function(d){return new c(this.x*d,this.y*d)},multiplyEquals:function(c){this.x*=
c;this.y*=c;return this},divide:function(d){return new c(this.x/d,this.y/d)},divideEquals:function(c){this.x/=c;this.y/=c;return this},eq:function(c){return this.x===c.x&&this.y===c.y},lt:function(c){return this.x<c.x&&this.y<c.y},lte:function(c){return this.x<=c.x&&this.y<=c.y},gt:function(c){return this.x>c.x&&this.y>c.y},gte:function(c){return this.x>=c.x&&this.y>=c.y},lerp:function(d,b){return new c(this.x+(d.x-this.x)*b,this.y+(d.y-this.y)*b)},distanceFrom:function(c){var b=this.x-c.x,c=this.y-
c.y;return Math.sqrt(b*b+c*c)},midPointFrom:function(d){return new c(this.x+(d.x-this.x)/2,this.y+(d.y-this.y)/2)},min:function(d){return new c(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new c(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(c,b){this.x=c;this.y=b},setFromPoint:function(c){this.x=c.x;this.y=c.y},swap:function(c){var b=this.x,a=this.y;this.x=c.x;this.y=c.y;c.x=b;c.y=a}})})(typeof k!=="undefined"?k:this);
(function(d){function c(b){this.status=b;this.points=[]}var e=d.fabric||(d.fabric={});e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=c,e.Intersection.prototype={appendPoint:function(b){this.points.push(b)},appendPoints:function(b){this.points=this.points.concat(b)}},e.Intersection.intersectLineLine=function(b,a,d,g){var f,m=(g.x-d.x)*(b.y-d.y)-(g.y-d.y)*(b.x-d.x);f=(a.x-b.x)*(b.y-d.y)-(a.y-b.y)*(b.x-d.x);d=(g.y-d.y)*(a.x-b.x)-(g.x-d.x)*(a.y-b.y);d!==0?(m/=d,f/=d,0<=
m&&m<=1&&0<=f&&f<=1?(f=new c("Intersection"),f.points.push(new e.Point(b.x+m*(a.x-b.x),b.y+m*(a.y-b.y)))):f=new c):f=m===0||f===0?new c("Coincident"):new c("Parallel");return f},e.Intersection.intersectLinePolygon=function(b,a,d){for(var e=new c,f=d.length,m=0;m<f;m++){var l=c.intersectLineLine(b,a,d[m],d[(m+1)%f]);e.appendPoints(l.points)}if(e.points.length>0)e.status="Intersection";return e},e.Intersection.intersectPolygonPolygon=function(b,a){for(var d=new c,e=b.length,f=0;f<e;f++){var m=c.intersectLinePolygon(b[f],
b[(f+1)%e],a);d.appendPoints(m.points)}if(d.points.length>0)d.status="Intersection";return d},e.Intersection.intersectPolygonRectangle=function(b,a,d){var g=a.min(d),f=a.max(d),d=new e.Point(f.x,g.y),m=new e.Point(g.x,f.y),a=c.intersectLinePolygon(g,d,b),d=c.intersectLinePolygon(d,f,b),f=c.intersectLinePolygon(f,m,b),b=c.intersectLinePolygon(m,g,b),g=new c;g.appendPoints(a.points);g.appendPoints(d.points);g.appendPoints(f.points);g.appendPoints(b.points);if(g.points.length>0)g.status="Intersection";
return g})})(typeof k!=="undefined"?k:this);(function(d){function c(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function e(a,b,c){c<0&&(c+=1);c>1&&(c-=1);return c<1/6?a+(b-a)*6*c:c<0.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a}var b=d.fabric||(d.fabric={});b.Color?b.warn("fabric.Color is already defined."):(b.Color=c,b.Color.prototype={_tryParsingColor:function(a){var b;a in c.colorNameMap&&(a=c.colorNameMap[a]);a==="transparent"?this.setSource([255,255,255,0]):((b=c.sourceFromHex(a))||(b=c.sourceFromRgb(a)),
b||(b=c.sourceFromHsl(a)),b&&this.setSource(b))},_rgbToHsl:function(a,c,d){a/=255;c/=255;d/=255;var e,f,l,k=b.util.array.max([a,c,d]);f=b.util.array.min([a,c,d]);l=(k+f)/2;if(k===f)e=f=0;else{var j=k-f;f=l>0.5?j/(2-k-f):j/(k+f);switch(k){case a:e=(c-d)/j+(c<d?6:0);break;case c:e=(d-a)/j+2;break;case d:e=(a-c)/j+4}e/=6}return[Math.round(e*360),Math.round(f*100),Math.round(l*100)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();
return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource(),b,c;b=a[0].toString(16);b=b.length===1?"0"+b:b;c=a[1].toString(16);c=c.length===1?"0"+
c:c;a=a[2].toString(16);a=a.length===1?"0"+a:a;return b.toUpperCase()+c.toUpperCase()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();b[3]=a;this.setSource(b);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((a[0]*0.3+a[1]*0.59+a[2]*0.11).toFixed(0),10);this.setSource([b,b,b,a[3]]);return this},toBlackWhite:function(a){var b=this.getSource(),c=(b[0]*0.3+b[1]*0.59+b[2]*0.11).toFixed(0),b=b[3],c=Number(c)<Number(a||127)?
0:255;this.setSource([c,c,c,b]);return this},overlayWith:function(a){a instanceof c||(a=new c(a));for(var b=[],d=this.getAlpha(),e=this.getSource(),a=a.getSource(),f=0;f<3;f++)b.push(Math.round(e[f]*0.5+a[f]*0.5));b[3]=d;this.setSource(b);return this}},b.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,b.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,
b.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,b.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},b.Color.fromRgb=function(a){return c.fromSource(c.sourceFromRgb(a))},b.Color.sourceFromRgb=function(a){if(a=a.match(c.reRGBa)){var b=parseInt(a[1],10)/(/%$/.test(a[1])?
100:1)*(/%$/.test(a[1])?255:1),d=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),e=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(b,10),parseInt(d,10),parseInt(e,10),a[4]?parseFloat(a[4]):1]}},b.Color.fromRgba=c.fromRgb,b.Color.fromHsl=function(a){return c.fromSource(c.sourceFromHsl(a))},b.Color.sourceFromHsl=function(a){if(a=a.match(c.reHSLa)){var b=(parseFloat(a[1])%360+360)%360/360,d=parseFloat(a[2])/(/%$/.test(a[2])?100:1),f=parseFloat(a[3])/
(/%$/.test(a[3])?100:1);if(d===0)f=d=b=f;else var m=f<=0.5?f*(d+1):f+d-f*d,l=f*2-m,f=e(l,m,b+1/3),d=e(l,m,b),b=e(l,m,b-1/3);return[Math.round(f*255),Math.round(d*255),Math.round(b*255),a[4]?parseFloat(a[4]):1]}},b.Color.fromHsla=c.fromHsl,b.Color.fromHex=function(a){return c.fromSource(c.sourceFromHex(a))},b.Color.sourceFromHex=function(a){if(a.match(c.reHex)){var b=a.slice(a.indexOf("#")+1),d=b.length===3,a=d?b.charAt(0)+b.charAt(0):b.substring(0,2),e=d?b.charAt(1)+b.charAt(1):b.substring(2,4),b=
d?b.charAt(2)+b.charAt(2):b.substring(4,6);return[parseInt(a,16),parseInt(e,16),parseInt(b,16),1]}},b.Color.fromSource=function(a){var b=new c;b.setSource(a);return b})})(typeof k!=="undefined"?k:this);(function(){function d(c){var b=c.getAttribute("style"),a=c.getAttribute("offset"),d,g,a=parseFloat(a)/(/%$/.test(a)?100:1),a=a<0?0:a>1?1:a;if(b){b=b.split(/\s*;\s*/);b[b.length-1]===""&&b.pop();for(var h=b.length;h--;){var m=b[h].split(/\s*:\s*/),l=m[0].trim(),m=m[1].trim();l==="stop-color"?d=m:l===
"stop-opacity"&&(g=m)}}d||(d=c.getAttribute("stop-color")||"rgb(0,0,0)");g||(g=c.getAttribute("stop-opacity"));d=new f.Color(d);c=d.getAlpha();g=isNaN(parseFloat(g))?1:parseFloat(g);g*=c;return{offset:a,color:d.toRgb(),opacity:g}}function c(c,b,a){var d,g=0,f=1,m="",l;for(l in b){d=parseFloat(b[l],10);f=typeof b[l]==="string"&&/^\d+%$/.test(b[l])?0.01:1;if(l==="x1"||l==="x2"||l==="r2")f*=a==="objectBoundingBox"?c.width:1,g=a==="objectBoundingBox"?c.left||0:0;else if(l==="y1"||l==="y2")f*=a==="objectBoundingBox"?
c.height:1,g=a==="objectBoundingBox"?c.top||0:0;b[l]=d*f+g}c.type==="ellipse"&&b.r2!==null&&a==="objectBoundingBox"&&c.rx!==c.ry&&(c=c.ry/c.rx,m=" scale(1, "+c+")",b.y1&&(b.y1/=c),b.y2&&(b.y2/=c));return m}f.Gradient=f.util.createClass({offsetX:0,offsetY:0,initialize:function(c){c||(c={});var b={};this.id=f.Object.__uid++;this.type=c.type||"linear";b={x1:c.coords.x1||0,y1:c.coords.y1||0,x2:c.coords.x2||0,y2:c.coords.y2||0};if(this.type==="radial")b.r1=c.coords.r1||0,b.r2=c.coords.r2||0;this.coords=
b;this.colorStops=c.colorStops.slice();if(c.gradientTransform)this.gradientTransform=c.gradientTransform;this.offsetX=c.offsetX||this.offsetX;this.offsetY=c.offsetY||this.offsetY},addColorStop:function(c){for(var b in c){var a=new f.Color(c[b]);this.colorStops.push({offset:b,color:a.toRgb(),opacity:a.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(c){var b=f.util.object.clone(this.coords),
a;this.colorStops.sort(function(a,b){return a.offset-b.offset});if(!(c.group&&c.group.type==="path-group"))for(var d in b)if(d==="x1"||d==="x2"||d==="r2")b[d]+=this.offsetX-c.width/2;else if(d==="y1"||d==="y2")b[d]+=this.offsetY-c.height/2;c='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';this.gradientTransform&&(c+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" ');this.type==="linear"?a=["<linearGradient ",c,' x1="',b.x1,'" y1="',b.y1,'" x2="',b.x2,'" y2="',b.y2,'">\n']:
this.type==="radial"&&(a=["<radialGradient ",c,' cx="',b.x2,'" cy="',b.y2,'" r="',b.r2,'" fx="',b.x1,'" fy="',b.y1,'">\n']);for(b=0;b<this.colorStops.length;b++)a.push("<stop ",'offset="',this.colorStops[b].offset*100+"%",'" style="stop-color:',this.colorStops[b].color,this.colorStops[b].opacity!=null?";stop-opacity: "+this.colorStops[b].opacity:";",'"/>\n');a.push(this.type==="linear"?"</linearGradient>\n":"</radialGradient>\n");return a.join("")},toLive:function(c,b){var a,d=f.util.object.clone(this.coords);
if(this.type){if(b.group&&b.group.type==="path-group")for(var g in d)if(g==="x1"||g==="x2")d[g]+=-this.offsetX+b.width/2;else if(g==="y1"||g==="y2")d[g]+=-this.offsetY+b.height/2;this.type==="linear"?a=c.createLinearGradient(d.x1,d.y1,d.x2,d.y2):this.type==="radial"&&(a=c.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2));d=0;for(g=this.colorStops.length;d<g;d++){var h=this.colorStops[d].color,m=this.colorStops[d].opacity,l=this.colorStops[d].offset;typeof m!=="undefined"&&(h=(new f.Color(h)).setAlpha(m).toRgba());
a.addColorStop(parseFloat(l),h)}return a}}});f.util.object.extend(f.Gradient,{fromElement:function(e,b){var a=e.getElementsByTagName("stop"),i=e.nodeName==="linearGradient"?"linear":"radial",g=e.getAttribute("gradientUnits")||"objectBoundingBox",h=e.getAttribute("gradientTransform"),m=[],l={};i==="linear"?l={x1:e.getAttribute("x1")||0,y1:e.getAttribute("y1")||0,x2:e.getAttribute("x2")||"100%",y2:e.getAttribute("y2")||0}:i==="radial"&&(l={x1:e.getAttribute("fx")||e.getAttribute("cx")||"50%",y1:e.getAttribute("fy")||
e.getAttribute("cy")||"50%",r1:0,x2:e.getAttribute("cx")||"50%",y2:e.getAttribute("cy")||"50%",r2:e.getAttribute("r")||"50%"});for(var k=a.length;k--;)m.push(d(a[k]));a=c(b,l,g);i=new f.Gradient({type:i,coords:l,colorStops:m,offsetX:-b.left,offsetY:-b.top});if(h||a!=="")i.gradientTransform=f.parseTransformAttribute((h||"")+a);return i},forObject:function(d,b){b||(b={});c(d,b.coords,"userSpaceOnUse");return new f.Gradient(b)}})})();f.Pattern=f.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,
initialize:function(d){d||(d={});this.id=f.Object.__uid++;if(d.source)if(typeof d.source==="string")if(typeof f.util.getFunctionBody(d.source)!=="undefined")this.source=new Function(f.util.getFunctionBody(d.source));else{var c=this;this.source=f.util.createImage();f.util.loadImage(d.source,function(d){c.source=d})}else this.source=d.source;if(d.repeat)this.repeat=d.repeat;if(d.offsetX)this.offsetX=d.offsetX;if(d.offsetY)this.offsetY=d.offsetY},toObject:function(){var d;if(typeof this.source==="function")d=
String(this.source);else if(typeof this.source.src==="string")d=this.source.src;return{source:d,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(d){var c=typeof this.source==="function"?this.source():this.source,e=c.width/d.getWidth(),b=c.height/d.getHeight(),a=this.offsetX/d.getWidth(),d=this.offsetY/d.getHeight(),f="";if(this.repeat==="repeat-x"||this.repeat==="no-repeat")b=1;if(this.repeat==="repeat-y"||this.repeat==="no-repeat")e=1;c.src?f=c.src:c.toDataURL&&(f=c.toDataURL());
return'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+d+'" width="'+e+'" height="'+b+'">\n<image x="0" y="0" width="'+c.width+'" height="'+c.height+'" xlink:href="'+f+'"></image>\n</pattern>\n'},toLive:function(d){var c=typeof this.source==="function"?this.source():this.source;if(!c)return"";if(typeof c.src!=="undefined"){if(!c.complete)return"";if(c.naturalWidth===0||c.naturalHeight===0)return""}return d.createPattern(c,this.repeat)}});(function(d){var c=d.fabric||(d.fabric={});c.Shadow?c.warn("fabric.Shadow is already defined."):
(c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(d){typeof d==="string"&&(d=this._parseShadow(d));for(var b in d)this[b]=d[b];this.id=c.Object.__uid++},_parseShadow:function(d){var d=d.trim(),b=c.Shadow.reOffsetsAndBlur.exec(d)||[];return{color:(d.replace(c.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(b[1],10)||0,offsetY:parseInt(b[2],10)||0,blur:parseInt(b[3],10)||0}},toString:function(){return[this.offsetX,
this.offsetY,this.blur,this.color].join("px ")},toSVG:function(c){var b="SourceAlpha",a=40,d=40;if(c&&(c.fill===this.color||c.stroke===this.color))b="SourceGraphic";c.width&&c.height&&(a=Math.abs(this.offsetX/c.getWidth())*100+20,d=Math.abs(this.offsetY/c.getHeight())*100+20);return'<filter id="SVGID_'+this.id+'" y="-'+d+'%" height="'+(100+2*d)+'%" x="-'+a+'%" width="'+(100+2*a)+'%" >\n\t<feGaussianBlur in="'+b+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur>\n\t<feOffset dx="'+this.offsetX+
'" dy="'+this.offsetY+'"></feOffset>\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var d={},b=c.Shadow.prototype;if(this.color!==b.color)d.color=this.color;if(this.blur!==b.blur)d.blur=this.blur;if(this.offsetX!==b.offsetX)d.offsetX=this.offsetX;if(this.offsetY!==b.offsetY)d.offsetY=this.offsetY;
return d}}),c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})(typeof k!=="undefined"?k:this);(function(){if(f.StaticCanvas)f.warn("fabric.StaticCanvas is already defined.");else{var d=f.util.object.extend,c=f.util.getElementOffset,e=f.util.removeFromArray,b=Error("Could not initialize `canvas` element");f.StaticCanvas=f.util.createClass({initialize:function(a,b){b||(b={});this._initStatic(a,b);f.StaticCanvas.activeInstance=this},
backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);this._initOptions(b);this._setImageSmoothing();b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));
b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this));b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this));b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=c(this.lowerCanvasEl);return this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",
a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=this.imageSmoothingEnabled;a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;a.mozImageSmoothingEnabled=this.imageSmoothingEnabled;a.msImageSmoothingEnabled=this.imageSmoothingEnabled;a.oImageSmoothingEnabled=this.imageSmoothingEnabled},
__setBgOverlayImage:function(a,b,c,d){typeof b==="string"?f.util.loadImage(b,function(b){this[a]=new f.Image(b,d);c&&c()},this,d&&d.crossOrigin):(this[a]=b,c&&c());return this},__setBgOverlayColor:function(a,b,c){if(b&&b.source){var d=this;f.util.loadImage(b.source,function(e){d[a]=new f.Pattern({source:e,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY});c&&c()})}else this[a]=b,c&&c();return this},_createCanvasElement:function(){var a=f.document.createElement("canvas");if(!a.style)a.style={};
if(!a)throw b;this._initCanvasElement(a);return a},_initCanvasElement:function(a){f.util.createCanvasElement(a);if(typeof a.getContext==="undefined")throw b;},_initOptions:function(a){for(var b in a)this[b]=a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(this.lowerCanvasEl.style)this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=
this.height+"px",this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(a){this.lowerCanvasEl=f.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);f.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},
b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var c,b=b||{},d;for(d in a)c=a[d],b.cssOnly||(this._setBackstoreDimension(d,a[d]),c+="px"),b.backstoreOnly||this._setCssDimension(d,c);b.cssOnly||this.renderAll();this.calcOffset();return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;this.upperCanvasEl&&(this.upperCanvasEl[a]=b);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b);this[a]=b;return this},_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=
b;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b);this.wrapperEl&&(this.wrapperEl.style[a]=b);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){this.viewportTransform=a;this.renderAll();for(var a=0,b=this._objects.length;a<b;a++)this._objects[a].setCoords();return this},zoomToPoint:function(a,b){var c=a,a=f.util.transformPoint(a,f.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=b;this.viewportTransform[3]=
b;var d=f.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=c.x-d.x;this.viewportTransform[5]+=c.y-d.y;this.renderAll();c=0;for(d=this._objects.length;c<d;c++)this._objects[c].setCoords();return this},setZoom:function(a){this.zoomToPoint(new f.Point(0,0),a);return this},absolutePan:function(a){this.viewportTransform[4]=-a.x;this.viewportTransform[5]=-a.y;this.renderAll();for(var a=0,b=this._objects.length;a<b;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new f.Point(-a.x-
this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,b){if(b){a.save();var c=this.viewportTransform;a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);this._shouldRenderObject(b)&&b.render(a);a.restore();this.controlsAboveOverlay||b._renderControls(a)}},_shouldRenderObject:function(a){return!a?!1:a!==this.getActiveGroup()||!this.preserveObjectStacking},_onObjectAdded:function(a){this.stateful&&
a.setupState();a.canvas=this;a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&
this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(a){var b=this[a===!0&&this.interactive?"contextTop":"contextContainer"],c=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);a||this.clearContext(b);this.fire("before:render");this.clipTo&&f.util.clipContext(this,
b);this._renderBackground(b);this._renderObjects(b,c);this._renderActiveGroup(b,c);this.clipTo&&b.restore();this._renderOverlay(b);this.controlsAboveOverlay&&this.interactive&&this.drawControls(b);this.fire("after:render");return this},_renderObjects:function(a,b){var c,d;if(!b||this.preserveObjectStacking)for(c=0,d=this._objects.length;c<d;++c)this._draw(a,this._objects[c]);else for(c=0,d=this._objects.length;c<d;++c)this._objects[c]&&!b.contains(this._objects[c])&&this._draw(a,this._objects[c])},
_renderActiveGroup:function(a,b){if(b){var c=[];this.forEachObject(function(a){b.contains(a)&&c.push(a)});b._set("objects",c);this._draw(a,b)}},_renderBackground:function(a){if(this.backgroundColor)a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor,a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height);this.backgroundImage&&this._draw(a,this.backgroundImage)},_renderOverlay:function(a){if(this.overlayColor)a.fillStyle=
this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height);this.overlayImage&&this._draw(a,this.overlayImage)},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a);this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();b&&b.render(a);this._renderOverlay(a);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/
2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new f.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,new f.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(a){var b=this.getCenter();this._centerObject(a,new f.Point(b.left,b.top));this.renderAll();return this},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");return this},
toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,b){var c=this.getActiveGroup();c&&this.discardActiveGroup();var e={objects:this._toObjects(a,b)};d(e,this.__serializeBgOverlay());f.util.populateWithProperties(this,e,b);if(c&&(this.setActiveGroup(new f.Group(c.getObjects(),{originX:"center",originY:"center"})),c.forEachObject(function(a){a.set("active",
!0)}),this._currentTransform))this._currentTransform.target=this.getActiveGroup();return e},_toObjects:function(a,b){return this.getObjects().map(function(c){return this._toObject(c,a,b)},this)},_toObject:function(a,b,c){var d;if(!this.includeDefaultValues)d=a.includeDefaultValues,a.includeDefaultValues=!1;b=a[b](c);if(!this.includeDefaultValues)a.includeDefaultValues=d;return b},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():
this.backgroundColor};if(this.overlayColor)a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor;if(this.backgroundImage)a.backgroundImage=this.backgroundImage.toObject();if(this.overlayImage)a.overlayImage=this.overlayImage.toObject();return a},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});var c=[];this._setSVGPreamble(c,a);this._setSVGHeader(c,a);this._setSVGBgOverlayColor(c,"backgroundColor");this._setSVGBgOverlayImage(c,"backgroundImage");this._setSVGObjects(c,
b);this._setSVGBgOverlayColor(c,"overlayColor");this._setSVGBgOverlayImage(c,"overlayImage");c.push("</svg>");return c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var c,d,e;if(b.viewBox)c=b.viewBox.width,d=b.viewBox.height;else if(c=this.width,d=this.height,!this.svgViewportTransformation)e=
this.viewportTransform,c/=e[0],d/=e[3];a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',c,'" ','height="',d,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,b.viewBox?'viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",f.version,"</desc>","<defs>",f.createSVGFontFacesMarkup(this.getObjects()),
f.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(a,b){var c=this.getActiveGroup();c&&this.discardActiveGroup();for(var d=0,e=this.getObjects(),l=e.length;d<l;d++)a.push(e[d].toSVG(b));c&&(this.setActiveGroup(new f.Group(c.getObjects())),c.forEachObject(function(a){a.set("active",!0)}))},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,
'" ','width="',this[b].repeat==="repeat-y"||this[b].repeat==="no-repeat"?this[b].source.width:this.width,'" height="',this[b].repeat==="repeat-x"||this[b].repeat==="no-repeat"?this[b].source.height:this.height,'" fill="url(#'+b+'Pattern)"',"></rect>"):this[b]&&b==="overlayColor"&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>")},sendToBack:function(a){e(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){e(this._objects,
a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var c=this._objects.indexOf(a);c!==0&&(c=this._findNewLowerIndex(a,c,b),e(this._objects,a),this._objects.splice(c,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,b,c){if(c){c=b;for(b-=1;b>=0;--b)if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b-1;return c},bringForward:function(a,
b){var c=this._objects.indexOf(a);c!==this._objects.length-1&&(c=this._findNewUpperIndex(a,c,b),e(this._objects,a),this._objects.splice(c,0,a),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(a,b,c){if(c){c=b;for(b+=1;b<this._objects.length;++b)if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b+1;return c},moveTo:function(a,b){e(this._objects,a);this._objects.splice(b,
0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});d(f.StaticCanvas.prototype,f.Observable);d(f.StaticCanvas.prototype,f.Collection);d(f.StaticCanvas.prototype,f.DataURLExporter);d(f.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=f.util.createCanvasElement();
if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case "getImageData":return typeof c.getImageData!=="undefined";case "setLineDash":return typeof c.setLineDash!=="undefined";case "toDataURL":return typeof b.toDataURL!=="undefined";case "toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}});f.StaticCanvas.prototype.toJSON=f.StaticCanvas.prototype.toObject}})();f.BaseBrush=f.util.createClass({color:"rgb(0, 0, 0)",
width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(d){this.shadow=new f.Shadow(d);return this},_setBrushStyles:function(){var d=this.canvas.contextTop;d.strokeStyle=this.color;d.lineWidth=this.width;d.lineCap=this.strokeLineCap;d.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var d=this.canvas.contextTop;d.shadowColor=this.shadow.color;d.shadowBlur=this.shadow.blur;d.shadowOffsetX=this.shadow.offsetX;d.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var d=
this.canvas.contextTop;d.shadowColor="";d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0}});(function(){f.PencilBrush=f.util.createClass(f.BaseBrush,{initialize:function(d){this.canvas=d;this._points=[]},onMouseDown:function(d){this._prepareForDrawing(d);this._captureDrawingPath(d);this._render()},onMouseMove:function(d){this._captureDrawingPath(d);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(d){d=new f.Point(d.x,
d.y);this._reset();this._addPoint(d);this.canvas.contextTop.moveTo(d.x,d.y)},_addPoint:function(d){this._points.push(d)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(d){this._addPoint(new f.Point(d.x,d.y))},_render:function(){var d=this.canvas.contextTop,c=this.canvas.viewportTransform,e=this._points[0],b=this._points[1];d.save();d.transform(c[0],c[1],c[2],c[3],c[4],c[5]);d.beginPath();this._points.length===2&&e.x===b.x&&e.y===b.y&&
(e.x-=0.5,b.x+=0.5);d.moveTo(e.x,e.y);for(var c=1,a=this._points.length;c<a;c++)b=e.midPointFrom(b),d.quadraticCurveTo(e.x,e.y,b.x,b.y),e=this._points[c],b=this._points[c+1];d.lineTo(e.x,e.y);d.stroke();d.restore()},convertPointsToSVGPath:function(d){var c=[],e=new f.Point(d[0].x,d[0].y),b=new f.Point(d[1].x,d[1].y);c.push("M ",d[0].x," ",d[0].y," ");for(var a=1,i=d.length;a<i;a++){var g=e.midPointFrom(b);c.push("Q ",e.x," ",e.y," ",g.x," ",g.y," ");e=new f.Point(d[a].x,d[a].y);a+1<d.length&&(b=new f.Point(d[a+
1].x,d[a+1].y))}c.push("L ",e.x," ",e.y," ");return c},createPath:function(d){d=new f.Path(d,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,originX:"center",originY:"center"});if(this.shadow)this.shadow.affectStroke=!0,d.setShadow(this.shadow);return d},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var d=this.convertPointsToSVGPath(this._points).join("");d==="M 0 0 Q 0 0 0 0 L 0 0"?this.canvas.renderAll():
(d=this.createPath(d),this.canvas.add(d),d.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:d}))}})})();f.CircleBrush=f.util.createClass(f.BaseBrush,{width:10,initialize:function(d){this.canvas=d;this.points=[]},drawDot:function(d){var d=this.addPoint(d),c=this.canvas.contextTop,e=this.canvas.viewportTransform;c.save();c.transform(e[0],e[1],e[2],e[3],e[4],e[5]);c.fillStyle=d.fill;c.beginPath();c.arc(d.x,
d.y,d.radius,0,Math.PI*2,!1);c.closePath();c.fill();c.restore()},onMouseDown:function(d){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(d)},onMouseMove:function(d){this.drawDot(d)},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var c=[],e=0,b=this.points.length;e<b;e++){var a=this.points[e],a=new f.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&
a.setShadow(this.shadow);c.push(a)}c=new f.Group(c,{originX:"center",originY:"center"});c.canvas=this.canvas;this.canvas.add(c);this.canvas.fire("path:created",{path:c});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},addPoint:function(d){var d=new f.Point(d.x,d.y),c=f.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,e=(new f.Color(this.color)).setAlpha(f.util.getRandomInt(0,100)/100).toRgba();d.radius=c;d.fill=
e;this.points.push(d);return d}});f.SprayBrush=f.util.createClass(f.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(d){this.canvas=d;this.sprayChunks=[]},onMouseDown:function(d){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(d);this.render()},onMouseMove:function(d){this.addSprayChunk(d);this.render()},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=
!1;for(var c=[],e=0,b=this.sprayChunks.length;e<b;e++)for(var a=this.sprayChunks[e],i=0,g=a.length;i<g;i++){var h=new f.Rect({width:a[i].width,height:a[i].width,left:a[i].x+1,top:a[i].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&h.setShadow(this.shadow);c.push(h)}this.optimizeOverlapping&&(c=this._getOptimizedRects(c));c=new f.Group(c,{originX:"center",originY:"center"});c.canvas=this.canvas;this.canvas.add(c);this.canvas.fire("path:created",{path:c});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},_getOptimizedRects:function(d){for(var c={},e,b=0,a=d.length;b<a;b++)e=d[b].left+""+d[b].top,c[e]||(c[e]=d[b]);d=[];for(e in c)d.push(c[e]);return d},render:function(){var d=this.canvas.contextTop;d.fillStyle=this.color;var c=this.canvas.viewportTransform;d.save();d.transform(c[0],c[1],c[2],c[3],c[4],c[5]);for(var c=0,e=this.sprayChunkPoints.length;c<e;c++){var b=this.sprayChunkPoints[c];if(typeof b.opacity!=="undefined")d.globalAlpha=
b.opacity;d.fillRect(b.x,b.y,b.width,b.width)}d.restore()},addSprayChunk:function(d){this.sprayChunkPoints=[];for(var c,e,b,a=this.width/2,i=0;i<this.density;i++){c=f.util.getRandomInt(d.x-a,d.x+a);e=f.util.getRandomInt(d.y-a,d.y+a);b=this.dotWidthVariance?f.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;c=new f.Point(c,e);c.width=b;if(this.randomOpacity)c.opacity=f.util.getRandomInt(0,100)/100;this.sprayChunkPoints.push(c)}this.sprayChunks.push(this.sprayChunkPoints)}});
f.PatternBrush=f.util.createClass(f.PencilBrush,{getPatternSrc:function(){var d=f.document.createElement("canvas"),c=d.getContext("2d");d.width=d.height=25;c.fillStyle=this.color;c.beginPath();c.arc(10,10,10,0,Math.PI*2,!1);c.closePath();c.fill();return d},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(d){d=this.callSuper("createPath",d);d.stroke=new f.Pattern({source:this.source||this.getPatternSrcFunction()});return d}});(function(){var d=f.util.getPointer,c=f.util.degreesToRadians,e=f.util.radiansToDegrees,b=Math.atan2,a=Math.abs;f.Canvas=f.util.createClass(f.StaticCanvas,{initialize:function(a,b){b||(b={});this._initStatic(a,b);this._initInteractive();this._createCacheCanvas();f.Canvas.activeInstance=this},uniScaleTransform:!1,
centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();
this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=f.PencilBrush&&new f.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(a){var b=this._currentTransform;b.target.set({scaleX:b.original.scaleX,scaleY:b.original.scaleY,left:b.original.left,top:b.original.top});if(this._shouldCenterTransform(a,b.target))if(b.action==="rotate")this._setOriginToCenter(b.target);else{if(b.originX!=="center")b.mouseXSign=b.originX==="right"?-1:1;if(b.originY!=="center")b.mouseYSign=
b.originY==="bottom"?-1:1;b.originX="center";b.originY="center"}else b.originX=b.original.originX,b.originY=b.original.originY},containsPoint:function(a,b){var c=this.getPointer(a,!0),d=this._normalizePointer(b,c);return b.containsPoint(d)||b._findTargetCorner(c)},_normalizePointer:function(a,b){var c=this.getActiveGroup(),d=b.x,e=b.y;c&&a.type!=="group"&&c.contains(a)&&(c=new f.Point(c.left,c.top),c=f.util.transformPoint(c,this.viewportTransform,!0),d-=c.x,e-=c.y);return{x:d,y:e}},isTargetTransparent:function(a,
b,c){var d=a.hasBorders,e=a.transparentCorners;a.hasBorders=a.transparentCorners=!1;this._draw(this.contextCache,a);a.hasBorders=d;a.transparentCorners=e;a=f.util.isTransparent(this.contextCache,b,c,this.targetFindTolerance);this.clearContext(this.contextCache);return a},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),d=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey||b&&!b.evented||b&&!b.selectable&&d&&d!==b},_shouldCenterTransform:function(a,b){if(b){var c=
this._currentTransform,d;c.action==="scale"||c.action==="scaleX"||c.action==="scaleY"?d=this.centeredScaling||b.centeredScaling:c.action==="rotate"&&(d=this.centeredRotation||b.centeredRotation);return d?!a.altKey:a.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};if(b==="ml"||b==="tl"||b==="bl")c.x="right";else if(b==="mr"||b==="tr"||b==="br")c.x="left";if(b==="tl"||b==="mt"||b==="tr")c.y="bottom";else if(b==="bl"||b==="mb"||b==="br")c.y="top";return c},_getActionFromCorner:function(a,
b){var c="drag";b&&(c=b==="ml"||b==="mr"?"scaleX":b==="mt"||b==="mb"?"scaleY":b==="mtr"?"rotate":"scale");return c},_setupCurrentTransform:function(a,b){if(b){var d=this.getPointer(a),e=b._findTargetCorner(this.getPointer(a,!0)),f=this._getActionFromCorner(b,e),e=this._getOriginFromCorner(b,e);this._currentTransform={target:b,action:f,scaleX:b.scaleX,scaleY:b.scaleY,offsetX:d.x-b.left,offsetY:d.y-b.top,originX:e.x,originY:e.y,ex:d.x,ey:d.y,left:b.left,top:b.top,theta:c(b.angle),width:b.width*b.scaleX,
mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:b.left,top:b.top,scaleX:b.scaleX,scaleY:b.scaleY,originX:e.x,originY:e.y};this._resetCurrentTransform(a)}},_translateObject:function(a,b){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",a-this._currentTransform.offsetX);c.get("lockMovementY")||c.set("top",b-this._currentTransform.offsetY)},_scaleObject:function(a,b,c){var d=this._currentTransform,e=d.target,i=e.get("lockScalingX"),k=e.get("lockScalingY"),n=e.get("lockScalingFlip");
if(!i||!k){var E=e.translateToOriginPoint(e.getCenterPoint(),d.originX,d.originY),a=e.toLocalPoint(new f.Point(a,b),d.originX,d.originY);this._setLocalMouse(a,d);this._setObjectScale(a,d,i,k,c,n);e.setPositionByOrigin(E,d.originX,d.originY)}},_setObjectScale:function(a,b,c,d,e,f){var i=b.target,k=!1,n=!1,B=i.stroke?i.strokeWidth:0;b.newScaleX=a.x/(i.width+B/2);b.newScaleY=a.y/(i.height+B/2);f&&b.newScaleX<=0&&b.newScaleX<i.scaleX&&(k=!0);f&&b.newScaleY<=0&&b.newScaleY<i.scaleY&&(n=!0);e==="equally"&&
!c&&!d?k||n||this._scaleObjectEqually(a,i,b):e?e==="x"&&!i.get("lockUniScaling")?k||c||i.set("scaleX",b.newScaleX):e==="y"&&!i.get("lockUniScaling")&&(n||d||i.set("scaleY",b.newScaleY)):(k||c||i.set("scaleX",b.newScaleX),n||d||i.set("scaleY",b.newScaleY));k||n||this._flipObject(b,e)},_scaleObjectEqually:function(a,b,c){var a=a.y+a.x,d=b.stroke?b.strokeWidth:0,d=(b.height+d/2)*c.original.scaleY+(b.width+d/2)*c.original.scaleX;c.newScaleX=c.original.scaleX*a/d;c.newScaleY=c.original.scaleY*a/d;b.set("scaleX",
c.newScaleX);b.set("scaleY",c.newScaleY)},_flipObject:function(a,b){if(a.newScaleX<0&&b!=="y")if(a.originX==="left")a.originX="right";else if(a.originX==="right")a.originX="left";if(a.newScaleY<0&&b!=="x")if(a.originY==="top")a.originY="bottom";else if(a.originY==="bottom")a.originY="top"},_setLocalMouse:function(b,c){var d=c.target;if(c.originX==="right")b.x*=-1;else if(c.originX==="center"&&(b.x*=c.mouseXSign*2,b.x<0))c.mouseXSign=-c.mouseXSign;if(c.originY==="bottom")b.y*=-1;else if(c.originY===
"center"&&(b.y*=c.mouseYSign*2,b.y<0))c.mouseYSign=-c.mouseYSign;a(b.x)>d.padding?b.x<0?b.x+=d.padding:b.x-=d.padding:b.x=0;a(b.y)>d.padding?b.y<0?b.y+=d.padding:b.y-=d.padding:b.y=0},_rotateObject:function(a,c){var d=this._currentTransform;if(!d.target.get("lockRotation")){var f=b(d.ey-d.top,d.ex-d.left),i=b(c-d.top,a-d.left),f=e(i-f+d.theta);f<0&&(f=360+f);d.target.angle=f%360}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.setAngle(0)},
_drawSelection:function(){var b=this.contextTop,c=this._groupSelector,d=c.left,e=c.top,i=a(d),j=a(e);b.fillStyle=this.selectionColor;b.fillRect(c.ex-(d>0?0:-d),c.ey-(e>0?0:-e),i,j);b.lineWidth=this.selectionLineWidth;b.strokeStyle=this.selectionBorderColor;this.selectionDashArray.length>1?(d=c.ex+0.5-(d>0?0:i),c=c.ey+0.5-(e>0?0:j),b.beginPath(),f.util.drawDashedLine(b,d,c,d+i,c,this.selectionDashArray),f.util.drawDashedLine(b,d,c+j-1,d+i,c+j-1,this.selectionDashArray),f.util.drawDashedLine(b,d,c,
d,c+j,this.selectionDashArray),f.util.drawDashedLine(b,d+i-1,c,d+i-1,c+j,this.selectionDashArray),b.closePath(),b.stroke()):b.strokeRect(c.ex+0.5-(d>0?0:i),c.ey+0.5-(e>0?0:j),i,j)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,
!0))},findTarget:function(a,b){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!b&&this.containsPoint(a,c))return c;c=this._searchPossibleTargets(a);this._fireOverOutEvents(c);return c}},_fireOverOutEvents:function(a){if(a){if(this._hoveredTarget!==a)this.fire("mouse:over",{target:a}),a.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),
this._hoveredTarget=a}else if(this._hoveredTarget)this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(a,b))if((this.perPixelTargetFind||b.perPixelTargetFind)&&!b.isEditing){if(!this.isTargetTransparent(b,c.x,c.y))return!0}else return!0},_searchPossibleTargets:function(a){for(var b,c=this.getPointer(a,!0),d=this._objects.length;d--;)if(this._checkTarget(a,this._objects[d],
c)){this.relatedTarget=this._objects[d];b=this._objects[d];break}return b},getPointer:function(a,b,c){var e,i;if(!c)c=this.upperCanvasEl;var a=d(a,c),j=c.getBoundingClientRect(),k=j.width||0,n=j.height||0;if(!k||!n)"top"in j&&"bottom"in j&&(n=Math.abs(j.top-j.bottom)),"right"in j&&"left"in j&&(k=Math.abs(j.right-j.left));this.calcOffset();a.x-=this._offset.left;a.y-=this._offset.top;b||(a=f.util.transformPoint(a,f.util.invertTransform(this.viewportTransform)));k===0||n===0?(e=1,i=1):(e=c.width/k,
i=c.height/n);return{x:a.x*e,y:a.y*i}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();f.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();
this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=f.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});f.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});f.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,
c=this.getHeight()||a.height;f.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0});a.width=b;a.height=c;f.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=a;a.set("active",!0)},setActiveObject:function(a,b){this._setActiveObject(a);
this.renderAll();this.fire("object:selected",{target:a,e:b});a.fire("selected",{e:b});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:a});return this},_setActiveGroup:function(a){(this._activeGroup=a)&&a.set("active",!0)},setActiveGroup:function(a,b){this._setActiveGroup(a);
a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){this._discardActiveGroup();this.fire("selection:cleared",{e:a});return this},deactivateAll:function(){for(var a=this.getObjects(),b=0,c=a.length;b<c;b++)a[b].set("active",!1);this._discardActiveGroup();this._discardActiveObject();
return this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup()||this.getActiveObject();b&&this.fire("before:selection:cleared",{target:b,e:a});this.deactivateAll();b&&this.fire("selection:cleared",{e:a});return this},drawControls:function(a){var b=this.getActiveGroup();b?this._drawGroupControls(a,b):this._drawObjectsControls(a)},_drawGroupControls:function(a,b){b._renderControls(a)},_drawObjectsControls:function(a){for(var b=0,c=this._objects.length;b<c;++b)if(this._objects[b]&&this._objects[b].active)this._objects[b]._renderControls(a),
this.lastRenderedObjectWithControlsAboveOverlay=this._objects[b]}});for(var i in f.StaticCanvas)i!=="prototype"&&(f.Canvas[i]=f.StaticCanvas[i]);if(f.isTouchSupported)f.Canvas.prototype._setCursorFromEvent=function(){};f.Element=f.Canvas})();(function(){var d={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=f.util.addListener,e=f.util.removeListener;f.util.object.extend(f.Canvas.prototype,{cursorMap:"n-resize,ne-resize,e-resize,se-resize,s-resize,sw-resize,w-resize,nw-resize".split(","),_initEventListeners:function(){this._bindEvents();
c(f.window,"resize",this._onResize);c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"mousewheel",this._onMouseWheel);c(this.upperCanvasEl,"touchstart",this._onMouseDown);c(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!=="undefined"&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),
Event.add(this.upperCanvasEl,"shake",this._onShake),Event.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=
this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){e(f.window,"resize",this._onResize);e(this.upperCanvasEl,"mousedown",this._onMouseDown);e(this.upperCanvasEl,"mousemove",this._onMouseMove);e(this.upperCanvasEl,"mousewheel",this._onMouseWheel);e(this.upperCanvasEl,"touchstart",this._onMouseDown);e(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!=="undefined"&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",
this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake),Event.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(b,a){this.__onTransformGesture&&this.__onTransformGesture(b,a)},_onDrag:function(b,a){this.__onDrag&&this.__onDrag(b,a)},_onMouseWheel:function(b,a){this.__onMouseWheel&&this.__onMouseWheel(b,a)},_onOrientationChange:function(b,
a){this.__onOrientationChange&&this.__onOrientationChange(b,a)},_onShake:function(b,a){this.__onShake&&this.__onShake(b,a)},_onLongPress:function(b,a){this.__onLongPress&&this.__onLongPress(b,a)},_onMouseDown:function(b){this.__onMouseDown(b);c(f.document,"touchend",this._onMouseUp);c(f.document,"touchmove",this._onMouseMove);e(this.upperCanvasEl,"mousemove",this._onMouseMove);e(this.upperCanvasEl,"touchmove",this._onMouseMove);b.type==="touchstart"?e(this.upperCanvasEl,"mousedown",this._onMouseDown):
(c(f.document,"mouseup",this._onMouseUp),c(f.document,"mousemove",this._onMouseMove))},_onMouseUp:function(b){this.__onMouseUp(b);e(f.document,"mouseup",this._onMouseUp);e(f.document,"touchend",this._onMouseUp);e(f.document,"mousemove",this._onMouseMove);e(f.document,"touchmove",this._onMouseMove);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"touchmove",this._onMouseMove);if(b.type==="touchend"){var a=this;setTimeout(function(){c(a.upperCanvasEl,"mousedown",a._onMouseDown)},
400)}},_onMouseMove:function(b){!this.allowTouchScrolling&&b.preventDefault&&b.preventDefault();this.__onMouseMove(b)},_onResize:function(){this.calcOffset()},_shouldRender:function(b,a){var c=this.getActiveGroup()||this.getActiveObject();return!!(b&&(b.isMoving||b!==c)||!b&&c||!b&&!c&&!this._groupSelector||a&&this._previousPointer&&this.selection&&(a.x!==this._previousPointer.x||a.y!==this._previousPointer.y))},__onMouseUp:function(b){var a;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(b);
else{this._currentTransform?(this._finalizeCurrentTransform(),a=this._currentTransform.target):a=this.findTarget(b,!0);var c=this._shouldRender(a,this.getPointer(b));this._maybeGroupObjects(b);if(a)a.isMoving=!1;c&&this.renderAll();this._handleCursorAndEvent(b,a)}},_handleCursorAndEvent:function(b,a){this._setCursorFromEvent(b,a);var c=this;setTimeout(function(){c._setCursorFromEvent(b,a)},50);this.fire("mouse:up",{target:a,e:b});a&&a.fire("mouseup",{e:b})},_finalizeCurrentTransform:function(){var b=
this._currentTransform.target;if(b._scaling)b._scaling=!1;b.setCoords();this.stateful&&b.hasStateChanged()&&(this.fire("object:modified",{target:b}),b.fire("modified"));this._restoreOriginXY(b)},_restoreOriginXY:function(b){if(this._previousOriginX&&this._previousOriginY){var a=b.translateToOriginPoint(b.getCenterPoint(),this._previousOriginX,this._previousOriginY);b.originX=this._previousOriginX;b.originY=this._previousOriginY;b.left=a.x;b.top=a.y;this._previousOriginY=this._previousOriginX=null}},
_onMouseDownInDrawingMode:function(b){this._isCurrentlyDrawing=!0;this.discardActiveObject(b).renderAll();this.clipTo&&f.util.clipContext(this,this.contextTop);var a=f.util.invertTransform(this.viewportTransform);this.freeDrawingBrush.onMouseDown(f.util.transformPoint(this.getPointer(b,!0),a));this.fire("mouse:down",{e:b});a=this.findTarget(b);typeof a!=="undefined"&&a.fire("mousedown",{e:b,target:a})},_onMouseMoveInDrawingMode:function(b){if(this._isCurrentlyDrawing){var a=f.util.invertTransform(this.viewportTransform);
this.freeDrawingBrush.onMouseMove(f.util.transformPoint(this.getPointer(b,!0),a))}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:b});a=this.findTarget(b);typeof a!=="undefined"&&a.fire("mousemove",{e:b,target:a})},_onMouseUpInDrawingMode:function(b){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:b});var a=this.findTarget(b);typeof a!=="undefined"&&a.fire("mouseup",{e:b,target:a})},__onMouseDown:function(b){if(("which"in
b?b.which===1:b.button===1)||f.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(b);else if(!this._currentTransform){var a=this.findTarget(b),c=this.getPointer(b,!0);this._previousPointer=c;var d=this._shouldRender(a,c),e=this._shouldGroup(b,a);this._shouldClearSelection(b,a)?this._clearSelection(b,a,c):e&&(this._handleGrouping(b,a),a=this.getActiveGroup());a&&a.selectable&&!e&&(this._beforeTransform(b,a),this._setupCurrentTransform(b,a));d&&this.renderAll();this.fire("mouse:down",
{target:a,e:b});a&&a.fire("mousedown",{e:b})}},_beforeTransform:function(b,a){this.stateful&&a.saveState();if(a._findTargetCorner(this.getPointer(b)))this.onBeforeScaleRotate(a);a!==this.getActiveGroup()&&a!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(a,b))},_clearSelection:function(b,a,c){this.deactivateAllWithDispatch(b);if(a&&a.selectable)this.setActiveObject(a,b);else if(this.selection)this._groupSelector={ex:c.x,ey:c.y,top:0,left:0}},_setOriginToCenter:function(b){this._previousOriginX=
this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var a=b.getCenterPoint();b.originX="center";b.originY="center";b.left=a.x;b.top=a.y;this._currentTransform.left=b.left;this._currentTransform.top=b.top},_setCenterToOrigin:function(b){var a=b.translateToOriginPoint(b.getCenterPoint(),this._previousOriginX,this._previousOriginY);b.originX=this._previousOriginX;b.originY=this._previousOriginY;b.left=a.x;b.top=a.y;this._previousOriginY=this._previousOriginX=
null},__onMouseMove:function(b){var a,c;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(b);else if(!(typeof b.touches!=="undefined"&&b.touches.length>1)){var d=this._groupSelector;d?(c=this.getPointer(b,!0),d.left=c.x-d.ex,d.top=c.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(b):(a=this.findTarget(b),!a||a&&!a.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(b,a));this.fire("mouse:move",{target:a,e:b});a&&a.fire("mousemove",{e:b})}},_transformObject:function(b){var a=
this.getPointer(b),c=this._currentTransform;c.reset=!1;c.target.isMoving=!0;this._beforeScaleTransform(b,c);this._performTransformAction(b,c,a);this.renderAll()},_performTransformAction:function(b,a,c){var d=c.x,c=c.y,e=a.target,f=a.action;f==="rotate"?(this._rotateObject(d,c),this._fire("rotating",e,b)):f==="scale"?(this._onScale(b,a,d,c),this._fire("scaling",e,b)):f==="scaleX"?(this._scaleObject(d,c,"x"),this._fire("scaling",e,b)):f==="scaleY"?(this._scaleObject(d,c,"y"),this._fire("scaling",e,
b)):(this._translateObject(d,c),this._fire("moving",e,b),this.setCursor(this.moveCursor))},_fire:function(b,a,c){this.fire("object:"+b,{target:a,e:c});a.fire(b,{e:c})},_beforeScaleTransform:function(b,a){if(a.action==="scale"||a.action==="scaleX"||a.action==="scaleY"){var c=this._shouldCenterTransform(b,a.target);if(c&&(a.originX!=="center"||a.originY!=="center")||!c&&a.originX==="center"&&a.originY==="center")this._resetCurrentTransform(b),a.reset=!0}},_onScale:function(b,a,c,d){(b.shiftKey||this.uniScaleTransform)&&
!a.target.get("lockUniScaling")?(a.currentAction="scale",this._scaleObject(c,d)):(!a.reset&&a.currentAction==="scale"&&this._resetCurrentTransform(b,a.target),a.currentAction="scaleEqually",this._scaleObject(c,d,"equally"))},_setCursorFromEvent:function(b,a){if(!a||!a.selectable)return this.setCursor(this.defaultCursor),!1;else{var c=this.getActiveGroup();(c=a._findTargetCorner&&(!c||!c.contains(a))&&a._findTargetCorner(this.getPointer(b,!0)))?this._setCornerCursor(c,a):this.setCursor(a.hoverCursor||
this.hoverCursor)}return!0},_setCornerCursor:function(b,a){if(b in d)this.setCursor(this._getRotatedCornerCursor(b,a));else if(b==="mtr"&&a.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(b,a){var c=Math.round(a.getAngle()%360/45);c<0&&(c+=8);c+=d[b];c%=8;return this.cursorMap[c]}})})();(function(){var d=Math.min,c=Math.max;f.util.object.extend(f.Canvas.prototype,{_shouldGroup:function(c,b){var a=this.getActiveObject();
return c.shiftKey&&(this.getActiveGroup()||a&&a!==b)&&this.selection},_handleGrouping:function(c,b){if(b===this.getActiveGroup()&&(b=this.findTarget(c,!0),!b||b.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(b,c):this._createActiveGroup(b,c);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(c,b){var a=this.getActiveGroup();if(a.contains(c)){if(a.removeWithUpdate(c),this._resetObjectTransform(a),c.set("active",!1),a.size()===1){this.discardActiveGroup(b);
this.setActiveObject(a.item(0));return}}else a.addWithUpdate(c),this._resetObjectTransform(a);this.fire("selection:created",{target:a,e:b});a.set("active",!0)},_createActiveGroup:function(c,b){if(this._activeObject&&c!==this._activeObject){var a=this._createGroup(c);a.addWithUpdate();this.setActiveGroup(a);this._activeObject=null;this.fire("selection:created",{target:a,e:b})}c.set("active",!0)},_createGroup:function(c){var b=this.getObjects(),c=b.indexOf(this._activeObject)<b.indexOf(c)?[this._activeObject,
c]:[c,this._activeObject];return new f.Group(c,{canvas:this})},_groupSelectedObjects:function(c){var b=this._collectObjects();b.length===1?this.setActiveObject(b[0],c):b.length>1&&(b=new f.Group(b.reverse(),{canvas:this}),b.addWithUpdate(),this.setActiveGroup(b,c),b.saveCoords(),this.fire("selection:created",{target:b}),this.renderAll())},_collectObjects:function(){var e=[],b;b=this._groupSelector.ex;for(var a=this._groupSelector.ey,i=b+this._groupSelector.left,g=a+this._groupSelector.top,h=new f.Point(d(b,
i),d(a,g)),m=new f.Point(c(b,i),c(a,g)),a=b===i&&a===g,i=this._objects.length;i--;)if((b=this._objects[i])&&b.selectable&&b.visible&&(b.intersectsWithRect(h,m)||b.isContainedWithinRect(h,m)||b.containsPoint(h)||b.containsPoint(m)))if(b.set("active",!0),e.push(b),a)break;return e},_maybeGroupObjects:function(c){this.selection&&this._groupSelector&&this._groupSelectedObjects(c);if(c=this.getActiveGroup())c.setObjectsCoords().setCoords(),c.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=
this._groupSelector=null}})})();f.util.object.extend(f.StaticCanvas.prototype,{toDataURL:function(d){d||(d={});var c=d.format||"png",e=d.quality||1,b=d.multiplier||1,d={left:d.left,top:d.top,width:d.width,height:d.height};return b!==1?this.__toDataURLWithMultiplier(c,e,d,b):this.__toDataURL(c,e,d)},__toDataURL:function(d,c,e){this.renderAll(!0);var b=this.upperCanvasEl||this.lowerCanvasEl,e=this.__getCroppedCanvas(b,e);d==="jpg"&&(d="jpeg");d=f.StaticCanvas.supports("toDataURLWithQuality")?(e||b).toDataURL("image/"+
d,c):(e||b).toDataURL("image/"+d);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return d},__getCroppedCanvas:function(d,c){var e,b;if("left"in c||"top"in c||"width"in c||"height"in c)e=f.util.createCanvasElement(),b=e.getContext("2d"),e.width=c.width||this.width,e.height=c.height||this.height,b.drawImage(d,-c.left||0,-c.top||0);return e},__toDataURLWithMultiplier:function(d,c,e,b){var a=this.getWidth(),f=this.getHeight(),g=a*b,h=f*b,m=this.getActiveObject(),l=this.getActiveGroup(),
k=this.contextTop||this.contextContainer;b>1&&this.setWidth(g).setHeight(h);k.scale(b,b);e.left&&(e.left*=b);e.top&&(e.top*=b);if(e.width)e.width*=b;else if(b<1)e.width=g;if(e.height)e.height*=b;else if(b<1)e.height=h;l?this._tempRemoveBordersControlsFromGroup(l):m&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);d=this.__toDataURL(d,c,e);this.width=a;this.height=f;k.scale(1/b,1/b);this.setWidth(a).setHeight(f);l?this._restoreBordersControlsOnGroup(l):m&&this.setActiveObject&&this.setActiveObject(m);
this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return d},toDataURLWithMultiplier:function(d,c,e){return this.toDataURL({format:d,multiplier:c,quality:e})},_tempRemoveBordersControlsFromGroup:function(d){d.origHasControls=d.hasControls;d.origBorderColor=d.borderColor;d.hasControls=!0;d.borderColor="rgba(0,0,0,0)";d.forEachObject(function(c){c.origBorderColor=c.borderColor;c.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(d){d.hideControls=d.origHideControls;
d.borderColor=d.origBorderColor;d.forEachObject(function(c){c.borderColor=c.origBorderColor;delete c.origBorderColor})}});f.util.object.extend(f.StaticCanvas.prototype,{loadFromDatalessJSON:function(d,c,e){return this.loadFromJSON(d,c,e)},loadFromJSON:function(d,c,e){if(d){var b=typeof d==="string"?JSON.parse(d):d;this.clear();var a=this;this._enlivenObjects(b.objects,function(){a._setBgOverlay(b,c)},e);return this}},_setBgOverlay:function(d,c){var e=this,b={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,
overlayImage:!1};if(!d.backgroundImage&&!d.overlayImage&&!d.background&&!d.overlay)c&&c();else{var a=function(){b.backgroundImage&&b.overlayImage&&b.backgroundColor&&b.overlayColor&&(e.renderAll(),c&&c())};this.__setBgOverlay("backgroundImage",d.backgroundImage,b,a);this.__setBgOverlay("overlayImage",d.overlayImage,b,a);this.__setBgOverlay("backgroundColor",d.background,b,a);this.__setBgOverlay("overlayColor",d.overlay,b,a);a()}},__setBgOverlay:function(d,c,e,b){var a=this;if(c)if(d==="backgroundImage"||
d==="overlayImage")f.Image.fromObject(c,function(c){a[d]=c;e[d]=!0;b&&b()});else this["set"+f.util.string.capitalize(d,!0)](c,function(){e[d]=!0;b&&b()});else e[d]=!0},_enlivenObjects:function(d,c,e){var b=this;if(!d||d.length===0)c&&c();else{var a=this.renderOnAddRemove;this.renderOnAddRemove=!1;f.util.enlivenObjects(d,function(d){d.forEach(function(a,c){b.insertAt(a,c,!0)});b.renderOnAddRemove=a;c&&c()},null,e)}},_toDataURL:function(d,c){this.clone(function(e){c(e.toDataURL(d))})},_toDataURLWithMultiplier:function(d,
c,e){this.clone(function(b){e(b.toDataURLWithMultiplier(d,c))})},clone:function(d,c){var e=JSON.stringify(this.toJSON(c));this.cloneWithoutData(function(b){b.loadFromJSON(e,function(){d&&d(b)})})},cloneWithoutData:function(d){var c=f.document.createElement("canvas");c.width=this.getWidth();c.height=this.getHeight();var e=new f.Canvas(c);e.clipTo=this.clipTo;this.backgroundImage?(e.setBackgroundImage(this.backgroundImage.src,function(){e.renderAll();d&&d(e)}),e.backgroundImageOpacity=this.backgroundImageOpacity,
e.backgroundImageStretch=this.backgroundImageStretch):d&&d(e)}});(function(d){var c=d.fabric||(d.fabric={}),d=c.util.object.extend,e=c.util.toFixed,b=c.util.string.capitalize,a=c.util.degreesToRadians,f=c.StaticCanvas.supports("setLineDash");if(!c.Object)c.Object=c.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",
cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,
includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){a.fill&&
a.fill.colorStops&&!(a.fill instanceof c.Gradient)&&this.set("fill",new c.Gradient(a.fill))},_initPattern:function(a){a.fill&&a.fill.source&&!(a.fill instanceof c.Pattern)&&this.set("fill",new c.Pattern(a.fill));a.stroke&&a.stroke.source&&!(a.stroke instanceof c.Pattern)&&this.set("stroke",new c.Pattern(a.stroke))},_initClipping:function(a){if(a.clipTo&&typeof a.clipTo==="string"&&(a=c.util.getFunctionBody(a.clipTo),typeof a!=="undefined"))this.clipTo=new Function("ctx",a)},setOptions:function(a){for(var b in a)this.set(b,
a[b]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(b,c){this.group&&this.group.transform(b,c);var d=c?this._getLeftTopCoords():this.getCenterPoint();b.translate(d.x,d.y);b.rotate(a(this.angle));b.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(a){var b=c.Object.NUM_FRACTION_DIGITS,b={type:this.type,originX:this.originX,originY:this.originY,left:e(this.left,b),top:e(this.top,b),width:e(this.width,b),height:e(this.height,
b),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:e(this.strokeWidth,b),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:e(this.strokeMiterLimit,b),scaleX:e(this.scaleX,b),scaleY:e(this.scaleY,b),angle:e(this.getAngle(),b),flipX:this.flipX,flipY:this.flipY,opacity:e(this.opacity,b),shadow:this.shadow&&this.shadow.toObject?
this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};this.includeDefaultValues||(b=this._removeDefaultValues(b));c.util.populateWithProperties(this,b,a);return b},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var b=c.util.getKlass(a.type).prototype;b.stateProperties.forEach(function(c){a[c]===b[c]&&delete a[c]});
return a},toString:function(){return"#<fabric."+b(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){typeof a==="object"?this._setObject(a):typeof b==="function"&&a!=="clipTo"?this._set(a,b(this.get(a))):this._set(a,b);return this},_set:function(a,b){(a==="scaleX"||a==="scaleY")&&(b=this._constrainScale(b));a==="scaleX"&&b<0?(this.flipX=!this.flipX,b*=-1):a==="scaleY"&&b<0?(this.flipY=!this.flipY,b*=-1):a==="width"||a==="height"?
this.minScaleLimit=e(Math.min(0.1,1/Math.max(this.width,this.height)),2):a==="shadow"&&b&&!(b instanceof c.Shadow)&&(b=new c.Shadow(b));this[a]=b;return this},toggle:function(a){var b=this.get(a);typeof b==="boolean"&&this.set(a,!b);return this},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(a,b){!(this.width===0&&this.height===0)&&this.visible&&
(a.save(),this._setupCompositeOperation(a),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.group&&this.group.type==="path-group"&&a.translate(-this.group.width/2,-this.group.height/2),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this._setOpacity(a),this._setShadow(a),this.clipTo&&c.util.clipContext(this,a),this._render(a,b),this.clipTo&&a.restore(),this._removeShadow(a),this._restoreCompositeOperation(a),a.restore())},_setOpacity:function(a){this.group&&
this.group._setOpacity(a);a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){if(this.stroke)a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke},_setFillStyles:function(a){if(this.fill)a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill},_renderControls:function(b,d){var e=this.getViewportTransform();b.save();if(this.active&&!d){var f;this.group&&
(f=c.util.transformPoint(this.group.getCenterPoint(),e),b.translate(f.x,f.y),b.rotate(a(this.group.angle)));f=c.util.transformPoint(this.getCenterPoint(),e,null!=this.group);this.group&&(f.x*=this.group.scaleX,f.y*=this.group.scaleY);b.translate(f.x,f.y);b.rotate(a(this.angle));this.drawBorders(b);this.drawControls(b)}b.restore()},_setShadow:function(a){if(this.shadow){var b=this.canvas&&this.canvas._currentMultiplier||1;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*b*(this.scaleX+
this.scaleY)/2;a.shadowOffsetX=this.shadow.offsetX*b*this.scaleX;a.shadowOffsetY=this.shadow.offsetY*b*this.scaleY}},_removeShadow:function(a){if(this.shadow)a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_renderFill:function(a){this.fill&&(a.save(),this.fill.gradientTransform&&a.transform.apply(a,this.fill.gradientTransform),this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),this.fillRule==="evenodd"?a.fill("evenodd"):a.fill(),
a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a))},_renderStroke:function(a){this.stroke&&this.strokeWidth!==0&&(a.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),f?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):(this.stroke.gradientTransform&&a.transform.apply(a,this.stroke.gradientTransform),this._stroke?
this._stroke(a):a.stroke()),this._removeShadow(a),a.restore())},clone:function(a,b){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(b),a):new c.Object(this.toObject(b))},cloneAsImage:function(a){var b=this.toDataURL();c.util.loadImage(b,function(b){a&&a(new c.Image(b))});return this},toDataURL:function(a){a||(a={});var b=c.util.createCanvasElement(),d=this.getBoundingRect();b.width=d.width;b.height=d.height;c.util.wrapElement(b,"div");d=new c.Canvas(b);if(a.format==="jpg")a.format=
"jpeg";if(a.format==="jpeg")d.backgroundColor="#fff";var e={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new c.Point(b.width/2,b.height/2),"center","center");b=this.canvas;d.add(this);a=d.toDataURL(a);this.set(e).setCoords();this.canvas=b;d.dispose();return a},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,b){b||(b={});var d={colorStops:[]};
d.type=b.type||(b.r1||b.r2?"radial":"linear");d.coords={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2};if(b.r1||b.r2)d.coords.r1=b.r1,d.coords.r2=b.r2;for(var e in b.colorStops){var f=new c.Color(b.colorStops[e]);d.colorStops.push({offset:e,color:f.toRgb(),opacity:f.getAlpha()})}return this.set(a,c.Gradient.forObject(this,d))},setPatternFill:function(a){return this.set("fill",new c.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new c.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},
setAngle:function(a){var b=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;b&&this._setOriginToCenter();this.set("angle",a);b&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,b){var b=b||this.canvas.getPointer(a),c=this.translateToOriginPoint(this.getCenterPoint(),
"left","top");return{x:b.x-c.x,y:b.y-c.y}},_setupCompositeOperation:function(a){if(this.globalCompositeOperation)this._prevGlobalCompositeOperation=a.globalCompositeOperation,a.globalCompositeOperation=this.globalCompositeOperation},_restoreCompositeOperation:function(a){if(this.globalCompositeOperation&&this._prevGlobalCompositeOperation)a.globalCompositeOperation=this._prevGlobalCompositeOperation}}),c.util.createAccessors(c.Object),c.Object.prototype.rotate=c.Object.prototype.setAngle,d(c.Object.prototype,
c.Observable),c.Object.NUM_FRACTION_DIGITS=2,c.Object.__uid=0})(typeof k!=="undefined"?k:this);(function(){var d=f.util.degreesToRadians;f.util.object.extend(f.Object.prototype,{translateToCenterPoint:function(c,e,b){var a=c.x,i=c.y,g=this.stroke?this.strokeWidth:0;e==="left"?a=c.x+(this.getWidth()+g*this.scaleX)/2:e==="right"&&(a=c.x-(this.getWidth()+g*this.scaleX)/2);b==="top"?i=c.y+(this.getHeight()+g*this.scaleY)/2:b==="bottom"&&(i=c.y-(this.getHeight()+g*this.scaleY)/2);return f.util.rotatePoint(new f.Point(a,
i),c,d(this.angle))},translateToOriginPoint:function(c,e,b){var a=c.x,i=c.y,g=this.stroke?this.strokeWidth:0;e==="left"?a=c.x-(this.getWidth()+g*this.scaleX)/2:e==="right"&&(a=c.x+(this.getWidth()+g*this.scaleX)/2);b==="top"?i=c.y-(this.getHeight()+g*this.scaleY)/2:b==="bottom"&&(i=c.y+(this.getHeight()+g*this.scaleY)/2);return f.util.rotatePoint(new f.Point(a,i),c,d(this.angle))},getCenterPoint:function(){return this.translateToCenterPoint(new f.Point(this.left,this.top),this.originX,this.originY)},
getPointByOrigin:function(c,d){return this.translateToOriginPoint(this.getCenterPoint(),c,d)},toLocalPoint:function(c,e,b){var a=this.getCenterPoint(),i=this.stroke?this.strokeWidth:0;e&&b?(e=e==="left"?a.x-(this.getWidth()+i*this.scaleX)/2:e==="right"?a.x+(this.getWidth()+i*this.scaleX)/2:a.x,b=b==="top"?a.y-(this.getHeight()+i*this.scaleY)/2:b==="bottom"?a.y+(this.getHeight()+i*this.scaleY)/2:a.y):(e=this.left,b=this.top);return f.util.rotatePoint(new f.Point(c.x,c.y),a,-d(this.angle)).subtractEquals(new f.Point(e,
b))},setPositionByOrigin:function(c,d,b){c=this.translateToOriginPoint(this.translateToCenterPoint(c,d,b),this.originX,this.originY);this.set("left",c.x);this.set("top",c.y)},adjustPosition:function(c){var e=d(this.angle),b=this.getWidth()/2,a=Math.cos(e)*b;b*=Math.sin(e);var f=this.getWidth(),g=Math.cos(e)*f,e=Math.sin(e)*f;this.originX==="center"&&c==="left"||this.originX==="right"&&c==="center"?(this.left-=a,this.top-=b):this.originX==="left"&&c==="center"||this.originX==="center"&&c==="right"?
(this.left+=a,this.top+=b):this.originX==="left"&&c==="right"?(this.left+=g,this.top+=e):this.originX==="right"&&c==="left"&&(this.left-=g,this.top-=e);this.setCoords();this.originX=c},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var c=this.getCenterPoint();this.originY=this.originX="center";this.left=c.x;this.top=c.y},_resetOrigin:function(){var c=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);
this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=c.x;this.top=c.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();(function(){var d=f.util.degreesToRadians;f.util.object.extend(f.Object.prototype,{oCoords:null,intersectsWithRect:function(c,d){var b=this.oCoords,a=new f.Point(b.tl.x,b.tl.y),i=new f.Point(b.tr.x,b.tr.y),g=new f.Point(b.bl.x,b.bl.y),b=new f.Point(b.br.x,
b.br.y);return f.Intersection.intersectPolygonRectangle([a,i,b,g],c,d).status==="Intersection"},intersectsWithObject:function(c){function d(a){return{tl:new f.Point(a.tl.x,a.tl.y),tr:new f.Point(a.tr.x,a.tr.y),bl:new f.Point(a.bl.x,a.bl.y),br:new f.Point(a.br.x,a.br.y)}}var b=d(this.oCoords),c=d(c.oCoords);return f.Intersection.intersectPolygonPolygon([b.tl,b.tr,b.br,b.bl],[c.tl,c.tr,c.br,c.bl]).status==="Intersection"},isContainedWithinObject:function(c){var d=c.getBoundingRect(),c=new f.Point(d.left,
d.top),d=new f.Point(d.left+d.width,d.top+d.height);return this.isContainedWithinRect(c,d)},isContainedWithinRect:function(c,d){var b=this.getBoundingRect();return b.left>=c.x&&b.left+b.width<=d.x&&b.top>=c.y&&b.top+b.height<=d.y},containsPoint:function(c){var d=this._getImageLines(this.oCoords),c=this._findCrossPoints(c,d);return c!==0&&c%2===1},_getImageLines:function(c){return{topline:{o:c.tl,d:c.tr},rightline:{o:c.tr,d:c.br},bottomline:{o:c.br,d:c.bl},leftline:{o:c.bl,d:c.tl}}},_findCrossPoints:function(c,
d){var b,a,f,g=0,h;for(h in d)if(f=d[h],!(f.o.y<c.y&&f.d.y<c.y)&&!(f.o.y>=c.y&&f.d.y>=c.y)&&(f.o.x===f.d.x&&f.o.x>=c.x?b=f.o.x:(b=(f.d.y-f.o.y)/(f.d.x-f.o.x),a=c.y-0*c.x,f=f.o.y-b*f.o.x,b=-(a-f)/(0-b)),b>=c.x&&(g+=1),g===2))break;return g},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var c=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],
d=f.util.array.min(c),c=f.util.array.max(c),c=Math.abs(d-c),b=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],a=f.util.array.min(b),b=f.util.array.max(b),b=Math.abs(a-b);return{left:d,top:a,width:c,height:b}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(c){return Math.abs(c)<this.minScaleLimit?c<0?-this.minScaleLimit:this.minScaleLimit:c},scale:function(c){c=this._constrainScale(c);if(c<0)this.flipX=
!this.flipX,this.flipY=!this.flipY,c*=-1;this.scaleY=this.scaleX=c;this.setCoords();return this},scaleToWidth:function(c){var d=this.getBoundingRectWidth()/this.getWidth();return this.scale(c/this.width/d)},scaleToHeight:function(c){var d=this.getBoundingRectHeight()/this.getHeight();return this.scale(c/this.height/d)},setCoords:function(){var c=this.strokeWidth,e=d(this.angle),b=this.getViewportTransform(),a=function(a){return f.util.transformPoint(a,b)},i=this.width,g=this.height,h=this.strokeLineCap===
"round"||this.strokeLineCap==="square",m=this.type==="line"&&this.width===0,l=this.type==="line"&&this.height===0,k=m||l;m?i=c:l&&(g=c);(h&&l||!k)&&(i+=i>0?c:-c);(h&&m||!k)&&(g+=g>0?c:-c);this.currentWidth=i*this.scaleX;this.currentHeight=g*this.scaleY;if(this.currentWidth<0)this.currentWidth=Math.abs(this.currentWidth);g=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));c=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0);i=
Math.cos(c+e)*g;g*=Math.sin(c+e);var l=Math.sin(e),k=Math.cos(e),h=this.getCenterPoint(),j=new f.Point(this.currentWidth,this.currentHeight),n=new f.Point(h.x-i,h.y-g),q=new f.Point(n.x+j.x*k,n.y+j.x*l),E=new f.Point(n.x-j.y*l,n.y+j.y*k),B=new f.Point(n.x+j.x/2*k,n.y+j.x/2*l),i=a(n),g=a(q),h=a(new f.Point(q.x-j.y*l,q.y+j.y*k)),m=a(E),n=a(new f.Point(n.x-j.y/2*l,n.y+j.y/2*k)),v=a(B),q=a(new f.Point(q.x-j.y/2*l,q.y+j.y/2*k)),l=a(new f.Point(E.x+j.x/2*k,E.y+j.x/2*l)),a=a(new f.Point(B.x,B.y)),k=Math.cos(c+
e)*this.padding*Math.sqrt(2),e=Math.sin(c+e)*this.padding*Math.sqrt(2),i=i.add(new f.Point(-k,-e)),g=g.add(new f.Point(e,-k)),h=h.add(new f.Point(k,e)),m=m.add(new f.Point(-e,k)),n=n.add(new f.Point((-k-e)/2,(-e+k)/2)),v=v.add(new f.Point((e-k)/2,-(e+k)/2)),q=q.add(new f.Point((e+k)/2,(e-k)/2)),l=l.add(new f.Point((k-e)/2,(k+e)/2)),a=a.add(new f.Point((e-k)/2,-(e+k)/2));this.oCoords={tl:i,tr:g,br:h,bl:m,ml:n,mt:v,mr:q,mb:l,mtr:a};this._setCornerCoords&&this._setCornerCoords();return this}})})();f.util.object.extend(f.Object.prototype,
{sendToBack:function(){this.group?f.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?f.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(d){this.group?f.StaticCanvas.prototype.sendBackwards.call(this.group,this,d):this.canvas.sendBackwards(this,d);return this},bringForward:function(d){this.group?f.StaticCanvas.prototype.bringForward.call(this.group,
this,d):this.canvas.bringForward(this,d);return this},moveTo:function(d){this.group?f.StaticCanvas.prototype.moveTo.call(this.group,this,d):this.canvas.moveTo(this,d);return this}});f.util.object.extend(f.Object.prototype,{getSvgStyles:function(){var d=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",c=this.fillRule,e=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",b=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):
"";return["stroke: ",e,"; stroke-width: ",b,"; stroke-dasharray: ",a,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",d,"; fill-rule: ",c,"; opacity: ",typeof this.opacity!=="undefined"?this.opacity:"1",";",this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},
getSvgTransform:function(){if(this.group&&this.group.type==="path-group")return"";var d=f.util.toFixed,c=this.getAngle(),e=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],b=f.util.transformPoint(this.getCenterPoint(),e),a=f.Object.NUM_FRACTION_DIGITS,b=this.type==="path-group"?"":"translate("+d(b.x,a)+" "+d(b.y,a)+")",c=c!==0?" rotate("+d(c,a)+")":"",d=this.scaleX===1&&this.scaleY===1&&e[0]===1&&e[3]===1?"":" scale("+d(this.scaleX*e[0],a)+" "+d(this.scaleY*
e[3],a)+")",a=this.type==="path-group"?this.width*e[0]:0,e=this.type==="path-group"?this.height*e[3]:0;return[b,c,d,this.flipX?" matrix(-1 0 0 1 "+a+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+e+")":""].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+")":""},_createBaseSVGMarkup:function(){var d=[];this.fill&&this.fill.toLive&&d.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&d.push(this.stroke.toSVG(this,!1));this.shadow&&
d.push(this.shadow.toSVG(this));return d}});f.util.object.extend(f.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(d){return this.get(d)!==this.originalState[d]},this)},saveState:function(d){this.stateProperties.forEach(function(c){this.originalState[c]=this.get(c)},this);d&&d.stateProperties&&d.stateProperties.forEach(function(c){this.originalState[c]=this.get(c)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var d=f.util.degreesToRadians;f.util.object.extend(f.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(c){if(!this.hasControls||!this.active)return!1;var d=c.x,c=c.y,b,a;for(a in this.oCoords)if(this.isControlVisible(a)&&(a!=="mtr"||this.hasRotatingPoint))if(!this.get("lockUniScaling")||!(a==="mt"||a==="mr"||a==="mb"||a==="ml"))if(b=this._getImageLines(this.oCoords[a].corner),b=this._findCrossPoints({x:d,y:c},b),b!==0&&b%2===1)return this.__corner=a;return!1},_setCornerCoords:function(){var c=
this.oCoords,e=d(this.angle),b=d(45-this.angle),a=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,f=a*Math.cos(b),b=a*Math.sin(b),a=Math.sin(e),e=Math.cos(e);c.tl.corner={tl:{x:c.tl.x-b,y:c.tl.y-f},tr:{x:c.tl.x+f,y:c.tl.y-b},bl:{x:c.tl.x-f,y:c.tl.y+b},br:{x:c.tl.x+b,y:c.tl.y+f}};c.tr.corner={tl:{x:c.tr.x-b,y:c.tr.y-f},tr:{x:c.tr.x+f,y:c.tr.y-b},br:{x:c.tr.x+b,y:c.tr.y+f},bl:{x:c.tr.x-f,y:c.tr.y+b}};c.bl.corner={tl:{x:c.bl.x-b,y:c.bl.y-f},bl:{x:c.bl.x-f,y:c.bl.y+b},br:{x:c.bl.x+b,y:c.bl.y+f},tr:{x:c.bl.x+
f,y:c.bl.y-b}};c.br.corner={tr:{x:c.br.x+f,y:c.br.y-b},bl:{x:c.br.x-f,y:c.br.y+b},br:{x:c.br.x+b,y:c.br.y+f},tl:{x:c.br.x-b,y:c.br.y-f}};c.ml.corner={tl:{x:c.ml.x-b,y:c.ml.y-f},tr:{x:c.ml.x+f,y:c.ml.y-b},bl:{x:c.ml.x-f,y:c.ml.y+b},br:{x:c.ml.x+b,y:c.ml.y+f}};c.mt.corner={tl:{x:c.mt.x-b,y:c.mt.y-f},tr:{x:c.mt.x+f,y:c.mt.y-b},bl:{x:c.mt.x-f,y:c.mt.y+b},br:{x:c.mt.x+b,y:c.mt.y+f}};c.mr.corner={tl:{x:c.mr.x-b,y:c.mr.y-f},tr:{x:c.mr.x+f,y:c.mr.y-b},bl:{x:c.mr.x-f,y:c.mr.y+b},br:{x:c.mr.x+b,y:c.mr.y+f}};
c.mb.corner={tl:{x:c.mb.x-b,y:c.mb.y-f},tr:{x:c.mb.x+f,y:c.mb.y-b},bl:{x:c.mb.x-f,y:c.mb.y+b},br:{x:c.mb.x+b,y:c.mb.y+f}};c.mtr.corner={tl:{x:c.mtr.x-b+a*this.rotatingPointOffset,y:c.mtr.y-f-e*this.rotatingPointOffset},tr:{x:c.mtr.x+f+a*this.rotatingPointOffset,y:c.mtr.y-b-e*this.rotatingPointOffset},bl:{x:c.mtr.x-f+a*this.rotatingPointOffset,y:c.mtr.y+b-e*this.rotatingPointOffset},br:{x:c.mtr.x+b+a*this.rotatingPointOffset,y:c.mtr.y+f-e*this.rotatingPointOffset}}},drawBorders:function(c){if(!this.hasBorders)return this;
var d=this.padding,b=d*2,a=this.getViewportTransform();c.save();c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;c.strokeStyle=this.borderColor;var i=1/this._constrainScale(this.scaleX),g=1/this._constrainScale(this.scaleY);c.lineWidth=1/this.borderScaleFactor;var h=this.getWidth(),m=this.getHeight(),l=this.strokeWidth,k=this.strokeLineCap==="round"||this.strokeLineCap==="square",j=this.type==="line"&&this.width===0,n=this.type==="line"&&this.height===0,q=j||n;j?h=l/i:n&&(m=l/g);(k&&n||
!q)&&(h+=l/i);(k&&j||!q)&&(m+=l/g);i=f.util.transformPoint(new f.Point(h,m),a,!0);a=i.x;i=i.y;this.group&&(a*=this.group.scaleX,i*=this.group.scaleY);c.strokeRect(~~(-(a/2)-d)-0.5,~~(-(i/2)-d)-0.5,~~(a+b)+1,~~(i+b)+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(d=(-i-d*2)/2,c.beginPath(),c.moveTo(0,d),c.lineTo(0,d-this.rotatingPointOffset),c.closePath(),c.stroke());c.restore();return this},drawControls:function(c){if(!this.hasControls)return this;
var d=this.cornerSize,b=d/2,a=this.getViewportTransform(),i=this.strokeWidth,g=this.width,h=this.height,m=this.strokeLineCap==="round"||this.strokeLineCap==="square",l=this.type==="line"&&this.width===0,k=this.type==="line"&&this.height===0,j=l||k;l?g=i:k&&(h=i);(m&&k||!j)&&(g+=i);(m&&l||!j)&&(h+=i);g*=this.scaleX;h*=this.scaleY;i=f.util.transformPoint(new f.Point(g,h),a,!0);a=i.x;i=i.y;g=-(a/2);h=-(i/2);m=this.padding;d=b-d;l=this.transparentCorners?"strokeRect":"fillRect";c.save();c.lineWidth=1;
c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;c.strokeStyle=c.fillStyle=this.cornerColor;this._drawControl("tl",c,l,g-b-m,h-b-m);this._drawControl("tr",c,l,g+a-b+m,h-b-m);this._drawControl("bl",c,l,g-b-m,h+i+d+m);this._drawControl("br",c,l,g+a+d+m,h+i+d+m);this.get("lockUniScaling")||(this._drawControl("mt",c,l,g+a/2-b,h-b-m),this._drawControl("mb",c,l,g+a/2-b,h+i+d+m),this._drawControl("mr",c,l,g+a+d+m,h+i/2-b),this._drawControl("ml",c,l,g-b-m,h+i/2-b));this.hasRotatingPoint&&this._drawControl("mtr",
c,l,g+a/2-b,h-this.rotatingPointOffset-this.cornerSize/2-m);c.restore();return this},_drawControl:function(c,d,b,a,f){var g=this.cornerSize;this.isControlVisible(c)&&(typeof G_vmlCanvasManager!=="undefined"||this.transparentCorners||d.clearRect(a,f,g,g),d[b](a,f,g,g))},isControlVisible:function(c){return this._getControlsVisibility()[c]},setControlVisible:function(c,d){this._getControlsVisibility()[c]=d;return this},setControlsVisibility:function(c){c||(c={});for(var d in c)this.setControlVisible(d,
c[d]);return this},_getControlsVisibility:function(){if(!this._controlsVisibility)this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0};return this._controlsVisibility}})})();f.util.object.extend(f.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(d,c){var c=c||{},e=function(){},b=c.onComplete||e,a=c.onChange||e,i=this;f.util.animate({startValue:d.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){d.set("left",b);i.renderAll();
a()},onComplete:function(){d.setCoords();b()}});return this},fxCenterObjectV:function(d,c){var c=c||{},e=function(){},b=c.onComplete||e,a=c.onChange||e,i=this;f.util.animate({startValue:d.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){d.set("top",b);i.renderAll();a()},onComplete:function(){d.setCoords();b()}});return this},fxRemove:function(d,c){var c=c||{},e=function(){},b=c.onComplete||e,a=c.onChange||e,i=this;f.util.animate({startValue:d.get("opacity"),
endValue:0,duration:this.FX_DURATION,onStart:function(){d.set("active",!1)},onChange:function(b){d.set("opacity",b);i.renderAll();a()},onComplete:function(){i.remove(d);b()}});return this}});f.util.object.extend(f.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var d=[],c,e;for(c in arguments[0])d.push(c);for(var b=0,a=d.length;b<a;b++)c=d[b],e=b!==a-1,this._animate(c,arguments[0][c],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(d,
c,e,b){var a=this,i,c=c.toString(),e=e?f.util.object.clone(e):{};~d.indexOf(".")&&(i=d.split("."));var g=i?this.get(i[0])[i[1]]:this.get(d);if(!("from"in e))e.from=g;c=~c.indexOf("=")?g+parseFloat(c.replace("=","")):parseFloat(c);f.util.animate({startValue:e.from,endValue:c,byValue:e.by,easing:e.easing,duration:e.duration,abort:e.abort&&function(){return e.abort.call(a)},onChange:function(c){i?a[i[0]][i[1]]=c:a.set(d,c);b||e.onChange&&e.onChange()},onComplete:function(){b||(a.setCoords(),e.onComplete&&
e.onComplete())}})}});(function(d){function c(a,b){var c=a.origin,d=a.axis1,e=a.axis2,f=a.dimension,i=b.nearest,k=b.center,n=b.farthest;return function(){switch(this.get(c)){case i:return Math.min(this.get(d),this.get(e));case k:return Math.min(this.get(d),this.get(e))+0.5*this.get(f);case n:return Math.max(this.get(d),this.get(e))}}}var e=d.fabric||(d.fabric={}),b=e.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},f=e.StaticCanvas.supports("setLineDash");e.Line?e.warn("fabric.Line is already defined"):
(e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(b,c){this.callSuper("_set",
b,c);typeof a[b]!=="undefined"&&this._setWidthHeight();return this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){a.beginPath();if(b){var c=this.getCenterPoint();a.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&
f)c=this.calcLinePoints(),a.moveTo(c.x1,c.y1),a.lineTo(c.x2,c.y2);a.lineWidth=this.strokeWidth;c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=c},_renderDashedStroke:function(a){var b=this.calcLinePoints();a.beginPath();e.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray);a.closePath()},toObject:function(a){return b(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=
this.y2?-1:1;return{x1:a*this.width*0.5,x2:a*this.width*-0.5,y1:b*this.height*0.5,y2:b*this.height*-0.5}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&this.group.type==="path-group"||(c=this.calcLinePoints());b.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),
e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(a,c){var d=e.parseAttributes(a,e.Line.ATTRIBUTE_NAMES);return new e.Line([d.x1||0,d.y1||0,d.x2||0,d.y2||0],b(d,c))},e.Line.fromObject=function(a){return new e.Line([a.x1,a.y1,a.x2,a.y2],a)})})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=Math.PI,b=c.util.object.extend;c.Circle?c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",
radius:0,startAngle:0,endAngle:e*2,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,b){this.callSuper("_set",a,b);a==="radius"&&this.setRadius(b);return this},toObject:function(a){return b(this.callSuper("toObject",a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,
d=0,f=(this.endAngle-this.startAngle)%(2*e);if(f===0)this.group&&this.group.type==="path-group"&&(c=this.left+this.radius,d=this.top+this.radius),b.push("<circle ",'cx="'+c+'" cy="'+d+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var c=Math.cos(this.startAngle)*this.radius,d=Math.sin(this.startAngle)*this.radius,l=Math.cos(this.endAngle)*this.radius,k=Math.sin(this.endAngle)*this.radius;b.push('<path d="M '+
c+" "+d," A "+this.radius+" "+this.radius," 0 ",+(f>e?1:0)+" 1"," "+l+" "+k,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*
this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",a*2).set("height",a*2)},complexity:function(){return 1}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),c.Circle.fromElement=function(a,d){d||(d={});var e=c.parseAttributes(a,c.Circle.ATTRIBUTE_NAMES);if(!("radius"in e&&e.radius>0))throw Error("value of `r` attribute is required and can not be negative");e.left=e.left||0;e.top=e.top||0;e=new c.Circle(b(e,d));e.left-=e.radius;e.top-=e.radius;return e},
c.Circle.fromObject=function(a){return new c.Circle(a)})})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={});c.Triangle?c.warn("fabric.Triangle is already defined"):(c.Triangle=c.util.createClass(c.Object,{type:"triangle",initialize:function(c){c=c||{};this.callSuper("initialize",c);this.set("width",c.width||100).set("height",c.height||100)},_render:function(c){var b=this.width/2,a=this.height/2;c.beginPath();c.moveTo(-b,a);c.lineTo(0,-a);c.lineTo(b,a);c.closePath();this._renderFill(c);
this._renderStroke(c)},_renderDashedStroke:function(d){var b=this.width/2,a=this.height/2;d.beginPath();c.util.drawDashedLine(d,-b,a,0,-a,this.strokeDashArray);c.util.drawDashedLine(d,0,-a,b,a,this.strokeDashArray);c.util.drawDashedLine(d,b,a,-b,a,this.strokeDashArray);d.closePath()},toSVG:function(c){var b=this._createBaseSVGMarkup(),a=this.width/2,d=this.height/2,a=[-a+" "+d,"0 "+-d,a+" "+d].join(",");b.push("<polygon ",'points="',a,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),
'"/>');return c?c(b.join("")):b.join("")},complexity:function(){return 1}}),c.Triangle.fromObject=function(d){return new c.Triangle(d)})})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=Math.PI*2,b=c.util.object.extend;c.Ellipse?c.warn("fabric.Ellipse is already defined."):(c.Ellipse=c.util.createClass(c.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,b){this.callSuper("_set",
a,b);switch(a){case "rx":this.rx=b;this.set("width",b*2);break;case "ry":this.ry=b,this.set("height",b*2)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return b(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0;this.group&&this.group.type==="path-group"&&(c=this.left+this.rx,d=this.top+this.ry);b.push("<ellipse ",'cx="',
c,'" cy="',d,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,e,!1);a.restore();this._renderFill(a);this._renderStroke(a)},complexity:function(){return 1}}),c.Ellipse.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),
c.Ellipse.fromElement=function(a,d){d||(d={});var e=c.parseAttributes(a,c.Ellipse.ATTRIBUTE_NAMES);e.left=e.left||0;e.top=e.top||0;e=new c.Ellipse(b(e,d));e.top-=e.ry;e.left-=e.rx;return e},c.Ellipse.fromObject=function(a){return new c.Ellipse(a)})})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend;c.Rect?console.warn("fabric.Rect is already defined"):(d=c.Object.prototype.stateProperties.concat(),d.push("rx","ry","x","y"),c.Rect=c.util.createClass(c.Object,
{stateProperties:d,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(b){b=b||{};this.callSuper("initialize",b);this._initRxRy()},_initRxRy:function(){if(this.rx&&!this.ry)this.ry=this.rx;else if(this.ry&&!this.rx)this.rx=this.ry},_render:function(b,a){if(this.width===1&&this.height===1)b.fillRect(0,0,1,1);else{var c=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,f=this.height,l=a?this.left:-this.width/2,k=a?this.top:-this.height/2,j=
c!==0||d!==0;b.beginPath();b.moveTo(l+c,k);b.lineTo(l+e-c,k);j&&b.bezierCurveTo(l+e-0.4477152502*c,k,l+e,k+0.4477152502*d,l+e,k+d);b.lineTo(l+e,k+f-d);j&&b.bezierCurveTo(l+e,k+f-0.4477152502*d,l+e-0.4477152502*c,k+f,l+e-c,k+f);b.lineTo(l+c,k+f);j&&b.bezierCurveTo(l+0.4477152502*c,k+f,l,k+f-0.4477152502*d,l,k+f-d);b.lineTo(l,k+d);j&&b.bezierCurveTo(l,k+0.4477152502*d,l+0.4477152502*c,k,l+c,k);b.closePath();this._renderFill(b);this._renderStroke(b)}},_renderDashedStroke:function(b){var a=-this.width/
2,d=-this.height/2,e=this.width,f=this.height;b.beginPath();c.util.drawDashedLine(b,a,d,a+e,d,this.strokeDashArray);c.util.drawDashedLine(b,a+e,d,a+e,d+f,this.strokeDashArray);c.util.drawDashedLine(b,a+e,d+f,a,d+f,this.strokeDashArray);c.util.drawDashedLine(b,a,d+f,a,d,this.strokeDashArray);b.closePath()},toObject:function(b){b=e(this.callSuper("toObject",b),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||this._removeDefaultValues(b);return b},toSVG:function(b){var a=this._createBaseSVGMarkup(),
c=this.left,d=this.top;this.group&&this.group.type==="path-group"||(c=-this.width/2,d=-this.height/2);a.push("<rect ",'x="',c,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return b?b(a.join("")):a.join("")},complexity:function(){return 1}}),c.Rect.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),c.Rect.fromElement=
function(b,a){if(!b)return null;var a=a||{},d=c.parseAttributes(b,c.Rect.ATTRIBUTE_NAMES);d.left=d.left||0;d.top=d.top||0;return new c.Rect(e(a?c.util.object.clone(a):{},d))},c.Rect.fromObject=function(b){return new c.Rect(b)})})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={});c.Polyline?c.warn("fabric.Polyline is already defined"):(c.Polyline=c.util.createClass(c.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(d,b){return c.Polygon.prototype.initialize.call(this,
d,b)},_calcDimensions:function(){return c.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return c.Polygon.prototype._applyPointOffset.call(this)},toObject:function(d){return c.Polygon.prototype.toObject.call(this,d)},toSVG:function(d){return c.Polygon.prototype.toSVG.call(this,d)},_render:function(d){c.Polygon.prototype.commonRender.call(this,d);this._renderFill(d);this._renderStroke(d)},_renderDashedStroke:function(d){var b,a;d.beginPath();for(var f=0,g=this.points.length;f<
g;f++)b=this.points[f],a=this.points[f+1]||b,c.util.drawDashedLine(d,b.x,b.y,a.x,a.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),c.Polyline.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polyline.fromElement=function(d,b){if(!d)return null;b||(b={});var a=c.parsePointsAttribute(d.getAttribute("points")),f=c.parseAttributes(d,c.Polyline.ATTRIBUTE_NAMES);return a===null?null:new c.Polyline(a,c.util.object.extend(f,b))},c.Polyline.fromObject=function(d){return new c.Polyline(d.points,
d,!0)})})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend,b=c.util.array.min,a=c.util.array.max,f=c.util.toFixed;c.Polygon?c.warn("fabric.Polygon is already defined"):(c.Polygon=c.util.createClass(c.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.points=a;this.callSuper("initialize",b);this._calcDimensions();if(!("top"in b))this.top=this.minY;if(!("left"in b))this.left=this.minX},_calcDimensions:function(){var c=
this.points,d=b(c,"x"),e=b(c,"y"),f=a(c,"x"),c=a(c,"y");this.width=f-d||1;this.height=c-e||1;this.minX=d;this.minY=e},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2;a.y-=this.minY+this.height/2},this)},toObject:function(a){return e(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,e=this.points.length;d<e;d++)b.push(f(this.points[d].x,2),",",f(this.points[d].y,2)," ");c.push("<",this.type,
" ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},_render:function(a){this.commonRender(a);this._renderFill(a);if(this.stroke||this.strokeDashArray)a.closePath(),this._renderStroke(a)},commonRender:function(a){var b;a.beginPath();if(this._applyPointOffset)this.group&&this.group.type==="path-group"||this._applyPointOffset(),this._applyPointOffset=null;a.moveTo(this.points[0].x,
this.points[0].y);for(var c=0,d=this.points.length;c<d;c++)b=this.points[c],a.lineTo(b.x,b.y)},_renderDashedStroke:function(a){c.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}}),c.Polygon.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polygon.fromElement=function(a,b){if(!a)return null;b||(b={});var d=c.parsePointsAttribute(a.getAttribute("points")),f=c.parseAttributes(a,c.Polygon.ATTRIBUTE_NAMES);return d===null?null:new c.Polygon(d,
e(f,b))},c.Polygon.fromObject=function(a){return new c.Polygon(a.points,a,!0)})})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.array.min,b=c.util.array.max,a=c.util.object.extend,f=Object.prototype.toString,g=c.util.drawArc,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},m={m:"l",M:"L"};c.Path?c.warn("fabric.Path is already defined"):(c.Path=c.util.createClass(c.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.setOptions(b);if(!a)throw Error("`path` argument is required");
var c=f.call(a)==="[object Array]";if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)){if(!c)this.path=this._parsePath();c=this._parseDimensions();this.minX=c.left;this.minY=c.top;this.width=c.width;this.height=c.height;c.left+=this.originX==="center"?this.width/2:this.originX==="right"?this.width:0;c.top+=this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0;this.top=this.top||c.top;this.left=this.left||c.left;this.pathOffset=this.pathOffset||{x:this.minX+this.width/
2,y:this.minY+this.height/2};b.sourcePath&&this.setSourcePath(b.sourcePath)}},_render:function(a){var b,c=null,d=0,e=0,f=0,h=0,i=0,m=0,k,n,t,x,u=-this.pathOffset.x,r=-this.pathOffset.y;this.group&&this.group.type==="path-group"&&(r=u=0);a.beginPath();for(var s=0,y=this.path.length;s<y;++s){b=this.path[s];switch(b[0]){case "l":f+=b[1];h+=b[2];a.lineTo(f+u,h+r);break;case "L":f=b[1];h=b[2];a.lineTo(f+u,h+r);break;case "h":f+=b[1];a.lineTo(f+u,h+r);break;case "H":f=b[1];a.lineTo(f+u,h+r);break;case "v":h+=
b[1];a.lineTo(f+u,h+r);break;case "V":h=b[1];a.lineTo(f+u,h+r);break;case "m":f+=b[1];h+=b[2];d=f;e=h;a.moveTo(f+u,h+r);break;case "M":f=b[1];h=b[2];d=f;e=h;a.moveTo(f+u,h+r);break;case "c":k=f+b[5];n=h+b[6];i=f+b[3];m=h+b[4];a.bezierCurveTo(f+b[1]+u,h+b[2]+r,i+u,m+r,k+u,n+r);f=k;h=n;break;case "C":f=b[5];h=b[6];i=b[3];m=b[4];a.bezierCurveTo(b[1]+u,b[2]+r,i+u,m+r,f+u,h+r);break;case "s":k=f+b[3];n=h+b[4];i=i?2*f-i:f;m=m?2*h-m:h;a.bezierCurveTo(i+u,m+r,f+b[1]+u,h+b[2]+r,k+u,n+r);i=f+b[1];m=h+b[2];
f=k;h=n;break;case "S":k=b[3];n=b[4];i=2*f-i;m=2*h-m;a.bezierCurveTo(i+u,m+r,b[1]+u,b[2]+r,k+u,n+r);f=k;h=n;i=b[1];m=b[2];break;case "q":k=f+b[3];n=h+b[4];i=f+b[1];m=h+b[2];a.quadraticCurveTo(i+u,m+r,k+u,n+r);f=k;h=n;break;case "Q":k=b[3];n=b[4];a.quadraticCurveTo(b[1]+u,b[2]+r,k+u,n+r);f=k;h=n;i=b[1];m=b[2];break;case "t":k=f+b[1];n=h+b[2];c[0].match(/[QqTt]/)===null?(i=f,m=h):c[0]==="t"?(i=2*f-t,m=2*h-x):c[0]==="q"&&(i=2*f-i,m=2*h-m);t=i;x=m;a.quadraticCurveTo(i+u,m+r,k+u,n+r);f=k;h=n;i=f+b[1];
m=h+b[2];break;case "T":k=b[1];n=b[2];i=2*f-i;m=2*h-m;a.quadraticCurveTo(i+u,m+r,k+u,n+r);f=k;h=n;break;case "a":g(a,f+u,h+r,[b[1],b[2],b[3],b[4],b[5],b[6]+f+u,b[7]+h+r]);f+=b[6];h+=b[7];break;case "A":g(a,f+u,h+r,[b[1],b[2],b[3],b[4],b[5],b[6]+u,b[7]+r]);f=b[6];h=b[7];break;case "z":case "Z":f=d,h=e,a.closePath()}c=b}this._renderFill(a);this._renderStroke(a)},render:function(a,b){this.visible&&(a.save(),this._setupCompositeOperation(a),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),
this.group&&this.group.type==="path-group"&&a.translate(-this.group.width/2,-this.group.height/2),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this._setOpacity(a),this._setShadow(a),this.clipTo&&c.util.clipContext(this,a),this._render(a,b),this.clipTo&&a.restore(),this._removeShadow(a),this._restoreCompositeOperation(a),a.restore())},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(b){b=a(this.callSuper("toObject",
b),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});if(this.sourcePath)b.sourcePath=this.sourcePath;if(this.transformMatrix)b.transformMatrix=this.transformMatrix;return b},toDatalessObject:function(a){a=this.toObject(a);if(this.sourcePath)a.path=this.sourcePath;delete a.sourcePath;return a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d="",e=0,f=this.path.length;e<f;e++)b.push(this.path[e].join(" "));b=b.join(" ");this.group&&this.group.type==="path-group"||
(d="translate("+-this.pathOffset.x+", "+-this.pathOffset.y+")");c.push("<path ",'d="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),d,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,d,e=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,f,g=0,i=this.path.length;g<i;g++){c=this.path[g];f=c.slice(1).trim();for(b.length=0;d=e.exec(f);)b.push(d[0]);
c=[c.charAt(0)];f=0;for(var k=b.length;f<k;f++)d=parseFloat(b[f]),isNaN(d)||c.push(d);d=c[0];f=h[d.toLowerCase()];k=m[d]||d;if(c.length-1>f)for(var n=1,w=c.length;n<w;n+=f)a.push([d].concat(c.slice(n,n+f))),d=k;else a.push(c)}return a},_parseDimensions:function(){for(var a=[],d=[],f,g=null,h=0,i=0,m=0,k=0,n=0,s=0,w,t,x,u,r,y=0,A=this.path.length;y<A;++y){f=this.path[y];switch(f[0]){case "l":m+=f[1];k+=f[2];r=[];break;case "L":m=f[1];k=f[2];r=[];break;case "h":m+=f[1];r=[];break;case "H":m=f[1];r=
[];break;case "v":k+=f[1];r=[];break;case "V":k=f[1];r=[];break;case "m":m+=f[1];k+=f[2];h=m;i=k;r=[];break;case "M":m=f[1];k=f[2];h=m;i=k;r=[];break;case "c":w=m+f[5];t=k+f[6];n=m+f[3];s=k+f[4];r=c.util.getBoundsOfCurve(m,k,m+f[1],k+f[2],n,s,w,t);m=w;k=t;break;case "C":m=f[5];k=f[6];n=f[3];s=f[4];r=c.util.getBoundsOfCurve(m,k,f[1],f[2],n,s,m,k);break;case "s":w=m+f[3];t=k+f[4];n=n?2*m-n:m;s=s?2*k-s:k;r=c.util.getBoundsOfCurve(m,k,n,s,m+f[1],k+f[2],w,t);n=m+f[1];s=k+f[2];m=w;k=t;break;case "S":w=
f[3];t=f[4];n=2*m-n;s=2*k-s;r=c.util.getBoundsOfCurve(m,k,n,s,f[1],f[2],w,t);m=w;k=t;n=f[1];s=f[2];break;case "q":w=m+f[3];t=k+f[4];n=m+f[1];s=k+f[2];r=c.util.getBoundsOfCurve(m,k,n,s,n,s,w,t);m=w;k=t;break;case "Q":n=f[1];s=f[2];r=c.util.getBoundsOfCurve(m,k,n,s,n,s,f[3],f[4]);m=f[3];k=f[4];break;case "t":w=m+f[1];t=k+f[2];g[0].match(/[QqTt]/)===null?(n=m,s=k):g[0]==="t"?(n=2*m-x,s=2*k-u):g[0]==="q"&&(n=2*m-n,s=2*k-s);x=n;u=s;r=c.util.getBoundsOfCurve(m,k,n,s,n,s,w,t);m=w;k=t;n=m+f[1];s=k+f[2];break;
case "T":w=f[1];t=f[2];n=2*m-n;s=2*k-s;r=c.util.getBoundsOfCurve(m,k,n,s,n,s,w,t);m=w;k=t;break;case "a":r=c.util.getBoundsOfArc(m,k,f[1],f[2],f[3],f[4],f[5],f[6]+m,f[7]+k);m+=f[6];k+=f[7];break;case "A":r=c.util.getBoundsOfArc(m,k,f[1],f[2],f[3],f[4],f[5],f[6],f[7]);m=f[6];k=f[7];break;case "z":case "Z":m=h,k=i}g=f;r.forEach(function(b){a.push(b.x);d.push(b.y)});a.push(m);d.push(k)}f=e(a);g=e(d);h=b(a);i=b(d);return{left:f,top:g,width:h-f,height:i-g}}}),c.Path.fromObject=function(a,b){typeof a.path===
"string"?c.loadSVGFromURL(a.path,function(d){var d=d[0],e=a.path;delete a.path;c.util.object.extend(d,a);d.setSourcePath(e);b(d)}):b(new c.Path(a.path,a))},c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]),c.Path.fromElement=function(b,d,e){b=c.parseAttributes(b,c.Path.ATTRIBUTE_NAMES);d&&d(new c.Path(b.d,a(b,e)))},c.Path.async=!0)})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend,b=c.util.array.invoke,a=c.Object.prototype.toObject;c.PathGroup?
c.warn("fabric.PathGroup is already defined"):(c.PathGroup=c.util.createClass(c.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;this.setOptions(b);if(b.widthAttr)this.scaleX=b.widthAttr/b.width;if(b.heightAttr)this.scaleY=b.heightAttr/b.height;this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},render:function(a){if(this.visible){a.save();var b=this.transformMatrix;b&&a.transform(b[0],b[1],b[2],
b[3],b[4],b[5]);this.transform(a);this._setShadow(a);this.clipTo&&c.util.clipContext(this,a);for(var b=0,d=this.paths.length;b<d;++b)this.paths[b].render(a,!0);this.clipTo&&a.restore();this._removeShadow(a);a.restore()}},_set:function(a,b){if(a==="fill"&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(c){c=e(a.call(this,c),{paths:b(this.getObjects(),"toObject",c)});if(this.sourcePath)c.sourcePath=this.sourcePath;return c},
toDatalessObject:function(a){a=this.toObject(a);if(this.sourcePath)a.paths=this.sourcePath;return a},toSVG:function(a){for(var b=this.getObjects(),c="translate("+this.left+" "+this.top+")",c=["<g ",'style="',this.getSvgStyles(),'" ','transform="',c,this.getSvgTransform(),'" ',">\n"],d=0,e=b.length;d<e;d++)c.push(b[d].toSVG(a));c.push("</g>\n");return a?a(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=
(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(b){return(b.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),c.PathGroup.fromObject=function(a,b){typeof a.paths==="string"?c.loadSVGFromURL(a.paths,function(d){var e=a.paths;delete a.paths;d=c.util.groupSVGElements(d,a,e);b(d)}):c.util.enlivenObjects(a.paths,function(d){delete a.paths;
b(new c.PathGroup(d,a))})},c.PathGroup.async=!0)})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend,b=c.util.array.min,a=c.util.array.max,f=c.util.array.invoke;if(!c.Group){var g={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};c.Group=c.util.createClass(c.Object,c.Collection,{type:"group",initialize:function(a,b){b=b||{};this._objects=a||[];for(var c=this._objects.length;c--;)this._objects[c].group=
this;this.originalState={};this.callSuper("initialize");if(b.originX)this.originX=b.originX;if(b.originY)this.originY=b.originY;this._calcBounds();this._updateObjectsCoords();b&&e(this,b);this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),c=a.getTop(),d=this.getCenterPoint();a.set({originalLeft:b,originalTop:c,left:b-d.x,top:c-d.y});a.setCoords();a.__origHasControls=a.hasControls;
a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();if(a)this._objects.push(a),a.group=this;this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();
this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties){var c=this._objects.length;for(this[a]=b;c--;)this._objects[c].set(a,b)}else this[a]=b},toObject:function(a){return e(this.callSuper("toObject",
a),{objects:f(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save();this.clipTo&&c.util.clipContext(this,a);for(var b=0,d=this._objects.length;b<d;b++)this._renderObject(this._objects[b],a);this.clipTo&&a.restore();a.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,d=this._objects.length;c<d;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){var c=a.hasRotatingPoint;if(a.visible)a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=
c},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_moveFlippedObject:function(a){var b=a.get("originX"),c=a.get("originY"),d=a.getCenterPoint();a.set({originX:"center",originY:"center",left:d.x,top:d.y});this._toggleFlipping(a);d=a.getPointByOrigin(b,c);a.set({originX:b,originY:c,left:d.x,top:d.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&(a.toggle("flipY"),
a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var b=this.getCenterPoint(),c=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b.x+c.left,top:b.y+c.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=
this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==
this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_calcBounds:function(a){for(var b=[],c=[],d,e=0,f=this._objects.length;e<f;++e){d=this._objects[e];d.setCoords();for(var g in d.oCoords)b.push(d.oCoords[g].x),c.push(d.oCoords[g].y)}this.set(this._getBounds(b,c,a))},_getBounds:function(d,e,f){var g=c.util.invertTransform(this.getViewportTransform()),i=c.util.transformPoint(new c.Point(b(d),b(e)),g),d=c.util.transformPoint(new c.Point(a(d),a(e)),
g),d={width:d.x-i.x||0,height:d.y-i.y||0};if(!f)d.left=i.x||0,d.top=i.y||0,this.originX==="center"&&(d.left+=d.width/2),this.originX==="right"&&(d.left+=d.width),this.originY==="center"&&(d.top+=d.height/2),this.originY==="bottom"&&(d.top+=d.height);return d},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">\n'],c=0,d=this._objects.length;c<d;c++)b.push(this._objects[c].toSVG(a));b.push("</g>\n");return a?a(b.join("")):b.join("")},get:function(a){if(a in g)if(this[a])return this[a];
else{for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}else return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});c.Group.fromObject=function(a,b){c.util.enlivenObjects(a.objects,function(d){delete a.objects;b&&b(new c.Group(d,a))})};c.Group.async=!0}})(typeof k!=="undefined"?k:this);(function(d){var c=f.util.object.extend;if(!d.fabric)d.fabric={};d.fabric.Image?f.warn("fabric.Image is already defined."):(f.Image=f.util.createClass(f.Object,
{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(c,b){b||(b={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",b);this._initElement(c,b);this._initConfig(b);if(b.filters)this.filters=b.filters,this.applyFilters()},getElement:function(){return this._element},setElement:function(c,b,a){this._originalElement=this._element=c;this._initConfig(a);this.filters.length!==0?this.applyFilters(b):b&&b();return this},
setCrossOrigin:function(c){this.crossOrigin=c;this._element.crossOrigin=c;return this},getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},_stroke:function(c){c.save();this._setStrokeStyles(c);c.beginPath();c.strokeRect(-this.width/2,-this.height/2,this.width,this.height);c.closePath();c.restore()},_renderDashedStroke:function(c){var b=-this.width/2,a=-this.height/2,d=this.width,g=this.height;c.save();this._setStrokeStyles(c);c.beginPath();f.util.drawDashedLine(c,
b,a,b+d,a,this.strokeDashArray);f.util.drawDashedLine(c,b+d,a,b+d,a+g,this.strokeDashArray);f.util.drawDashedLine(c,b+d,a+g,b,a+g,this.strokeDashArray);f.util.drawDashedLine(c,b,a+g,b,a,this.strokeDashArray);c.closePath();c.restore()},toObject:function(d){return c(this.callSuper("toObject",d),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(b){return b&&b.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},
toSVG:function(c){var b=[],a=-this.width/2,d=-this.height/2,f="none";if(this.group&&this.group.type==="path-group")a=this.left,d=this.top;this.alignX!=="none"&&this.alignY!=="none"&&(f="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',a,'" y="',d,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',f,'"',"></image>\n");
if(this.stroke||this.strokeDashArray)f=this.fill,this.fill=null,b.push("<rect ",'x="',a,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f;b.push("</g>\n");return c?c(b.join("")):b.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(c,b,a){f.util.loadImage(c,function(c){return this.setElement(c,b,a)},this,a&&a.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+
this.getSrc()+'" }>'},clone:function(c,b){this.constructor.fromObject(this.toObject(b),c)},applyFilters:function(c,b,a,d){b=b||this.filters;if(a=a||this._originalElement){var g=a,h=f.util.createCanvasElement(),k=f.util.createImage(),l=this;h.width=g.width;h.height=g.height;h.getContext("2d").drawImage(g,0,0,g.width,g.height);if(b.length===0)return this._element=a,c&&c(),h;b.forEach(function(a){a&&a.applyTo(h,a.scaleX||l.scaleX,a.scaleY||l.scaleY);!d&&a.type==="Resize"&&(l.width*=a.scaleX,l.height*=
a.scaleY)});k.width=h.width;k.height=h.height;f.isLikelyNode?(k.src=h.toBuffer(y,f.Image.pngCompression),l._element=k,!d&&(l._filteredEl=k),c&&c()):(k.onload=function(){l._element=k;!d&&(l._filteredEl=k);c&&c();k.onload=h=g=null},k.src=h.toDataURL("image/png"));return h}},_render:function(c,b){var a,d,f=this._findMargins(),h;a=b?this.left:-this.width/2;d=b?this.top:-this.height/2;this.meetOrSlice==="slice"&&(c.beginPath(),c.rect(a,d,this.width,this.height),c.clip());this.isMoving===!1&&this.resizeFilters.length&&
this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,h=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!1)):h=this._element;h&&c.drawImage(h,a+f.marginX,d+f.marginY,f.width,f.height);this._renderStroke(c)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var c=this.width,b=this.height,a=0,d=0;if(this.alignX!=="none"||this.alignY!=="none")c=[this.width/this._element.width,
this.height/this._element.height],b=this.meetOrSlice==="meet"?Math.min.apply(null,c):Math.max.apply(null,c),c=this._element.width*b,b*=this._element.height,this.alignX==="Mid"&&(a=(this.width-c)/2),this.alignX==="Max"&&(a=this.width-c),this.alignY==="Mid"&&(d=(this.height-b)/2),this.alignY==="Max"&&(d=this.height-b);return{width:c,height:b,marginX:a,marginY:d}},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width);this.set("height",c.height)},_initElement:function(c){this.setElement(f.util.getById(c));
f.util.addClass(this.getElement(),f.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={});this.setOptions(c);this._setWidthHeight(c);if(this._element&&this.crossOrigin)this._element.crossOrigin=this.crossOrigin},_initFilters:function(c,b){c.filters&&c.filters.length?f.util.enlivenObjects(c.filters,function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(c){this.width="width"in c?c.width:this.getElement()?this.getElement().width||0:0;this.height="height"in c?c.height:this.getElement()?
this.getElement().height||0:0},complexity:function(){return 1}}),f.Image.CSS_CANVAS="canvas-img",f.Image.prototype.getSvgSrc=f.Image.prototype.getSrc,f.Image.fromObject=function(c,b){f.util.loadImage(c.src,function(a){f.Image.prototype._initFilters.call(c,c,function(d){c.filters=d||[];d=new f.Image(a,c);b&&b(d)})},null,c.crossOrigin)},f.Image.fromURL=function(c,b,a){f.util.loadImage(c,function(c){b(new f.Image(c,a))},null,a&&a.crossOrigin)},f.Image.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),
f.Image.fromElement=function(d,b,a){var d=f.parseAttributes(d,f.Image.ATTRIBUTE_NAMES),i="xMidYMid",g="meet",h;d.preserveAspectRatio&&(h=d.preserveAspectRatio.split(" "));h&&h.length&&(g=h.pop(),g!=="meet"&&g!=="slice"?(i=g,g="meet"):h.length&&(i=h.pop()));h=i!=="none"?i.slice(1,4):"none";i=i!=="none"?i.slice(5,8):"none";d.alignX=h;d.alignY=i;d.meetOrSlice=g;f.Image.fromURL(d["xlink:href"],b,c(a?f.util.object.clone(a):{},d))},f.Image.async=!0,f.Image.pngCompression=1)})(typeof k!=="undefined"?k:this);
f.util.object.extend(f.Object.prototype,{_getAngleValueForStraighten:function(){var d=this.getAngle()%360;return d>0?Math.round((d-1)/90)*90:Math.round(d/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(d){var d=d||{},c=function(){},e=d.onComplete||c,b=d.onChange||c,a=this;f.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(c){a.setAngle(c);b()},onComplete:function(){a.setCoords();
e()},onStart:function(){a.set("active",!1)}});return this}});f.util.object.extend(f.StaticCanvas.prototype,{straightenObject:function(d){d.straighten();this.renderAll();return this},fxStraightenObject:function(d){d.fxStraighten({onChange:this.renderAll.bind(this)});return this}});f.Image.filters=f.Image.filters||{};f.Image.filters.BaseFilter=f.util.createClass({type:"BaseFilter",initialize:function(d){d&&this.setOptions(d)},setOptions:function(d){for(var c in d)this[c]=d[c]},toObject:function(){return{type:this.type}},
toJSON:function(){return this.toObject()}});(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend;c.Image.filters.Brightness=c.util.createClass(c.Image.filters.BaseFilter,{type:"Brightness",initialize:function(b){b=b||{};this.brightness=b.brightness||0},applyTo:function(b){for(var a=b.getContext("2d"),b=a.getImageData(0,0,b.width,b.height),c=b.data,d=this.brightness,e=0,f=c.length;e<f;e+=4)c[e]+=d,c[e+1]+=d,c[e+2]+=d;a.putImageData(b,0,0)},toObject:function(){return e(this.callSuper("toObject"),
{brightness:this.brightness})}});c.Image.filters.Brightness.fromObject=function(b){return new c.Image.filters.Brightness(b)}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend;c.Image.filters.Convolute=c.util.createClass(c.Image.filters.BaseFilter,{type:"Convolute",initialize:function(b){b=b||{};this.opaque=b.opaque;this.matrix=b.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=c.util.createCanvasElement().getContext("2d")},_createImageData:function(b,a){return this.tmpCtx.createImageData(b,
a)},applyTo:function(b){for(var a=this.matrix,c=b.getContext("2d"),d=c.getImageData(0,0,b.width,b.height),b=Math.round(Math.sqrt(a.length)),e=Math.floor(b/2),f=d.data,k=d.width,d=d.height,n=this._createImageData(k,d),j=n.data,p=this.opaque?1:0,q=0;q<d;q++)for(var s=0;s<k;s++){for(var B=q,v=s,y=(q*k+s)*4,A=0,w=0,t=0,x=0,u=0;u<b;u++)for(var r=0;r<b;r++){var D=B+u-e,F=v+r-e;D<0||D>d||F<0||F>k||(D=(D*k+F)*4,F=a[u*b+r],A+=f[D]*F,w+=f[D+1]*F,t+=f[D+2]*F,x+=f[D+3]*F)}j[y]=A;j[y+1]=w;j[y+2]=t;j[y+3]=x+p*
(255-x)}c.putImageData(n,0,0)},toObject:function(){return e(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});c.Image.filters.Convolute.fromObject=function(b){return new c.Image.filters.Convolute(b)}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend;c.Image.filters.GradientTransparency=c.util.createClass(c.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(b){b=b||{};this.threshold=b.threshold||100},applyTo:function(b){for(var a=
b.getContext("2d"),b=a.getImageData(0,0,b.width,b.height),c=b.data,d=this.threshold,e=c.length,f=0,k=c.length;f<k;f+=4)c[f+3]=d+255*(e-f)/e;a.putImageData(b,0,0)},toObject:function(){return e(this.callSuper("toObject"),{threshold:this.threshold})}});c.Image.filters.GradientTransparency.fromObject=function(b){return new c.Image.filters.GradientTransparency(b)}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Grayscale=c.util.createClass(c.Image.filters.BaseFilter,
{type:"Grayscale",applyTo:function(c){for(var b=c.getContext("2d"),c=b.getImageData(0,0,c.width,c.height),a=c.data,d=c.width*c.height*4,f=0,h;f<d;)h=(a[f]+a[f+1]+a[f+2])/3,a[f]=h,a[f+1]=h,a[f+2]=h,f+=4;b.putImageData(c,0,0)}});c.Image.filters.Grayscale.fromObject=function(){return new c.Image.filters.Grayscale}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Invert=c.util.createClass(c.Image.filters.BaseFilter,{type:"Invert",applyTo:function(c){var b=c.getContext("2d"),
c=b.getImageData(0,0,c.width,c.height),a=c.data,d=a.length,f;for(f=0;f<d;f+=4)a[f]=255-a[f],a[f+1]=255-a[f+1],a[f+2]=255-a[f+2];b.putImageData(c,0,0)}});c.Image.filters.Invert.fromObject=function(){return new c.Image.filters.Invert}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend;c.Image.filters.Mask=c.util.createClass(c.Image.filters.BaseFilter,{type:"Mask",initialize:function(b){b=b||{};this.mask=b.mask;this.channel=[0,1,2,3].indexOf(b.channel)>
-1?b.channel:0},applyTo:function(b){if(this.mask){var a=b.getContext("2d"),b=a.getImageData(0,0,b.width,b.height),d=b.data,e=this.mask.getElement(),f=c.util.createCanvasElement(),k=this.channel,l=b.width*b.height*4;f.width=e.width;f.height=e.height;f.getContext("2d").drawImage(e,0,0,e.width,e.height);f=f.getContext("2d").getImageData(0,0,e.width,e.height).data;for(e=0;e<l;e+=4)d[e+3]=f[e+k];a.putImageData(b,0,0)}},toObject:function(){return e(this.callSuper("toObject"),{mask:this.mask.toObject(),
channel:this.channel})}});c.Image.filters.Mask.fromObject=function(b,a){c.util.loadImage(b.mask.src,function(d){b.mask=new c.Image(d,b.mask);a&&a(new c.Image.filters.Mask(b))})};c.Image.filters.Mask.async=!0})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend;c.Image.filters.Noise=c.util.createClass(c.Image.filters.BaseFilter,{type:"Noise",initialize:function(b){b=b||{};this.noise=b.noise||0},applyTo:function(b){for(var a=b.getContext("2d"),b=a.getImageData(0,
0,b.width,b.height),c=b.data,d=this.noise,e,f=0,k=c.length;f<k;f+=4)e=(0.5-Math.random())*d,c[f]+=e,c[f+1]+=e,c[f+2]+=e;a.putImageData(b,0,0)},toObject:function(){return e(this.callSuper("toObject"),{noise:this.noise})}});c.Image.filters.Noise.fromObject=function(b){return new c.Image.filters.Noise(b)}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend;c.Image.filters.Pixelate=c.util.createClass(c.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(b){b=
b||{};this.blocksize=b.blocksize||4},applyTo:function(b){var a=b.getContext("2d"),b=a.getImageData(0,0,b.width,b.height),c=b.data,d=b.height,e=b.width,f,k,n,j,p,q,s;for(k=0;k<d;k+=this.blocksize)for(n=0;n<e;n+=this.blocksize){f=k*4*e+n*4;j=c[f];p=c[f+1];q=c[f+2];s=c[f+3];for(var B=k,v=k+this.blocksize;B<v;B++)for(var y=n,A=n+this.blocksize;y<A;y++)f=B*4*e+y*4,c[f]=j,c[f+1]=p,c[f+2]=q,c[f+3]=s}a.putImageData(b,0,0)},toObject:function(){return e(this.callSuper("toObject"),{blocksize:this.blocksize})}});
c.Image.filters.Pixelate.fromObject=function(b){return new c.Image.filters.Pixelate(b)}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend;c.Image.filters.RemoveWhite=c.util.createClass(c.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(b){b=b||{};this.threshold=b.threshold||30;this.distance=b.distance||20},applyTo:function(b){for(var a=b.getContext("2d"),b=a.getImageData(0,0,b.width,b.height),c=b.data,d=this.distance,e=255-this.threshold,
f=Math.abs,k,n,j,p=0,q=c.length;p<q;p+=4)k=c[p],n=c[p+1],j=c[p+2],k>e&&n>e&&j>e&&f(k-n)<d&&f(k-j)<d&&f(n-j)<d&&(c[p+3]=1);a.putImageData(b,0,0)},toObject:function(){return e(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});c.Image.filters.RemoveWhite.fromObject=function(b){return new c.Image.filters.RemoveWhite(b)}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Sepia=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia",
applyTo:function(c){var b=c.getContext("2d"),c=b.getImageData(0,0,c.width,c.height),a=c.data,d=a.length,f,h;for(f=0;f<d;f+=4)h=0.3*a[f]+0.59*a[f+1]+0.11*a[f+2],a[f]=h+100,a[f+1]=h+50,a[f+2]=h+255;b.putImageData(c,0,0)}});c.Image.filters.Sepia.fromObject=function(){return new c.Image.filters.Sepia}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Sepia2=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(c){var b=c.getContext("2d"),
c=b.getImageData(0,0,c.width,c.height),a=c.data,d=a.length,f,h,k,l;for(f=0;f<d;f+=4)h=a[f],k=a[f+1],l=a[f+2],a[f]=(h*0.393+k*0.769+l*0.189)/1.351,a[f+1]=(h*0.349+k*0.686+l*0.168)/1.203,a[f+2]=(h*0.272+k*0.534+l*0.131)/2.14;b.putImageData(c,0,0)}});c.Image.filters.Sepia2.fromObject=function(){return new c.Image.filters.Sepia2}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend;c.Image.filters.Tint=c.util.createClass(c.Image.filters.BaseFilter,{type:"Tint",
initialize:function(b){b=b||{};this.color=b.color||"#000000";this.opacity=typeof b.opacity!=="undefined"?b.opacity:(new c.Color(this.color)).getAlpha()},applyTo:function(b){var a=b.getContext("2d"),b=a.getImageData(0,0,b.width,b.height),d=b.data,e=d.length,f,k,l,n,j,p,q,s;f=(new c.Color(this.color)).getSource();k=f[0]*this.opacity;l=f[1]*this.opacity;n=f[2]*this.opacity;s=1-this.opacity;for(f=0;f<e;f+=4)j=d[f],p=d[f+1],q=d[f+2],d[f]=k+j*s,d[f+1]=l+p*s,d[f+2]=n+q*s;a.putImageData(b,0,0)},toObject:function(){return e(this.callSuper("toObject"),
{color:this.color,opacity:this.opacity})}});c.Image.filters.Tint.fromObject=function(b){return new c.Image.filters.Tint(b)}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend;c.Image.filters.Multiply=c.util.createClass(c.Image.filters.BaseFilter,{type:"Multiply",initialize:function(b){b=b||{};this.color=b.color||"#000000"},applyTo:function(b){var a=b.getContext("2d"),b=a.getImageData(0,0,b.width,b.height),d=b.data,e=d.length,f,k;k=(new c.Color(this.color)).getSource();
for(f=0;f<e;f+=4)d[f]*=k[0]/255,d[f+1]*=k[1]/255,d[f+2]*=k[2]/255;a.putImageData(b,0,0)},toObject:function(){return e(this.callSuper("toObject"),{color:this.color})}});c.Image.filters.Multiply.fromObject=function(b){return new c.Image.filters.Multiply(b)}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric;c.Image.filters.Blend=c.util.createClass({type:"Blend",initialize:function(c){c=c||{};this.color=c.color||"#000";this.image=c.image||!1;this.mode=c.mode||"multiply";this.alpha=c.alpha||
1},applyTo:function(d){var b=d.getContext("2d"),d=b.getImageData(0,0,d.width,d.height),a=d.data,f,g,h,k,l,n,j,p=!1;this.image?(p=!0,j=c.util.createCanvasElement(),j.width=this.image.width,j.height=this.image.height,j=new c.StaticCanvas(j),j.add(this.image),j=j.getContext("2d").getImageData(0,0,j.width,j.height).data):(j=(new c.Color(this.color)).getSource(),f=j[0]*this.alpha,g=j[1]*this.alpha,h=j[2]*this.alpha);for(var q=0,s=a.length;q<s;q+=4)switch(k=a[q],l=a[q+1],n=a[q+2],p&&(f=j[q]*this.alpha,
g=j[q+1]*this.alpha,h=j[q+2]*this.alpha),this.mode){case "multiply":a[q]=k*f/255;a[q+1]=l*g/255;a[q+2]=n*h/255;break;case "screen":a[q]=1-(1-k)*(1-f);a[q+1]=1-(1-l)*(1-g);a[q+2]=1-(1-n)*(1-h);break;case "add":a[q]=Math.min(255,k+f);a[q+1]=Math.min(255,l+g);a[q+2]=Math.min(255,n+h);break;case "diff":case "difference":a[q]=Math.abs(k-f);a[q+1]=Math.abs(l-g);a[q+2]=Math.abs(n-h);break;case "subtract":k-=f;l-=g;n-=h;a[q]=k<0?0:k;a[q+1]=l<0?0:l;a[q+2]=n<0?0:n;break;case "darken":a[q]=Math.min(k,f);a[q+
1]=Math.min(l,g);a[q+2]=Math.min(n,h);break;case "lighten":a[q]=Math.max(k,f),a[q+1]=Math.max(l,g),a[q+2]=Math.max(n,h)}b.putImageData(d,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});c.Image.filters.Blend.fromObject=function(d){return new c.Image.filters.Blend(d)}})(typeof k!=="undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=Math.pow,b=Math.floor,a=Math.sqrt,f=Math.abs,g=Math.max,h=Math.round,k=Math.sin,l=Math.ceil;c.Image.filters.Resize=
c.util.createClass(c.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){this.rcpScaleX=1/b;this.rcpScaleY=1/c;var d=a.width,e=a.height,b=h(d*b),c=h(e*c),f;this.resizeType==="sliceHack"&&(f=this.sliceByTwo(a,d,e,b,c));this.resizeType==="hermite"&&(f=this.hermiteFastResize(a,d,e,b,c));this.resizeType==="bilinear"&&(f=this.bilinearFiltering(a,d,e,b,c));this.resizeType==="lanczos"&&(f=this.lanczosResize(a,d,e,b,c));a.width=b;a.height=
c;a.getContext("2d").putImageData(f,0,0)},sliceByTwo:function(a,d,e,f,h){var i=a.getContext("2d"),k,m=0.5,l=0.5,n=1,t=1,s=!1,u=!1,r=d,y=e,A=c.util.createCanvasElement(),z=A.getContext("2d"),f=b(f),h=b(h);A.width=g(f,d);A.height=g(h,e);f>d&&(m=2,n=-1);h>e&&(l=2,t=-1);k=i.getImageData(0,0,d,e);a.width=g(f,d);a.height=g(h,e);for(i.putImageData(k,0,0);!s||!u;)d=r,e=y,f*n<b(r*m*n)?r=b(r*m):(r=f,s=!0),h*t<b(y*l*t)?y=b(y*l):(y=h,u=!0),k=i.getImageData(0,0,d,e),z.putImageData(k,0,0),i.clearRect(0,0,r,y),
i.drawImage(A,0,0,d,e,0,0,r,y);return i.getImageData(0,0,f,h)},lanczosResize:function(c,d,g,h,n){var s,v,y,A;function w(c){var k,m,l,o,t,T,U,R,O,L;y=(c+0.5)*F;s=b(y);for(k=0;k<n;k++){A=(k+0.5)*z;v=b(A);t=0;T=0;U=0;R=0;O=0;for(m=s-N;m<=s+N;m++)if(!(m<0||m>=d)){L=b(1E3*f(m-y));J[L]||(J[L]={});for(var M=v-P;M<=v+P;M++)M<0||M>=g||(l=b(1E3*f(M-A)),J[L][l]||(J[L][l]=D(a(e(L*H,2)+e(l*I,2))/1E3)),l=J[L][l],l>0&&(o=(M*d+m)*4,t+=l,T+=l*u[o],U+=l*u[o+1],R+=l*u[o+2],O+=l*u[o+3]))}o=(k*h+c)*4;r[o]=T/t;r[o+1]=
U/t;r[o+2]=R/t;r[o+3]=O/t}return++c<h?w(c):x}var c=c.getContext("2d"),t=c.getImageData(0,0,d,g),x=c.getImageData(0,0,h,n),u=t.data,r=x.data,D=function(a){return function(b){if(b>a)return 0;b*=Math.PI;if(f(b)<1.0E-16)return 1;var c=b/a;return k(b)*k(c)/b/c}}(this.lanczosLobes),F=this.rcpScaleX,z=this.rcpScaleY,H=2/this.rcpScaleX,I=2/this.rcpScaleY,N=l(F*this.lanczosLobes/2),P=l(z*this.lanczosLobes/2),J={};y=void 0;A=void 0;s=void 0;v=void 0;return w(0)},bilinearFiltering:function(a,c,d,e,f){var g,
h,i,k,m,l,n,u,r,s,y=0,z=this.rcpScaleX,A=this.rcpScaleY;n=a.getContext("2d");var a=4*(c-1),d=n.getImageData(0,0,c,d).data,I=n.getImageData(0,0,e,f),N=I.data;for(n=0;n<f;n++)for(u=0;u<e;u++){m=b(z*u);l=b(A*n);r=z*u-m;s=A*n-l;l=4*(l*c+m);for(m=0;m<4;m++)g=d[l+m],h=d[l+4+m],i=d[l+a+m],k=d[l+a+4+m],g=g*(1-r)*(1-s)+h*r*(1-s)+i*s*(1-r)+k*r*s,N[y++]=g}return I},hermiteFastResize:function(c,d,e,g,h){for(var k=this.rcpScaleX,m=this.rcpScaleY,n=l(k/2),s=l(m/2),c=c.getContext("2d"),e=c.getImageData(0,0,d,e).data,
c=c.getImageData(0,0,g,h),w=c.data,t=0;t<h;t++)for(var x=0;x<g;x++){for(var u=(x+t*g)*4,r=0,y=0,A=0,z=0,H=0,I=0,N=0,P=(t+0.5)*m,J=b(t*m);J<(t+1)*m;J++){var S=f(P-(J+0.5))/s,W=(x+0.5)*k;S*=S;for(var Q=b(x*k);Q<(x+1)*k;Q++){var K=f(W-(Q+0.5))/n,r=a(S+K*K);r>1&&r<-1||(r=2*r*r*r-3*r*r+1,r>0&&(K=4*(Q+J*d),N+=r*e[K+3],A+=r,e[K+3]<255&&(r=r*e[K+3]/250),z+=r*e[K],H+=r*e[K+1],I+=r*e[K+2],y+=r))}}w[u]=z/y;w[u+1]=H/y;w[u+2]=I/y;w[u+3]=N/A}return c}});c.Image.filters.Resize.fromObject=function(){return new c.Image.filters.Resize}})(typeof k!==
"undefined"?k:this);(function(d){var c=d.fabric||(d.fabric={}),e=c.util.object.extend,b=c.util.object.clone,a=c.util.toFixed,f=c.StaticCanvas.supports("setLineDash");c.Text?c.warn("fabric.Text is already defined"):(d=c.Object.prototype.stateProperties.concat(),d.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),c.Text=c.util.createClass(c.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,
textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:d,stroke:null,shadow:null,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(){this.__skipDimension||
this._render(c.util.createCanvasElement().getContext("2d"))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){typeof Cufon==="undefined"||this.useNative===!0?this._renderViaNative(a):this._renderViaCufon(a)},_renderViaNative:function(a){var b=this.text.split(this._reNewline);this._setTextStyles(a);this.width=this._getTextWidth(a,b);this.height=this._getTextHeight(a,b);this.clipTo&&c.util.clipContext(this,
a);this._renderTextBackground(a,b);this._translateForTextAlign(a);this._renderText(a,b);this.textAlign!=="left"&&this.textAlign!=="justify"&&a.restore();this._renderTextDecoration(a,b);this.clipTo&&a.restore();this._setBoundaries(a,b);this._totalLineHeight=0},_renderText:function(a,b){a.save();this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextFill(a,b);this._renderTextStroke(a,b);this._restoreCompositeOperation(a);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){this.textAlign!==
"left"&&this.textAlign!=="justify"&&(a.save(),a.translate(this.textAlign==="center"?this.width/2:this.width,0))},_setBoundaries:function(a,b){this._boundaries=[];for(var c=0,d=b.length;c<d;c++){var e=this._getLineWidth(a,b[c]),f=this._getLineLeftOffset(e);this._boundaries.push({height:this.fontSize*this.lineHeight,width:e,left:f})}},_setTextStyles:function(a){this._setFillStyles(a);this._setStrokeStyles(a);a.textBaseline="alphabetic";if(!this.skipTextAlign)a.textAlign=this.textAlign;a.font=this._getFontDeclaration()},
_getTextHeight:function(a,b){return this.fontSize*b.length*this.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]||"|").width,d=1,e=b.length;d<e;d++){var f=a.measureText(b[d]).width;f>c&&(c=f)}return c},_renderChars:function(a,b,c,d,e){b[a](c,d,e)},_renderTextLine:function(a,b,c,d,e,f){e-=this.fontSize/4;if(this.textAlign!=="justify")this._renderChars(a,b,c,d,e,f);else{var i=b.measureText(c).width,k=this.width;if(k>i)for(var i=c.split(/\s+/),c=b.measureText(c.replace(/\s+/g,"")).width,
k=(k-c)/(i.length-1),n=c=0,s=i.length;n<s;n++)this._renderChars(a,b,i[n],d+c,e,f),c+=b.measureText(i[n]).width+k;else this._renderChars(a,b,c,d,e,f)}},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a,b){if(this.fill||this._skipFillStrokeCheck){this._boundaries=[];for(var c=0,d=0,e=b.length;d<e;d++){var f=this._getHeightOfLine(a,d,b);c+=f;this._renderTextLine("fillText",a,b[d],this._getLeftOffset(),this._getTopOffset()+c,d)}this.shadow&&
!this.shadow.affectStroke&&this._removeShadow(a)}},_renderTextStroke:function(a,b){if(this.stroke&&this.strokeWidth!==0||this._skipFillStrokeCheck){var c=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),f&&a.setLineDash(this.strokeDashArray));a.beginPath();for(var d=0,e=b.length;d<e;d++){var j=this._getHeightOfLine(a,d,b);c+=j;this._renderTextLine("strokeText",a,b[d],this._getLeftOffset(),this._getTopOffset()+
c,d)}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(a,b){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a,b)},_renderTextBoxBackground:function(a){if(this.backgroundColor)a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore()},_renderTextLinesBackground:function(a,b){if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;
for(var c=0,d=b.length;c<d;c++)if(b[c]!==""){var e=this._getLineWidth(a,b[c]),f=this._getLineLeftOffset(e);a.fillRect(this._getLeftOffset()+f,this._getTopOffset()+c*this.fontSize*this.lineHeight,e,this.fontSize*this.lineHeight)}a.restore()}},_getLineLeftOffset:function(a){return this.textAlign==="center"?(this.width-a)/2:this.textAlign==="right"?this.width-a:0},_getLineWidth:function(a,b){return this.textAlign==="justify"?this.width:a.measureText(b).width},_renderTextDecoration:function(a,b){function c(f){for(var i=
0,k=b.length;i<k;i++){var m=e._getLineWidth(a,b[i]),n=e._getLineLeftOffset(m);a.fillRect(e._getLeftOffset()+n,~~(f+i*e._getHeightOfLine(a,i,b)-d),m,1)}}if(this.textDecoration){var d=this._getTextHeight(a,b)/2,e=this;this.textDecoration.indexOf("underline")>-1&&c(this.fontSize*this.lineHeight);this.textDecoration.indexOf("line-through")>-1&&c(this.fontSize*this.lineHeight-this.fontSize/2);this.textDecoration.indexOf("overline")>-1&&c(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[c.isLikelyNode?
this.fontWeight:this.fontStyle,c.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",c.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){if(this.visible){a.save();b||this.transform(a);var c=this.group&&this.group.type==="path-group";c&&a.translate(-this.group.width/2,-this.group.height/2);this.transformMatrix&&a.transform.apply(a,this.transformMatrix);c&&a.translate(this.left,this.top);this._render(a);a.restore()}},toObject:function(a){a=e(this.callSuper("toObject",
a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=[],c=this.text.split(this._reNewline),d=this._getSVGLeftTopOffsets(c),e=this._getSVGTextAndBg(d.lineTop,d.textLeft,c),
c=this._getSVGShadows(d.lineTop,c);d.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0;this._wrapSVGTextAndBg(b,e,c,d);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){return{textLeft:-(this.width/2)+(this.group&&this.group.type==="path-group"?this.left:0),textTop:(this.useNative?this.fontSize*this.lineHeight-0.25*this.fontSize:this.height/2-a.length*this.fontSize-this._totalLineHeight)+(this.group&&this.group.type==="path-group"?this.top:0),lineTop:this.useNative?
this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight}},_wrapSVGTextAndBg:function(b,c,d,e){b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',c.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+
this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',a(e.textLeft,2)," ",a(e.textTop,2),')">',d.join(""),c.textSpans.join(""),"</text>\n","</g>\n")},_getSVGShadows:function(b,d){var e=[],f,i,j=1;if(!this.shadow||!this._boundaries)return e;for(f=0,i=d.length;f<i;f++)d[f]!==""?(e.push('<tspan x="',a((this._boundaries&&this._boundaries[f]?this._boundaries[f].left:0)+j+this.shadow.offsetX,2),f===0||this.useNative?'" y':'" dy','="',a(this.useNative?b*f-this.height/2+this.shadow.offsetY:
b+(f===0?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",c.util.string.escapeXml(d[f]),"</tspan>"),j=1):j++;return e},_getSVGTextAndBg:function(a,b,c){var d=[],e=[],f=1;this._setSVGBg(e);for(var i=0,k=c.length;i<k;i++)c[i]!==""?(this._setSVGTextLineText(c[i],i,d,a,f,e),f=1):f++,this.textBackgroundColor&&this._boundaries&&this._setSVGTextLineBg(e,i,b,a);return{textSpans:d,textBgRects:e}},_setSVGTextLineText:function(b,d,e,f,i){var j=this._boundaries&&this._boundaries[d]?
a(this._boundaries[d].left,2):0;e.push('<tspan x="',j,'" ',d===0||this.useNative?"y":"dy",'="',a(this.useNative?f*d-this.height/2:f*i,2),'" ',this._getFillAttributes(this.fill),">",c.util.string.escapeXml(b),"</tspan>")},_setSVGTextLineBg:function(b,c,d,e){b.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(d+this._boundaries[c].left,2),'" y="',a(e*c-this.height/2,2),'" width="',a(this._boundaries[c].width,2),'" height="',a(this._boundaries[c].height,2),'"></rect>\n')},_setSVGBg:function(b){this.backgroundColor&&
this._boundaries&&b.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,2),'" y="',a(-this.height/2,2),'" width="',a(this.width,2),'" height="',a(this.height,2),'"></rect>')},_getFillAttributes:function(a){var b=a&&typeof a==="string"?new c.Color(a):"";return!b||!b.getSource()||b.getAlpha()===1?'fill="'+a+'"':'opacity="'+b.getAlpha()+'" fill="'+b.setAlpha(1).toRgb()+'"'},_set:function(a,b){if(a==="fontFamily"&&this.path)this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,
"$1"+b+"$3");this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),c.Text.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),c.Text.DEFAULT_SVG_FONT_SIZE=16,c.Text.fromElement=function(a,b){if(!a)return null;var d=c.parseAttributes(a,c.Text.ATTRIBUTE_NAMES),b=c.util.object.extend(b?c.util.object.clone(b):{},d);b.top=b.top||0;
b.left=b.left||0;"dx"in d&&(b.left+=d.dx);"dy"in d&&(b.top+=d.dy);if(!("fontSize"in b))b.fontSize=c.Text.DEFAULT_SVG_FONT_SIZE;if(!b.originX)b.originX="left";b.top+=b.fontSize/4;var d=new c.Text(a.textContent,b),e=0;d.originX==="left"&&(e=d.getWidth()/2);d.originX==="right"&&(e=-d.getWidth()/2);d.set({left:d.getLeft()+e,top:d.getTop()-d.getHeight()/2});return d},c.Text.fromObject=function(a){return new c.Text(a.text,b(a))},c.util.createAccessors(c.Text))})(typeof k!=="undefined"?k:this);(function(){var d=
f.util.object.clone;f.IText=f.util.createClass(f.Text,f.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(c,d){this.styles=
d?d.styles||{}:{};this.callSuper("initialize",c,d);this.initBehavior();f.IText.instances.push(this);this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles)return!0;var c=this.styles,d;for(d in c)for(var b in c[d])for(var a in c[d][b])return!1;return!0},setSelectionStart:function(c){this.selectionStart!==c&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionStart=c;this.hiddenTextarea&&
(this.hiddenTextarea.selectionStart=c)},setSelectionEnd:function(c){this.selectionEnd!==c&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionEnd=c;this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=c)},getSelectionStyles:function(c,d){if(arguments.length===2){for(var b=[],a=c;a<d;a++)b.push(this.getSelectionStyles(a));return b}b=this.get2DCursorLocation(c);return this.styles[b.lineIndex]?this.styles[b.lineIndex][b.charIndex]||
{}:{}},setSelectionStyles:function(c){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,c);else for(var d=this.selectionStart;d<this.selectionEnd;d++)this._extendStyles(d,c);return this},_extendStyles:function(c,d){var b=this.get2DCursorLocation(c);this.styles[b.lineIndex]||(this.styles[b.lineIndex]={});this.styles[b.lineIndex][b.charIndex]||(this.styles[b.lineIndex][b.charIndex]={});f.util.object.extend(this.styles[b.lineIndex][b.charIndex],d)},_render:function(c){this.callSuper("_render",
c);this.ctx=c;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var c=this.text.split(""),d;this.selectionStart===this.selectionEnd?(d=this._getCursorBoundaries(c,"cursor"),this.renderCursor(d)):(d=this._getCursorBoundaries(c,"selection"),this.renderSelection(c,d))}},get2DCursorLocation:function(c){if(typeof c==="undefined")c=this.selectionStart;c=this.text.slice(0,c).split(this._reNewline);return{lineIndex:c.length-1,charIndex:c[c.length-1].length}},
getCurrentCharStyle:function(c,d){var b=this.styles[c]&&this.styles[c][d===0?0:d-1];return{fontSize:b&&b.fontSize||this.fontSize,fill:b&&b.fill||this.fill,textBackgroundColor:b&&b.textBackgroundColor||this.textBackgroundColor,textDecoration:b&&b.textDecoration||this.textDecoration,fontFamily:b&&b.fontFamily||this.fontFamily,fontWeight:b&&b.fontWeight||this.fontWeight,fontStyle:b&&b.fontStyle||this.fontStyle,stroke:b&&b.stroke||this.stroke,strokeWidth:b&&b.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(c,
d){return this.styles[c]&&this.styles[c][d===0?0:d-1]&&this.styles[c][d===0?0:d-1].fontSize||this.fontSize},getCurrentCharColor:function(c,d){return this.styles[c]&&this.styles[c][d===0?0:d-1]&&this.styles[c][d===0?0:d-1].fill||this.cursorColor},_getCursorBoundaries:function(c,d){var b=this.get2DCursorLocation(),a=this.text.split(this._reNewline),f=Math.round(this._getLeftOffset()),g=this._getTopOffset(),b=this._getCursorBoundariesOffsets(c,d,b,a);return{left:f,top:g,leftOffset:b.left+b.lineLeft,
topOffset:b.top}},_getCursorBoundariesOffsets:function(c,d,b,a){for(var f=0,g=0,h=0,k=0,b=d==="cursor"?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(b.lineIndex,b.charIndex):0,l=0;l<this.selectionStart;l++)c[l]==="\n"?(k=0,b+=this._getCachedLineHeight(g+(d==="cursor"?1:0)),g++,h=0):(k+=this._getWidthOfChar(this.ctx,c[l],g,h),h++),f=this._getCachedLineOffset(g,a);this._clearCache();return{top:b,left:k,lineLeft:f}},_clearCache:function(){this.__lineWidths={};this.__lineHeights={};this.__lineOffsets=
{}},_getCachedLineHeight:function(c){return this.__lineHeights[c]||(this.__lineHeights[c]=this._getHeightOfLine(this.ctx,c))},_getCachedLineWidth:function(c,d){return this.__lineWidths[c]||(this.__lineWidths[c]=this._getWidthOfLine(this.ctx,c,d))},_getCachedLineOffset:function(c,d){var b=this._getCachedLineWidth(c,d);return this.__lineOffsets[c]||(this.__lineOffsets[c]=this._getLineLeftOffset(b))},renderCursor:function(c){var d=this.ctx;d.save();var b=this.get2DCursorLocation(),a=b.lineIndex,b=b.charIndex,
f=this.getCurrentCharFontSize(a,b),g=a===0&&b===0?this._getCachedLineOffset(a,this.text.split(this._reNewline)):c.leftOffset;d.fillStyle=this.getCurrentCharColor(a,b);d.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;d.fillRect(c.left+g,c.top+c.topOffset,this.cursorWidth/this.scaleX,f);d.restore()},renderSelection:function(c,d){var b=this.ctx;b.save();b.fillStyle=this.selectionColor;for(var a=this.get2DCursorLocation(this.selectionStart),f=this.get2DCursorLocation(this.selectionEnd),g=
a.lineIndex,h=f.lineIndex,k=this.text.split(this._reNewline),l=g;l<=h;l++){var n=this._getCachedLineOffset(l,k)||0,j=this._getCachedLineHeight(l),p=0;if(l===g)for(var q=0,s=k[l].length;q<s;q++){if(q>=a.charIndex&&(l!==h||q<f.charIndex))p+=this._getWidthOfChar(b,k[l][q],l,q);q<a.charIndex&&(n+=this._getWidthOfChar(b,k[l][q],l,q))}else if(l>g&&l<h)p+=this._getCachedLineWidth(l,k)||5;else if(l===h){q=0;for(s=f.charIndex;q<s;q++)p+=this._getWidthOfChar(b,k[l][q],l,q)}b.fillRect(d.left+n,d.top+d.topOffset,
p,j);d.topOffset+=j}b.restore()},_renderChars:function(c,d,b,a,f,g){if(this.isEmptyStyles())return this._renderCharsFast(c,d,b,a,f);this.skipTextAlign=!0;a-=this.textAlign==="center"?this.width/2:this.textAlign==="right"?this.width:0;var h=this.text.split(this._reNewline),k=this._getWidthOfLine(d,g,h),h=this._getHeightOfLine(d,g,h),l=this._getLineLeftOffset(k),b=b.split(""),n,k="";a+=l||0;d.save();for(var l=0,j=b.length;l<=j;l++){n=n||this.getCurrentCharStyle(g,l);var p=this.getCurrentCharStyle(g,
l+1);if(this._hasStyleChanged(n,p)||l===j)this._renderChar(c,d,g,l-1,k,a,f,h),k="",n=p;k+=b[l]}d.restore()},_renderCharsFast:function(c,d,b,a,f){this.skipTextAlign=!1;c==="fillText"&&this.fill&&this.callSuper("_renderChars",c,d,b,a,f);c==="strokeText"&&this.stroke&&this.callSuper("_renderChars",c,d,b,a,f)},_renderChar:function(c,d,b,a,f,g,h,k){var l;if(this.styles&&this.styles[b]&&(l=this.styles[b][a])){var n=l.stroke||this.stroke,j=l.fill||this.fill;d.save();c=this._applyCharStylesGetWidth(d,f,b,
a,l);b=this._getHeightOfChar(d,f,b,a);j&&d.fillText(f,g,h);n&&d.strokeText(f,g,h);this._renderCharDecoration(d,l,g,h,c,k,b);d.restore();d.translate(c,0)}else{if(c==="strokeText"&&this.stroke)d[c](f,g,h);if(c==="fillText"&&this.fill)d[c](f,g,h);c=this._applyCharStylesGetWidth(d,f,b,a);this._renderCharDecoration(d,null,g,h,c,k);d.translate(d.measureText(f).width,0)}},_hasStyleChanged:function(c,d){return c.fill!==d.fill||c.fontSize!==d.fontSize||c.textBackgroundColor!==d.textBackgroundColor||c.textDecoration!==
d.textDecoration||c.fontFamily!==d.fontFamily||c.fontWeight!==d.fontWeight||c.fontStyle!==d.fontStyle||c.stroke!==d.stroke||c.strokeWidth!==d.strokeWidth},_renderCharDecoration:function(c,d,b,a,f,g,h){var k=d?d.textDecoration||this.textDecoration:this.textDecoration,d=(d?d.fontSize:null)||this.fontSize;k&&(k.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(c,b,a+this.fontSize/this._fontSizeFraction,f,0,this.fontSize/20),k.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(c,
b,a+this.fontSize/this._fontSizeFraction,f,h/2,d/20),k.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(c,b,a,f,g-this.fontSize/this._fontSizeFraction,this.fontSize/20))},_renderCharDecorationAtOffset:function(c,d,b,a,f,g){c.fillRect(d,b-f,a,g)},_renderTextLine:function(c,d,b,a,f,g){f+=this.fontSize/4;this.callSuper("_renderTextLine",c,d,b,a,f,g)},_renderTextDecoration:function(c,d){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",c,d)},_renderTextLinesBackground:function(c,
d){if(this.textBackgroundColor||this.styles){c.save();if(this.textBackgroundColor)c.fillStyle=this.textBackgroundColor;for(var b=0,a=this.fontSize/this._fontSizeFraction,f=0,g=d.length;f<g;f++){var h=this._getHeightOfLine(c,f,d);if(d[f]!==""){var k=this._getWidthOfLine(c,f,d),l=this._getLineLeftOffset(k);if(this.textBackgroundColor)c.fillStyle=this.textBackgroundColor,c.fillRect(this._getLeftOffset()+l,this._getTopOffset()+b+a,k,h);if(this.styles[f])for(var k=0,n=d[f].length;k<n;k++)if(this.styles[f]&&
this.styles[f][k]&&this.styles[f][k].textBackgroundColor){var j=d[f][k];c.fillStyle=this.styles[f][k].textBackgroundColor;c.fillRect(this._getLeftOffset()+l+this._getWidthOfCharsAt(c,f,k,d),this._getTopOffset()+b+a,this._getWidthOfChar(c,j,f,k,d)+1,h)}}b+=h}c.restore()}},_getCacheProp:function(c,d){return c+d.fontFamily+d.fontSize+d.fontWeight+d.fontStyle+d.shadow},_applyCharStylesGetWidth:function(c,e,b,a,i){var g;g=(b=i||this.styles[b]&&this.styles[b][a])?d(b):{},b=g;this._applyFontStyles(b);a=
this._getCacheProp(e,b);if(this.isEmptyStyles()&&this._charWidthsCache[a]&&this.caching)return this._charWidthsCache[a];if(typeof b.shadow==="string")b.shadow=new f.Shadow(b.shadow);i=b.fill||this.fill;c.fillStyle=i.toLive?i.toLive(c):i;if(b.stroke)c.strokeStyle=b.stroke&&b.stroke.toLive?b.stroke.toLive(c):b.stroke;c.lineWidth=b.strokeWidth||this.strokeWidth;c.font=this._getFontDeclaration.call(b);this._setShadow.call(b,c);if(!this.caching)return c.measureText(e).width;if(!this._charWidthsCache[a])this._charWidthsCache[a]=
c.measureText(e).width;return this._charWidthsCache[a]},_applyFontStyles:function(c){if(!c.fontFamily)c.fontFamily=this.fontFamily;if(!c.fontSize)c.fontSize=this.fontSize;if(!c.fontWeight)c.fontWeight=this.fontWeight;if(!c.fontStyle)c.fontStyle=this.fontStyle},_getStyleDeclaration:function(c,e){return this.styles[c]&&this.styles[c][e]?d(this.styles[c][e]):{}},_getWidthOfChar:function(c,d,b,a){if(this.textAlign==="justify"&&/\s/.test(d))return this._getWidthOfSpace(c,b);var f=this._getStyleDeclaration(b,
a);this._applyFontStyles(f);f=this._getCacheProp(d,f);if(this._charWidthsCache[f]&&this.caching)return this._charWidthsCache[f];else if(c)return c.save(),d=this._applyCharStylesGetWidth(c,d,b,a),c.restore(),d},_getHeightOfChar:function(c,d,b,a){return this.styles[b]&&this.styles[b][a]?this.styles[b][a].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(c,d,b,a){a=a||this.text.split(this._reNewline);a=a[d].split("")[b];return this._getWidthOfChar(c,a,d,b)},_getHeightOfCharAt:function(c,
d,b,a){a=a||this.text.split(this._reNewline);a=a[d].split("")[b];return this._getHeightOfChar(c,a,d,b)},_getWidthOfCharsAt:function(c,d,b,a){for(var f=0,g=0;g<b;g++)f+=this._getWidthOfCharAt(c,d,g,a);return f},_getWidthOfLine:function(c,d,b){return this._getWidthOfCharsAt(c,d,b[d].length,b)},_getWidthOfSpace:function(c,d){var b=this.text.split(this._reNewline)[d],a=b.split(/\s+/);return(this.width-this._getWidthOfWords(c,b,d))/(a.length-1)},_getWidthOfWords:function(c,d,b){for(var a=0,f=0;f<d.length;f++){var g=
d[f];g.match(/\s/)||(a+=this._getWidthOfChar(c,g,b,f))}return a},_getTextWidth:function(c,d){if(this.isEmptyStyles())return this.callSuper("_getTextWidth",c,d);for(var b=this._getWidthOfLine(c,0,d),a=1,f=d.length;a<f;a++){var g=this._getWidthOfLine(c,a,d);g>b&&(b=g)}return b},_getHeightOfLine:function(c,d,b){for(var b=b||this.text.split(this._reNewline),a=this._getHeightOfChar(c,b[d][0],d,0),b=b[d].split(""),f=1,g=b.length;f<g;f++){var h=this._getHeightOfChar(c,b[f],d,f);h>a&&(a=h)}return a*this.lineHeight},
_getTextHeight:function(c,d){for(var b=0,a=0,f=d.length;a<f;a++)b+=this._getHeightOfLine(c,a,d);return b},_getTopOffset:function(){return f.Text.prototype._getTopOffset.call(this)-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(c){if(this.backgroundColor)c.save(),c.fillStyle=this.backgroundColor,c.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),c.restore()},toObject:function(c){return f.util.object.extend(this.callSuper("toObject",
c),{styles:d(this.styles)})}});f.IText.fromObject=function(c){return new f.IText(c.text,d(c))};f.IText.instances=[]})();(function(){var d=f.util.object.clone;f.util.object.extend(f.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var c=this;setTimeout(function(){c.selected=!0},100)})},initAddedHandler:function(){this.on("added",function(){if(this.canvas&&
!this.canvas._hasITextHandlers)this.canvas._hasITextHandlers=!0,this._initCanvasHandlers()})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){f.IText.prototype.exitEditingOnOthers.call()});this.canvas.on("mouse:up",function(){f.IText.instances.forEach(function(c){c.__isMousedown=!1})});this.canvas.on("object:selected",function(c){f.IText.prototype.exitEditingOnOthers.call(c.target)})},_tick:function(){if(!this._abortCursorAnimation){var c=this;this.animate("_currentCursorOpacity",
1,{duration:this.cursorDuration,onComplete:function(){c._onTickComplete()},onChange:function(){c.canvas&&c.canvas.renderAll()},abort:function(){return c._abortCursorAnimation}})}},_onTickComplete:function(){if(!this._abortCursorAnimation){var c=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){c.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){c._tick()},onChange:function(){c.canvas&&c.canvas.renderAll()},
abort:function(){return c._abortCursorAnimation}})},100)}},initDelayedCursor:function(c){var d=this,b=c?0:this.cursorDelay;if(c)this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll();this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){d._abortCursorAnimation=!1;d._tick()},b)},abortCursorAnimation:function(){this._abortCursorAnimation=!0;clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);
this._currentCursorOpacity=0;this.canvas&&this.canvas.renderAll();var c=this;setTimeout(function(){c._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(c){var d=0,b=c-1;if(this._reSpace.test(this.text.charAt(b)))for(;this._reSpace.test(this.text.charAt(b));)d++,
b--;for(;/\S/.test(this.text.charAt(b))&&b>-1;)d++,b--;return c-d},findWordBoundaryRight:function(c){var d=0,b=c;if(this._reSpace.test(this.text.charAt(b)))for(;this._reSpace.test(this.text.charAt(b));)d++,b++;for(;/\S/.test(this.text.charAt(b))&&b<this.text.length;)d++,b++;return c+d},findLineBoundaryLeft:function(c){for(var d=0,b=c-1;!/\n/.test(this.text.charAt(b))&&b>-1;)d++,b--;return c-d},findLineBoundaryRight:function(c){for(var d=0,b=c;!/\n/.test(this.text.charAt(b))&&b<this.text.length;)d++,
b++;return c+d},getNumNewLinesInSelectedText:function(){for(var c=0,d=0,b=this.getSelectedText().split(""),a=b.length;d<a;d++)b[d]==="\n"&&c++;return c},searchWordBoundary:function(c,d){for(var b=this._reSpace.test(this.text.charAt(c))?c-1:c,a=this.text.charAt(b),f=/[ \n\.,;!\?\-]/;!f.test(a)&&b>0&&b<this.text.length;)b+=d,a=this.text.charAt(b);f.test(a)&&a!=="\n"&&(b+=d===1?0:1);return b},selectWord:function(c){var d=this.searchWordBoundary(c,-1),c=this.searchWordBoundary(c,1);this.setSelectionStart(d);
this.setSelectionEnd(c);this.initDelayedCursor(!0)},selectLine:function(c){var d=this.findLineBoundaryLeft(c),c=this.findLineBoundaryRight(c);this.setSelectionStart(d);this.setSelectionEnd(c);this.initDelayedCursor(!0)},enterEditing:function(){if(!this.isEditing&&this.editable)return this.exitEditingOnOthers(),this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),
this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this},exitEditingOnOthers:function(){f.IText.instances.forEach(function(c){c.selected=!1;c.isEditing&&c.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text";if(this.canvas)this.canvas.defaultCursor=this.canvas.moveCursor="text";this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea)this.hiddenTextarea.value=
this.text,this.hiddenTextarea.selectionStart=this.selectionStart},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,
this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas))this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor},exitEditing:function(){this.isEditing=this.selected=!1;this.selectable=!0;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;
this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");this.canvas&&this.canvas.fire("text:editing:exited",{target:this});return this},_removeExtraneousStyles:function(){var c=this.text.split(this._reNewline),d;for(d in this.styles)c[d]||delete this.styles[d]},_removeCharsFromTo:function(c,d){for(var b=d;b!==c;){var a=this.get2DCursorLocation(b).charIndex;b--;(a=this.get2DCursorLocation(b).charIndex>a)?this.removeStyleObject(a,b+1):this.removeStyleObject(this.get2DCursorLocation(b).charIndex===
0,b)}this.text=this.text.slice(0,c)+this.text.slice(d)},insertChars:function(c){var d=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+c+this.text.slice(this.selectionEnd);this.selectionStart===this.selectionEnd&&this.insertStyleObjects(c,d,this.copiedStyles);this.selectionStart+=c.length;this.selectionEnd=this.selectionStart;this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",
{target:this})},insertNewlineStyleObject:function(c,e,b){this.shiftLineStyles(c,1);this.styles[c+1]||(this.styles[c+1]={});var a=this.styles[c][e-1],f={};if(b)f[0]=d(a);else for(var g in this.styles[c])parseInt(g,10)>=e&&(f[parseInt(g,10)-e]=this.styles[c][g],delete this.styles[c][g]);this.styles[c+1]=f},insertCharStyleObject:function(c,e,b){var a=this.styles[c],f=d(a);e===0&&!b&&(e=1);for(var g in f){var h=parseInt(g,10);h>=e&&(a[h+1]=f[h])}this.styles[c][e]=b||d(a[e-1])},insertStyleObjects:function(c,
d,b){var a=this.get2DCursorLocation(),f=a.lineIndex,a=a.charIndex;this.styles[f]||(this.styles[f]={});c==="\n"?this.insertNewlineStyleObject(f,a,d):b?this._insertStyles(b):this.insertCharStyleObject(f,a)},_insertStyles:function(c){for(var d=0,b=c.length;d<b;d++){var a=this.get2DCursorLocation(this.selectionStart+d);this.insertCharStyleObject(a.lineIndex,a.charIndex,c[d])}},shiftLineStyles:function(c,e){var b=d(this.styles),a;for(a in this.styles){var f=parseInt(a,10);f>c&&(this.styles[f+e]=b[f])}},
removeStyleObject:function(c,e){var b=this.get2DCursorLocation(e),a=b.lineIndex,b=b.charIndex;if(c){var f=this.text.split(this._reNewline)[a-1],f=f?f.length:0;this.styles[a-1]||(this.styles[a-1]={});for(b in this.styles[a])this.styles[a-1][parseInt(b,10)+f]=this.styles[a][b];this.shiftLineStyles(a,-1)}else{(a=this.styles[a])&&delete a[b+(this.selectionStart===this.selectionEnd?-1:0)];var g=d(a);for(f in g){var h=parseInt(f,10);h>=b&&h!==0&&(a[h-1]=g[h],delete a[h])}}},insertNewline:function(){this.insertChars("\n")}})})();
f.util.object.extend(f.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(d){this.__newClickTime=+new Date;var c=this.canvas.getPointer(d.e);this.isTripleClick(c)?(this.fire("tripleclick",d),this._stopEvent(d.e)):this.isDoubleClick(c)&&(this.fire("dblclick",d),this._stopEvent(d.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=
this.__newClickTime;this.__lastPointer=c;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(d){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y&&this.__lastIsEditing},isTripleClick:function(d){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y},_stopEvent:function(d){d.preventDefault&&d.preventDefault();
d.stopPropagation&&d.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMousemoveHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(d){this.selectWord(this.getSelectionStartFromPointer(d.e))});this.on("tripleclick",function(d){this.selectLine(this.getSelectionStartFromPointer(d.e))})},initMousedownHandler:function(){this.on("mousedown",function(d){var c=this.canvas.getPointer(d.e);
this.__mousedownX=c.x;this.__mousedownY=c.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(d.e);if(this.isEditing)this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0)})},initMousemoveHandler:function(){this.on("mousemove",function(d){this.__isMousedown&&this.isEditing&&(d=this.getSelectionStartFromPointer(d.e),d>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),
this.setSelectionEnd(d)):(this.setSelectionStart(d),this.setSelectionEnd(this.__selectionStartOnMouseDown)))})},_isObjectMoved:function(d){d=this.canvas.getPointer(d);return this.__mousedownX!==d.x||this.__mousedownY!==d.y},initMouseupHandler:function(){this.on("mouseup",function(d){this.__isMousedown=!1;if(!this._isObjectMoved(d.e))this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0})},setCursorByClick:function(d){var c=this.getSelectionStartFromPointer(d);d.shiftKey?
c<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(c)):this.setSelectionEnd(c):(this.setSelectionStart(c),this.setSelectionEnd(c))},_getLocalRotatedPointer:function(d){var c=this.canvas.getPointer(d),c=new f.Point(c.x,c.y),e=new f.Point(this.left,this.top),c=f.util.rotatePoint(c,e,f.util.degreesToRadians(-this.angle));return this.getLocalPointer(d,c)},getSelectionStartFromPointer:function(d){for(var d=this._getLocalRotatedPointer(d),c=this.text.split(this._reNewline),
e=0,b=0,a=0,f=0,g=0,h=c.length;g<h;g++){a+=this._getHeightOfLine(this.ctx,g)*this.scaleY;b=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,g,c))*this.scaleX;this.flipX&&(c[g]=c[g].split("").reverse().join(""));for(var k=0,l=c[g].length;k<l;k++){var n=c[g][k],e=b;b+=this._getWidthOfChar(this.ctx,n,g,this.flipX?l-k:k)*this.scaleX;if(a<=d.y||b<=d.x)f++;else return this._getNewSelectionStartFromOffset(d,e,b,f+g,l)}if(d.y<a)return this._getNewSelectionStartFromOffset(d,e,b,f+g,l)}return this.text.length},
_getNewSelectionStartFromOffset:function(d,c,e,b,a){d=b+(e-d.x>d.x-c?0:1);this.flipX&&(d=a-d);if(d>this.text.length)d=this.text.length;return d}});f.util.object.extend(f.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=f.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;";f.document.body.appendChild(this.hiddenTextarea);
f.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));f.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this));f.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));f.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));if(!this._clickHandlerInitialized&&this.canvas)f.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",
13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(d){if(this.isEditing){if(d.keyCode in this._keysMap)this[this._keysMap[d.keyCode]](d);else if(d.keyCode in this._ctrlKeysMap&&(d.ctrlKey||d.metaKey))this[this._ctrlKeysMap[d.keyCode]](d);
else return;d.stopImmediatePropagation();d.preventDefault();this.canvas&&this.canvas.renderAll()}},forwardDelete:function(d){this.selectionStart===this.selectionEnd&&this.moveCursorRight(d);this.removeChars(d)},copy:function(d){var c=this.getSelectedText();(d=this._getClipboardData(d))&&d.setData("text",c);this.copiedText=c;this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(d){var c=null;(c=(d=this._getClipboardData(d))?d.getData("text"):this.copiedText)&&
this.insertChars(c)},cut:function(d){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(d))},_getClipboardData:function(d){return d&&(d.clipboardData||f.window.clipboardData)},onKeyPress:function(d){this.isEditing&&!d.metaKey&&!d.ctrlKey&&(d.which!==0&&this.insertChars(String.fromCharCode(d.which)),d.stopPropagation())},getDownCursorOffset:function(d,c){var e=c?this.selectionEnd:this.selectionStart,b=this.text.split(this._reNewline),a=this.text.slice(0,e),f=this.text.slice(e),
g=a.slice(a.lastIndexOf("\n")+1),a=f.match(/(.*)\n?/)[1],f=(f.match(/.*\n(.*)\n?/)||{})[1]||"",h=this.get2DCursorLocation(e);if(h.lineIndex===b.length-1||d.metaKey||d.keyCode===34)return this.text.length-e;for(var k=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,h.lineIndex,b)),l=h.lineIndex,n=0,j=g.length;n<j;n++)e=g[n],k+=this._getWidthOfChar(this.ctx,e,l,n);b=this._getIndexOnNextLine(h,f,k,b);return a.length+1+b},_getIndexOnNextLine:function(d,c,e,b){for(var d=d.lineIndex+1,a=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,
d,b)),f=0,g,b=0,h=c.length;b<h;b++){var k=this._getWidthOfChar(this.ctx,c[b],d,b);a+=k;if(a>e){g=!0;d=a;a=Math.abs(a-k-e);f=Math.abs(d-e)<a?b+1:b;break}}if(!g)f=c.length;return f},moveCursorDown:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var c=this.getDownCursorOffset(d,this._selectionDirection==="right");d.shiftKey?this.moveCursorDownWithShift(c):this.moveCursorDownWithoutShift(c);this.initDelayedCursor()},moveCursorDownWithoutShift:function(d){this._selectionDirection=
"right";this.selectionStart+=d;if(this.selectionStart>this.text.length)this.selectionStart=this.text.length;this.selectionEnd=this.selectionStart;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},swapSelectionPoints:function(){var d=this.selectionEnd;this.selectionEnd=this.selectionStart;this.selectionStart=d},moveCursorDownWithShift:function(d){if(this.selectionEnd===this.selectionStart)this._selectionDirection="right";this[this._selectionDirection===
"right"?"selectionEnd":"selectionStart"]+=d;if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="left")this.swapSelectionPoints(),this._selectionDirection="right";if(this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getUpCursorOffset:function(d,c){var e=c?this.selectionEnd:this.selectionStart,b=this.get2DCursorLocation(e);if(b.lineIndex===0||d.metaKey||d.keyCode===
33)return e;for(var a=this.text.slice(0,e),e=a.slice(a.lastIndexOf("\n")+1),a=(a.match(/\n?(.*)\n.*$/)||{})[1]||"",f=this.text.split(this._reNewline),g,h=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,b.lineIndex,f)),k=b.lineIndex,l=0,n=e.length;l<n;l++)g=e[l],h+=this._getWidthOfChar(this.ctx,g,k,l);b=this._getIndexOnPrevLine(b,a,h,f);return a.length-b+e.length},_getIndexOnPrevLine:function(d,c,e,b){for(var d=d.lineIndex-1,a=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,d,b)),f=0,g,
b=0,h=c.length;b<h;b++){var k=this._getWidthOfChar(this.ctx,c[b],d,b);a+=k;if(a>e){g=!0;d=a;a=Math.abs(a-k-e);f=Math.abs(d-e)<a?b:b-1;break}}g||(f=c.length-1);return f},moveCursorUp:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var c=this.getUpCursorOffset(d,this._selectionDirection==="right");d.shiftKey?this.moveCursorUpWithShift(c):this.moveCursorUpWithoutShift(c);this.initDelayedCursor()},moveCursorUpWithShift:function(d){if(this.selectionEnd===this.selectionStart)this._selectionDirection=
"left";this[this._selectionDirection==="right"?"selectionEnd":"selectionStart"]-=d;if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="right")this.swapSelectionPoints(),this._selectionDirection="left";if(this.selectionStart<0)this.selectionStart=0;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorUpWithoutShift:function(d){this.selectionStart===this.selectionEnd&&(this.selectionStart-=d);if(this.selectionStart<0)this.selectionStart=
0;this.selectionEnd=this.selectionStart;this._selectionDirection="left";this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorLeft:function(d){if(!(this.selectionStart===0&&this.selectionEnd===0))this.abortCursorAnimation(),this._currentCursorOpacity=1,d.shiftKey?this.moveCursorLeftWithShift(d):this.moveCursorLeftWithoutShift(d),this.initDelayedCursor()},_move:function(d,c,e){d.altKey?this[c]=this["findWordBoundary"+e](this[c]):d.metaKey||
d.keyCode===35||d.keyCode===36?this[c]=this["findLineBoundary"+e](this[c]):this[c]+=e==="Left"?-1:1},_moveLeft:function(d,c){this._move(d,c,"Left")},_moveRight:function(d,c){this._move(d,c,"Right")},moveCursorLeftWithoutShift:function(d){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(d,"selectionStart");this.selectionEnd=this.selectionStart;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorLeftWithShift:function(d){if(this._selectionDirection===
"right"&&this.selectionStart!==this.selectionEnd)this._moveLeft(d,"selectionEnd");else if(this._selectionDirection="left",this._moveLeft(d,"selectionStart"),this.text.charAt(this.selectionStart)==="\n"&&this.selectionStart--,this.selectionStart<0)this.selectionStart=0;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorRight:function(d){if(!(this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length))this.abortCursorAnimation(),
this._currentCursorOpacity=1,d.shiftKey?this.moveCursorRightWithShift(d):this.moveCursorRightWithoutShift(d),this.initDelayedCursor()},moveCursorRightWithShift:function(d){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)this._moveRight(d,"selectionStart");else if(this._selectionDirection="right",this._moveRight(d,"selectionEnd"),this.text.charAt(this.selectionEnd-1)==="\n"&&this.selectionEnd++,this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.fire("selection:changed");
this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorRightWithoutShift:function(d){this._selectionDirection="right";if(this.selectionStart===this.selectionEnd)this._moveRight(d,"selectionStart"),this.selectionEnd=this.selectionStart;else{this.selectionEnd+=this.getNumNewLinesInSelectedText();if(this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.selectionStart=this.selectionEnd}this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",
{target:this})},removeChars:function(d){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(d):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.selectionEnd=this.selectionStart;this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(d){if(this.selectionStart!==0)d.metaKey?(d=this.findLineBoundaryLeft(this.selectionStart),
this._removeCharsFromTo(d,this.selectionStart),this.selectionStart=d):d.altKey?(d=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(d,this.selectionStart),this.selectionStart=d):(this.removeStyleObject(this.text.slice(this.selectionStart-1,this.selectionStart)==="\n"),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1))}});f.util.object.extend(f.IText.prototype,{_setSVGTextLineText:function(d,c,e,b,a,f){this.styles[c]?
this._setSVGTextLineChars(d,c,e,b,a,f):this.callSuper("_setSVGTextLineText",d,c,e,b,a)},_setSVGTextLineChars:function(d,c,e,b,a,f){for(var b=c===0||this.useNative?"y":"dy",d=d.split(""),a=0,g=this._getSVGLineLeftOffset(c),h=this._getSVGLineTopOffset(c),k=this._getHeightOfLine(this.ctx,c),l=0,n=d.length;l<n;l++){var j=this.styles[c][l]||{};e.push(this._createTextCharSpan(d[l],j,g,h,b,a));var p=this._getWidthOfChar(this.ctx,d[l],c,l);j.textBackgroundColor&&f.push(this._createTextCharBg(j,g,h,k,p,a));
a+=p}},_getSVGLineLeftOffset:function(d){return this._boundaries&&this._boundaries[d]?f.util.toFixed(this._boundaries[d].left,2):0},_getSVGLineTopOffset:function(d){for(var c=0,e=0;e<=d;e++)c+=this._getHeightOfLine(this.ctx,e);return c-this.height/2},_createTextCharBg:function(d,c,e,b,a,f){return['<rect fill="',d.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+b,')" x="',c+f,'" y="',e+b,'" width="',a,'" height="',b,'"></rect>'].join("")},_createTextCharSpan:function(d,
c,e,b,a,i){var g=this.getSvgStyles.call(f.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},c));return['<tspan x="',e+i,'" ',a,'="',b,'" ',c.fontFamily?'font-family="'+c.fontFamily.replace(/"/g,"'")+'" ':"",c.fontSize?'font-size="'+c.fontSize+'" ':"",c.fontStyle?'font-style="'+c.fontStyle+'" ':"",c.fontWeight?'font-weight="'+c.fontWeight+'" ':"",c.textDecoration?'text-decoration="'+c.textDecoration+'" ':"",'style="',g,'">',f.util.string.escapeXml(d),"</tspan>"].join("")}});
(function(){function d(c,d,e){var g=b.parse(c);if(!g.port)g.port=g.protocol.indexOf("https:")===0?443:80;c=(g.port===443?i:a).request({hostname:g.hostname,port:g.port,path:g.path,method:"GET"},function(a){var b="";d&&a.setEncoding(d);a.on("end",function(){e(b)});a.on("data",function(c){a.statusCode===200&&(b+=c)})});c.on("error",function(a){a.errno===process.ECONNREFUSED?f.log("ECONNREFUSED: connection refused to "+g.hostname+":"+g.port):f.log(a.message)});c.end()}function c(a,b){require("fs").readFile(a,
function(a,c){if(a)throw f.log(a),a;else b(c)})}if(!(typeof document!=="undefined"&&typeof A!=="undefined")){var e=require("xmldom").DOMParser,b=require("url"),a=require("http"),i=require("https"),g=require("canvas"),h=require("canvas").Image;f.util.loadImage=function(a,b,e){function f(c){g.src=new Buffer(c,"binary");g._src=a;b&&b.call(e,g)}var g=new h;a&&(a instanceof Buffer||a.indexOf("data")===0)?(g.src=g._src=a,b&&b.call(e,g)):a&&a.indexOf("http")!==0?c(a,f):a?d(a,"binary",f):b&&b.call(e,a)};
f.loadSVGFromURL=function(a,b,e){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();a.indexOf("http")!==0?c(a,function(a){f.loadSVGFromString(a.toString(),b,e)}):d(a,"",function(a){f.loadSVGFromString(a,b,e)})};f.loadSVGFromString=function(a,b,c){a=(new e).parseFromString(a);f.parseSVGDocument(a.documentElement,function(a,c){b&&b(a,c)},c)};f.util.getScript=function(a,b){d(a,"",function(a){eval(a);b&&b()})};f.Image.fromObject=function(a,b){f.util.loadImage(a.src,function(c){var d=new f.Image(c);d._initConfig(a);
d._initFilters(a,function(a){d.filters=a||[];b&&b(d)})})};f.createCanvasForNode=function(a,b,c,d){var d=d||c,e=f.document.createElement("canvas"),a=new g(a||600,b||600,d);e.style={};e.width=a.width;e.height=a.height;c=new (f.Canvas||f.StaticCanvas)(e,c);c.contextContainer=a.getContext("2d");c.nodeCanvas=a;c.Font=g.Font;return c};f.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};f.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};
var k=f.StaticCanvas.prototype.setWidth;f.StaticCanvas.prototype.setWidth=function(a,b){k.call(this,a,b);this.nodeCanvas.width=a;return this};if(f.Canvas)f.Canvas.prototype.setWidth=f.StaticCanvas.prototype.setWidth;var l=f.StaticCanvas.prototype.setHeight;f.StaticCanvas.prototype.setHeight=function(a,b){l.call(this,a,b);this.nodeCanvas.height=a;return this};if(f.Canvas)f.Canvas.prototype.setHeight=f.StaticCanvas.prototype.setHeight}})();A.fabric=f;k=k||{};k.fabric=f;typeof define==="function"&&define.amd&&
define([],function(){return f});return f})})})(function(){var s=window.AmazonUIPageJS||window.P,A=s._namespace||s.attributeErrors;return A?A("AmazonCustomFabricJS"):s}(),window);
(function(s,A,y){s.execute(function(){s.when("A","ready").register("acc-util",function(){return{}});s.when("A","ready").register("acc-font",function(n){(function(){var k=n.$,f=[],d=n.state("ctsStateData");if(n.objectIsEmpty(d))for(d=0;d<3;d++){var c=n.state("ctsStateInfo"+d);n.objectIsEmpty(c)||f.push(c)}else f=d.surfaces;f.length&&n.each(f,function(c){if(c.FontSettings&&c.FontSettings.fonts){var b=c.FontSettings.fonts;n.each(b,function(a){if(a.fontURL&&a.isActive){var c;c=b.length;a=a.fontURL.split("/");
a.length<1?c=null:(a=a[a.length-1].split("."),c=a.length<1?null:"ac_"+c+"_"+a[0].substring(0,20));c&&k("<span>&nbsp;</span>").css("font-family",c).appendTo("body")}})}})})()});s.when("A","acc-weblab-is-required","ready").register("acc-weblab",function(n,k){var f={},d={};d[k.name]=k.treatment;f.getTreatment=function(c){var e=d[c];return n.objectIsEmpty(e)?(A.console&&console.log("Weblab "+c+" not found"),y):e};f.isT1=function(c){return"T1"===f.getTreatment(c)};return f});s.when("A").register("acc-weblab-is-required",
function(){return{name:"AC_ENABLED_ATC_REQUIRED_TEXT_71376",treatment:"C"}})})})(function(){var s=window.AmazonUIPageJS||window.P,A=s._namespace||s.attributeErrors;return A?A("AmazonCustomCommonAssets"):s}(),window);
(function(s,A,y){s.execute(function(){(function(){s.when("A","acc-weblab","ready").register("BuyBox",function(n,k){return function(f){function d(){var a={},b={},c=!1;l.controller!==y&&(a=l.controller.getJSON());b.customizationData=JSON.stringify(a);if(f("#amazonCustomUseCaseId").length)b.clientId=f("#amazonCustomUseCaseId").val();f(".pc-error-container").hide();c=s(a);n.post("/gp/product/features/callSetCustomizationDatav2.html",{dataType:"json",params:b,contentType:"application/x-www-form-urlencoded;charset=utf-8",
success:function(a){c&&n.trigger("amazon-custom-log-ref-tag","hasNonASCII",{msg:a.result.pcToken});a.result.Status==="OK"&&a.result.pcToken!==y?(n.trigger("amazon-custom-log-ref-tag","AddToCartClick"),f("#UNIQ-pcToken",f(".pc-buy-box")).val(a.result.pcToken),f("#addToCart").submit()):f(".pc-error-container").show()},error:function(){f(".pc-error-container").show()}})}function c(a){var b=f("#pc-atc"),c=f(".pc-atc-wrapper");a?(b.prop("disabled",!1),c.removeClass("a-button-disabled")):(b.prop("disabled",
!0),c.addClass("a-button-disabled"))}function e(a,b){i(f(".pc-atc-missing-customization"),a,b)}function b(a,b){i(f(".pc-atc-missing-required-text"),a,b)}function a(a,b){i(f(".pc-atc-containing-emoji"),a,b)}function i(a,b,c){b?a.show():a.hide();c&&c.error?a.addClass("a-color-error"):a.removeClass("a-color-error")}function g(a){o=!0;if(a)j=a.callback}function h(){o=!1;j=null}var m={$el:y,showLabel:!0,controller:y},l={},o=!1,j=null,p=function(a){l=f.extend({},m,a);return this};p.prototype.getComponentName=
function(){return"BuyBox"};p.prototype.Init=function(){q.Bind();k.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&(e(!1),b(!1),a(!1))};var q={Bind:function(){n.declarative("upload-metadata","click",function(a){a.$event.preventDefault();f("#pc-atc").is(":disabled")||(k.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&o?f.isFunction(j)&&j():(n.trigger("amazon-custom-popup-close",new Date),d()))});n.on("enableBuybox",function(){c(!0)});n.on("disableBuybox",function(){c(!1)});k.isT1("AC_ENABLED_ATC_REQUIRED_TEXT_71376")&&
(n.on("showMissingCustomization",function(a){e(!0,a)}),n.on("hideMissingCustomization",function(){e(!1)}),n.on("showMissingRequiredFields",function(a){b(!0,a)}),n.on("hideMissingRequiredFields",function(){b(!1)}),n.on("showContainingEmoji",function(b){a(!0,b)}),n.on("hideContainingEmoji",function(){a(!1)}),n.on("blockBuybox",g),n.on("unblockBuybox",h))}},s=function(a){for(var a=a.customizationInfo["version3.0"].surfaces,b=RegExp(/[^\x00-\x7F]+/g),c=0;c<a.length;c++)for(var d=0;d<a[c].areas.length;d++)if(a[c].areas[d].customizationType===
"TextPrinting"&&b.test(a[c].areas[d].text))return!0;return!1};return p}(n.$)})})()})})(function(){var s=window.AmazonUIPageJS||window.P,A=s._namespace||s.attributeErrors;return A?A("AmazonCustomBuyBoxAssets"):s}(),window);